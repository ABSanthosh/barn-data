{
  "id": "7c248a03-dc81-4abc-bc82-faebee3d551d",
  "title": "Bad Luck Tickets",
  "link": "https://publicobject.com/2024/11/13/bad-luck-tickets/",
  "description": "My son’s swim meet is coming up. If he’s healthy, he’ll compete.My daughter’s hockey team has a game coming up. League rules say they must forfeit if they have fewer than 10 players. There’s only 10 girls on the roster so they need everyone",
  "author": "Jesse Wilson",
  "published": "Wed, 13 Nov 2024 05:08:26 GMT",
  "source": "https://publicobject.com/rss/",
  "categories": null,
  "byline": "Jesse Wilson",
  "length": 2222,
  "excerpt": "My son’s swim meet is coming up. If he’s healthy, he’ll compete. My daughter’s hockey team has a game coming up. League rules say they must forfeit if they have fewer than 10 players. There’s only 10 girls on the roster so they need everyone to be healthy to compete. In either situation, a single failure will fail the lot. With swimming there’s just one chance to get unlucky, whereas with hockey there’s ten. I’ve been thinking of these ‘opportunities to get unlucky’ as bad luck tickets. I see",
  "siteName": "Public Object",
  "favicon": "",
  "text": "My son’s swim meet is coming up. If he’s healthy, he’ll compete.My daughter’s hockey team has a game coming up. League rules say they must forfeit if they have fewer than 10 players. There’s only 10 girls on the roster so they need everyone to be healthy to compete.In either situation, a single failure will fail the lot. With swimming there’s just one chance to get unlucky, whereas with hockey there’s ten. I’ve been thinking of these ‘opportunities to get unlucky’ as bad luck tickets.I see bad luck tickets everywhere.When I was working on smaller teams, the leadership was very open and transparent with their plans and decisions. On larger teams, internal news often leaks externally! Share your plans with 1,000 people and you’ve got 1,000 chances to get unlucky.I was impressed – but not surprised – by this year’s xz supply chain attack. If our software depends on 10 open source libraries, that’s 10 chances to be compromised by a rogue maintainer. Depend on 1,000 libraries and we’ve got 1,000 bad luck tickets.One of the backend services at my job does fan-out queries on its sharded database. Suppose you’d like to know how much money it transferred yesterday:SELECT SUM(amount_cents) FROM transactions WHERE DATE(sent_at) = DATE('2024-11-11');On a database with 64 shards, the query is executed on each shard and then aggregated. Each shard has an opportunity to fail.The math is weird.Our database executes fan-out queries in parallel. That’s rad! But the latency of the aggregate query is the maximum latency of the 64 individual shard queries. If one shard is hot because the traffic isn’t balanced, that’ll degrade all of the aggregate queries.Suppose an action fails on 1 in 1,000,000 attempts. If we attempt it 1,000 times, there’s a 0.1% chance of at least one failure within those attempts¹.Failures will probably correlate (and the successes will too). Hockey players don’t get sick independently! They exhaust themselves at the same tournaments. And they share their water bottles even though I keep telling them it’s gross and they should cut it out.Limit your bad luck.It’s difficult to build robust systems with fallible parts, but fallible parts is all there is. I aspire to do more with less.",
  "image": "",
  "html": "\u003cdiv id=\"readability-page-1\" class=\"page\"\u003e\u003csection\u003e\n\t\t\t\t\u003cp\u003eMy son’s swim meet is coming up. If he’s healthy, he’ll compete.\u003c/p\u003e\u003cp\u003eMy daughter’s hockey team has a game coming up. League rules say they must forfeit if they have fewer than 10 players. There’s only 10 girls on the roster so they need everyone to be healthy to compete.\u003c/p\u003e\u003cp\u003eIn either situation, a single failure will fail the lot. With swimming there’s just one chance to get unlucky, whereas with hockey there’s ten. I’ve been thinking of these ‘opportunities to get unlucky’ as \u003cem\u003ebad luck tickets\u003c/em\u003e.\u003c/p\u003e\u003ch3 id=\"i-see-bad-luck-tickets-everywhere-\"\u003eI see bad luck tickets everywhere.\u003c/h3\u003e\u003cp\u003eWhen I was working on smaller teams, the leadership was very open and transparent with their plans and decisions. On larger teams, internal news often leaks externally! Share your plans with 1,000 people and you’ve got 1,000 chances to get unlucky.\u003c/p\u003e\u003cp\u003eI was impressed – but not surprised – by this year’s \u003ca href=\"https://arstechnica.com/security/2024/04/what-we-know-about-the-xz-utils-backdoor-that-almost-infected-the-world/\"\u003exz supply chain attack\u003c/a\u003e. If our software depends on 10 open source libraries, that’s 10 chances to be compromised by a rogue maintainer. Depend on 1,000 libraries and we’ve got 1,000 bad luck tickets.\u003c/p\u003e\u003cp\u003eOne of the backend services at my job does \u003ca href=\"https://code.cash.app/cross-shard-queries-lookup-tables\"\u003efan-out queries\u003c/a\u003e on its sharded database. Suppose you’d like to know how much money it transferred yesterday:\u003c/p\u003e\u003cpre\u003e\u003ccode\u003eSELECT SUM(amount_cents)\nFROM transactions\nWHERE DATE(sent_at) = DATE(\u0026#39;2024-11-11\u0026#39;);\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eOn a database with 64 shards, the query is executed on each shard and then aggregated. Each shard has an opportunity to fail.\u003c/p\u003e\u003ch3 id=\"the-math-is-weird-\"\u003eThe math is weird.\u003c/h3\u003e\u003cp\u003eOur database executes fan-out queries in parallel. That’s rad! But the latency of the aggregate query is the \u003cem\u003emaximum\u003c/em\u003e latency of the 64 individual shard queries. If one shard is hot because the traffic isn’t balanced, that’ll degrade all of the aggregate queries.\u003c/p\u003e\u003cp\u003eSuppose an action fails on 1 in 1,000,000 attempts. If we attempt it 1,000 times, there’s a 0.1% chance of at least one failure within those attempts\u003ca href=\"https://www.wolframalpha.com/input?i=1+-+%28%281000000-1%29%2F1000000%29%5E1000\"\u003e¹\u003c/a\u003e.\u003c/p\u003e\u003cp\u003eFailures will probably correlate (and the successes will too). Hockey players don’t get sick independently! They exhaust themselves at the same tournaments. And they share their water bottles even though I keep telling them it’s gross and they should cut it out.\u003c/p\u003e\u003ch3 id=\"limit-your-bad-luck-\"\u003eLimit your bad luck.\u003c/h3\u003e\u003cp\u003eIt’s difficult to build robust systems with fallible parts, but fallible parts is all there is. I aspire to do more with less.\u003c/p\u003e\n\t\t\t\u003c/section\u003e\u003c/div\u003e",
  "readingTime": "3 min read",
  "publishedTime": "2024-11-13T05:08:26Z",
  "modifiedTime": "2024-11-13T05:18:28Z"
}
