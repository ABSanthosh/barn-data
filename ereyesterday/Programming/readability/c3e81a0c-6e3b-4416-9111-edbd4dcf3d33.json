{
  "id": "c3e81a0c-6e3b-4416-9111-edbd4dcf3d33",
  "title": "Incident Report: Spotify Outage on April 16, 2025",
  "link": "https://engineering.atspotify.com/2025/05/incident-report-spotify-outage-on-april-16-2025/",
  "description": "On April 16, Spotify experienced an outage that affected users [...] The post Incident Report: Spotify Outage on April 16, 2025 appeared first on Spotify Engineering.",
  "author": "Spotify Engineering",
  "published": "Fri, 09 May 2025 13:47:56 +0000",
  "source": "https://labs.spotify.com/feed/",
  "categories": [
    "Infrastructure",
    "backend",
    "Mobile"
  ],
  "byline": "Spotify Engineering",
  "length": 3856,
  "excerpt": "On April 16, Spotify experienced an outage that affected users worldwide. Here is what happened and what we are going to do about it.",
  "siteName": "Spotify Engineering",
  "favicon": "https://storage.googleapis.com/production-eng/1/2021/03/cropped-Engineering-Icon-RGB-512x512-light-250x250.png",
  "text": "May 9, 2025 On April 16, Spotify experienced an outage that affected users worldwide. Here is what happened and what we are going to do about it. Context We use Envoy Proxy for our networking perimeter systems. The perimeter is the first piece of our software that receives users (your!) network traffic. It then distributes that traffic to other services. We use cloud regions to distribute that traffic sensibly across the globe.  To enhance Envoy’s capabilities, we develop and integrate our own custom filters. A specific example is our filter for rate limiting, which we discussed in detail during our recent talk at EnvoyCon 2025. What happened? On April 16 2025, between 12:20 and 15:45 UTC, we experienced an outage, affecting the majority of our users worldwide. During the incident most traffic was disrupted, except to our Asia Pacific region due to timezone differences. The graph below shows the amount of successful requests on our perimeter, the purple line is the unaffected Asia Pacific region. Graph showing the amount of successful requests on our perimeter What caused this outage? On the day of the incident we changed the order of our Envoy filters. This change was deemed low risk and as such we applied it to all regions at the same time. Changing the order triggered a bug in one of our filters which in turn caused Envoy to crash. Unlike typical isolated crashes, this crash happened simultaneously on all Envoy instances. The immediate restart of all Envoy instances, combined with client side application retry logic, created an unprecedented load spike for the perimeter. The sudden surge in traffic then exposed a misconfiguration. Envoy instances were continuously cycled by Kubernetes as the Envoy max heap size was set higher than the allowed memory limit. As soon as any new Envoy instance started up it received a very large amount of traffic, which in turn caused it to use more than the allowed Kubernetes memory limit. Kubernetes then automatically shut down the instance and the cycle repeated.  Lower traffic in our Asia Pacific region at the time of the incident, due to the difference in timezone and time of day, meant the regional Envoy memory usage never reached the kubernetes limit, which is why this region was unaffected.  The outage was mitigated by increasing the total perimeter server capacity which in turn allowed the Envoy servers to drop under the Kubernetes memory limits. This in turn stopped the continuous cycling of servers.  Timeline 12:18 UTC – Envoy filter order changed and all Envoy instances crash 12:20 UTC – Alarms are triggered indicating a significant drop of incoming traffic 12:28 UTC – Situation escalated, no traffic worldwide except for the Asia Pacific region 14:20 UTC – Traffic fully recovered in the European regions 15:10 UTC – Traffic fully recovered in the US regions 15:40 UTC – All traffic patterns back to normal Where do we go from here? We recognize the impact such  outages can have, and we’re committed to learning from it. Here are the steps we’re taking to improve our systems and prevent similar issues in the future;  We have fixed the bug causing Envoy to crash We have fixed the configuration mismatch between Envoy heap size and Kubernetes memory limits  We will improve how we roll out configuration changes to our perimeter We will improve our monitoring capabilities to be able to catch these issues sooner As we have in the past, we will continue to provide transparency on similar occasions so as to hold ourselves accountable and support ongoing improvements to our services. Tags: backend, Mobile",
  "image": "https://storage.googleapis.com/production-eng/1/2025/05/Incident_Spotify-Outage_April162025_1200-x-630-Social-sharing-for-both-sites.png",
  "html": "\u003cdiv id=\"readability-page-1\" class=\"page\"\u003e\u003csection role=\"main\" id=\"main\"\u003e\n\n                \n\n        \u003carticle id=\"post-7472\"\u003e\n    \u003cdiv\u003e\n        \n        \n\n        \u003cdiv\u003e\n            \u003cp\u003e\u003cimg src=\"https://engineering.atspotify.com/wp-content/themes/theme-spotify/images/icon.png\" alt=\"\"/\u003e\u003c/p\u003e\u003cp\u003e\u003cspan\u003eMay 9, 2025\u003c/span\u003e\n                \n            \u003c/p\u003e\n        \u003c/div\u003e\n        \n        \u003cp\u003e\u003ca href=\"https://engineering.atspotify.com/2025/05/incident-report-spotify-outage-on-april-16-2025/\" title=\"Incident Report: Spotify Outage on April 16, 2025\"\u003e\n                        \u003cimg src=\"https://storage.googleapis.com/production-eng/1/2025/05/EN182-1200-x-590-FOR-OLD-SITE.png\" alt=\"\" decoding=\"async\" fetchpriority=\"high\" srcset=\"https://storage.googleapis.com/production-eng/1/2025/05/EN182-1200-x-590-FOR-OLD-SITE.png 1200w, https://storage.googleapis.com/production-eng/1/2025/05/EN182-1200-x-590-FOR-OLD-SITE-250x123.png 250w, https://storage.googleapis.com/production-eng/1/2025/05/EN182-1200-x-590-FOR-OLD-SITE-700x344.png 700w, https://storage.googleapis.com/production-eng/1/2025/05/EN182-1200-x-590-FOR-OLD-SITE-768x378.png 768w, https://storage.googleapis.com/production-eng/1/2025/05/EN182-1200-x-590-FOR-OLD-SITE-120x59.png 120w\" sizes=\"(max-width: 1200px) 100vw, 1200px\"/\u003e                    \u003c/a\u003e\n                        \n        \u003c/p\u003e\n\n        \n\n        \n\u003cp\u003eOn April 16, Spotify experienced an outage that affected users worldwide. Here is what happened and what we are going to do about it.\u003c/p\u003e\n\n\n\n\u003ch2\u003eContext\u003c/h2\u003e\n\n\n\n\u003cp\u003eWe use \u003ca href=\"https://www.envoyproxy.io/\" target=\"_blank\" rel=\"noreferrer noopener\"\u003eEnvoy Proxy\u003c/a\u003e for our networking perimeter systems. The perimeter is the first piece of our software that receives users (your!) network traffic. It then distributes that traffic to other services. We use cloud regions to distribute that traffic sensibly across the globe. \u003c/p\u003e\n\n\n\n\u003cp\u003eTo enhance Envoy’s capabilities, we develop and integrate our own custom filters. A specific example is our filter for \u003ca href=\"https://en.wikipedia.org/wiki/Rate_limiting\" target=\"_blank\" rel=\"noreferrer noopener\"\u003erate limiting\u003c/a\u003e, which we discussed in detail during our \u003ca href=\"https://www.youtube.com/watch?v=Bof1ZAk1Ca8\" target=\"_blank\" rel=\"noreferrer noopener\"\u003erecent talk at EnvoyCon 2025\u003c/a\u003e.\u003c/p\u003e\n\n\n\n\u003ch2\u003eWhat happened?\u003c/h2\u003e\n\n\n\n\u003cp\u003eOn April 16 2025, between 12:20 and 15:45 UTC, we experienced an outage, affecting the majority of our users worldwide. During the incident most traffic was disrupted, except to our Asia Pacific region due to timezone differences. The graph below shows the amount of successful requests on our perimeter, the purple line is the unaffected Asia Pacific region.\u003c/p\u003e\n\n\n\n\u003cfigure\u003e\u003cimg decoding=\"async\" src=\"https://lh7-rt.googleusercontent.com/docsz/AD_4nXfb2TL0FzbkCI119vCd284G9eXrtWlEUsQQOzubzQ9mLIdFZ-Uc_Jovd6v7kTGzMg2k-KZkiujvu8yZLJ-rEQEbPPp_2T508astUVFGxB75TCiK3o3uH9z6S3FiL6W1Sd10xs5U-w?key=ifdKKQFeRL7GSEacZx40vsO_\" alt=\"\"/\u003e\u003c/figure\u003e\n\n\n\n\u003cp\u003e\u003cem\u003eGraph showing the amount of successful requests on our perimeter\u003c/em\u003e\u003c/p\u003e\n\n\n\n\u003ch2\u003eWhat caused this outage?\u003c/h2\u003e\n\n\n\n\u003cp\u003eOn the day of the incident we changed the order of our \u003ca href=\"https://github.com/envoyproxy/envoy/blob/main/source/docs/async_http_filters.md\" target=\"_blank\" rel=\"noreferrer noopener\"\u003eEnvoy filters\u003c/a\u003e. This change was deemed low risk and as such we applied it to all regions at the same time. Changing the order triggered a bug in one of our filters which in turn caused Envoy to crash. Unlike typical isolated crashes, this crash happened simultaneously on all Envoy instances.\u003c/p\u003e\n\n\n\n\u003cp\u003eThe immediate restart of all Envoy instances, combined with client side application retry logic, created an unprecedented load spike for the perimeter. The sudden surge in traffic then exposed a misconfiguration. Envoy instances were continuously cycled by Kubernetes as the \u003ca href=\"https://www.envoyproxy.io/docs/envoy/latest/configuration/operations/overload_manager/overload_manager\" target=\"_blank\" rel=\"noreferrer noopener\"\u003eEnvoy max heap size\u003c/a\u003e was set higher than the allowed \u003ca href=\"https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/#requests-and-limits\" target=\"_blank\" rel=\"noreferrer noopener\"\u003ememory limit\u003c/a\u003e. As soon as any new Envoy instance started up it received a very large amount of traffic, which in turn caused it to use more than the allowed Kubernetes memory limit. Kubernetes then automatically shut down the instance and the cycle repeated. \u003c/p\u003e\n\n\n\n\u003cp\u003eLower traffic in our Asia Pacific region at the time of the incident, due to the difference in timezone and time of day, meant the regional Envoy memory usage never reached the kubernetes limit, which is why this region was unaffected. \u003c/p\u003e\n\n\n\n\u003cp\u003eThe outage was mitigated by increasing the total perimeter server capacity which in turn allowed the Envoy servers to drop under the Kubernetes memory limits. This in turn stopped the continuous cycling of servers. \u003c/p\u003e\n\n\n\n\u003ch2\u003eTimeline\u003c/h2\u003e\n\n\n\n\u003cp\u003e12:18 UTC – Envoy filter order changed and all Envoy instances crash\u003c/p\u003e\n\n\n\n\u003cp\u003e12:20 UTC – Alarms are triggered indicating a significant drop of incoming traffic\u003c/p\u003e\n\n\n\n\u003cp\u003e12:28 UTC – Situation escalated, no traffic worldwide except for the Asia Pacific region\u003c/p\u003e\n\n\n\n\u003cp\u003e14:20 UTC – Traffic fully recovered in the European regions\u003c/p\u003e\n\n\n\n\u003cp\u003e15:10 UTC – Traffic fully recovered in the US regions\u003c/p\u003e\n\n\n\n\u003cp\u003e15:40 UTC – All traffic patterns back to normal\u003c/p\u003e\n\n\n\n\u003ch2\u003eWhere do we go from here?\u003c/h2\u003e\n\n\n\n\u003cp\u003eWe recognize the impact such  outages can have, and we’re committed to learning from it. Here are the steps we’re taking to improve our systems and prevent similar issues in the future; \u003c/p\u003e\n\n\n\n\u003cul\u003e\n\u003cli\u003eWe have fixed the bug causing Envoy to crash\u003c/li\u003e\n\n\n\n\u003cli\u003eWe have fixed the configuration mismatch between Envoy heap size and Kubernetes memory limits \u003c/li\u003e\n\n\n\n\u003cli\u003eWe will improve how we roll out configuration changes to our perimeter\u003c/li\u003e\n\n\n\n\u003cli\u003eWe will improve our monitoring capabilities to be able to catch these issues sooner\u003c/li\u003e\n\u003c/ul\u003e\n\n\n\n\u003cp\u003eAs we have in the past, we will continue to provide transparency on similar occasions so as to hold ourselves accountable and support ongoing improvements to our services.\u003c/p\u003e\n        \u003cp\u003e\n\n        Tags: \u003ca href=\"https://engineering.atspotify.com/tag/backend/\" rel=\"tag\"\u003ebackend\u003c/a\u003e, \u003ca href=\"https://engineering.atspotify.com/tag/mobile/\" rel=\"tag\"\u003eMobile\u003c/a\u003e\u003cbr/\u003e        \n            \u003c/p\u003e\u003c/div\u003e\n    \n\n\n\u003c/article\u003e\n        \n\n        \n        \n    \u003c/section\u003e\u003c/div\u003e",
  "readingTime": "5 min read",
  "publishedTime": "2025-05-09T13:47:56Z",
  "modifiedTime": "2025-05-09T13:53:18Z"
}
