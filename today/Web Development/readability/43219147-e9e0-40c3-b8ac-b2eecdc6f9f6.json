{
  "id": "43219147-e9e0-40c3-b8ac-b2eecdc6f9f6",
  "title": "Fixing Cumulative Layout Shift Problems on DavidWalshBlog",
  "link": "https://davidwalsh.name/fixing-cumulative-layout-shift-problems-on-davidwalshblog",
  "description": "Over 50 thousand developers visit DavidWalshBlog every month from around the world to learn JavaScript tricks and fix problems in their code. Unfortunately, some of them have a slow experience on the site. David tracks the performance of his Core Web Vitals and overall performance with Request Metrics. Recently, we noticed that his CLS performance […] The post Fixing Cumulative Layout Shift Problems on DavidWalshBlog appeared first on David Walsh Blog.",
  "author": "Todd Gardner",
  "published": "Wed, 24 Jan 2024 11:56:41 +0000",
  "source": "https://davidwalsh.name/feed",
  "categories": [
    "Optimization",
    "Performance"
  ],
  "byline": "David Walsh",
  "length": 6147,
  "excerpt": "Over 50 thousand developers visit DavidWalshBlog every month from around the world to learn JavaScript tricks and fix problems in their code.",
  "siteName": "David Walsh Blog",
  "favicon": "https://davidwalsh.name/wp-content/themes/punky/images/favicon-144.png",
  "text": "Over 50 thousand developers visit DavidWalshBlog every month from around the world to learn JavaScript tricks and fix problems in their code. Unfortunately, some of them have a slow experience on the site. David tracks the performance of his Core Web Vitals and overall performance with Request Metrics. Recently, we noticed that his CLS performance score was trending pretty slow for both desktop and mobile users. Wait, what is CLS? Cumulative Layout Shift (CLS) is one of the Core Web Vital performance metrics. It doesn't measure load time directly, instead it measures how much a page shifts while it is being loaded. You've definitely seen this and been annoyed by it. These shifts make a site feel slow to a user. CLS and the rest of the Core Web Vitals are super important. Not only because they measure user experience, but also because they influence the pagerank of a site in search. And search traffic is life for bloggers, media sites, e-commerce stores, and pretty much everyone with a website. If we can fix the site's CLS problem, we'll give readers a faster experience, and boost the search ranking so David can help even more people. Sounds like a great incentive, let's figure it out. Crashing with Google Lighthouse To find a performance problem, many developers will use a tool like Google Lighthouse. I ran a Lighthouse report on David's site, and here's what I got. A perfect score! Let's pack it up and go home. The trouble is that Google Lighthouse is a lie. Real users won't have this performance. That score only represents a single test, from my lightning-fast computer, in the USA, on a fast broadband connection. David's real users come from all over the world, on varying devices and networks, and at all times of the day. Their performance experience is far from perfect. That's why we need to get real user monitoring for the performance, otherwise we might never know that there is a problem. Where are the CLS problems? David has been writing for a long time and has hundreds of posts on his site. Request Metrics tracks the CLS score per page so we can zero-in on the problems. The largest traffic page is the root page, and that has a good CLS. But many of his posts, like Play Grand Poo World and Pornhub Interview have troubling CLS scores. We can also track the elements responsible for CLS, and for most of the posts its main \u003e article \u003e p. That means the first paragraph of the article is the thing shifting. Why would it do that? What is common about these posts with the worst CLS scores? Images. Images are a very common cause of CLS problems because a browser doesn't always know how big an image is until it's downloaded. The browser assumes it's 0x0 until it has the image, then shifts everything around it to make room. Posts with lots of images would shift many times as each image was downloaded and the article shifted to make room for the new content. Using images correctly for CLS To avoid layout shifts when using images, we need to give the browser hints about how big the images will be. The browser will use these hints to reserve space in the layout for the image when it's finished downloading. \u003cimg src=\"/path/to/image\" width=\"300\" height=\"100\" /\u003e Notice that the width and height are specified as their own attributes — not part of a style tag. These attributes set both a base size of the image as well as the aspect ratio to use. You can still use CSS to make the image bigger or smaller from here. Also notice that there is no px unit specified. Image Sizes in WordPress DavidWalsh.name is hosted on WordPress, where there are some built-in tools to do this. We can utilize wp_image_src_get_dimensions to get the dimensions of images he's using and add them to the markup. Proving it works David made the image changes a few days ago, and we're already seeing an improvement. CLS has dropped 20% to 0.123. We're real close to the “Good” range of CLS now. There's still some issues to sort out around fonts, but that will be a story for another time and another post. If you're looking to improve the real performance of your site, or worried about losing your SEO juice from Core Web Vital problems, have a look at Request Metrics. It's got the tools to track your performance and actionable tips to actually fix the problems. Plus it's free, so it's got that going for it. About Todd GardnerTodd Gardner is a software entrepreneur and developer who has built multiple profitable products. He pushes for simple tools, maintainable software, and balancing complexity with risk. He is the cofounder of TrackJS and Request Metrics, where he helps thousands of developers build faster and more reliable websites. He also produces the PubConf software comedy show.toddhgardner.comtoddhgardnerPostsRecent Features39 Shirts – Leaving MozillaIn 2001 I had just graduated from a small town high school and headed off to a small town college. I found myself in the quaint computer lab where the substandard computers featured two browsers: Internet Explorer and Mozilla. It was this lab where I fell...Creating Scrolling Parallax Effects with CSSIntroduction For quite a long time now websites with the so called \"parallax\" effect have been really popular. In case you have not heard of this effect, it basically includes different layers of images that are moving in different directions or with different speed. This leads to a...Incredible DemosFixing sIFR Printing with CSS and MooToolsWhile I'm not a huge sIFR advocate I can understand its allure. A customer recently asked us to implement sIFR on their website but I ran into a problem: the sIFR headings wouldn't print because they were Flash objects. Here's how to fix...CSS Selection StylingThe goal of CSS is to allow styling of content and structure within a web page.  We all know that, right?  As CSS revisions arrive, we're provided more opportunity to control.  One of the little known styling option available within the browser is text selection styling.",
  "image": "https://davidwalsh.name/demo/2024/01/image-4-1024x376.png",
  "html": "\u003cdiv id=\"readability-page-1\" class=\"page\"\u003e\u003carticle itemscope=\"\" itemtype=\"http://schema.org/Article\"\u003e\n\u003cp\u003eOver 50 thousand developers visit DavidWalshBlog every month from around the world to learn JavaScript tricks and fix problems in their code. Unfortunately, some of them have a slow experience on the site.\u003c/p\u003e\n\n\n\n\u003cp\u003eDavid tracks the performance of his Core Web Vitals and overall performance with \u003ca href=\"https://requestmetrics.com/?utm_source=davidwalsh_content\"\u003eRequest Metrics\u003c/a\u003e. Recently, we noticed that his CLS performance score was trending pretty slow for both desktop and mobile users.\u003c/p\u003e\n\n\n\n\u003cfigure\u003e\u003cimg src=\"https://davidwalsh.name/demo/2024/01/image-4-1024x376.png\" alt=\"\"/\u003e\u003c/figure\u003e\n\n\n\n\u003ch2 id=\"Wait, what is CLS?\"\u003eWait, what is CLS?\u003c/h2\u003e\n\n\n\n\u003cp\u003e\u003ca href=\"https://requestmetrics.com/web-performance/cumulative-layout-shift/?utm_source=davidwalsh_content\"\u003eCumulative Layout Shift\u003c/a\u003e (CLS) is one of the \u003ca href=\"https://requestmetrics.com/core-web-vitals/?utm_source=davidwalsh_content\"\u003eCore Web Vital\u003c/a\u003e performance metrics. It doesn\u0026#39;t measure load time directly, instead it measures how much a page \u003ci\u003eshifts\u003c/i\u003e while it is being loaded. You\u0026#39;ve definitely seen this and been annoyed by it. These shifts make a site \u003ci\u003efeel\u003c/i\u003e slow to a user.\u003c/p\u003e\n\n\n\n\u003cp\u003eCLS and the rest of the Core Web Vitals are super important. Not only because they measure user experience, but also because they influence the pagerank of a site in search. And search traffic is life for bloggers, media sites, e-commerce stores, and pretty much everyone with a website.\u003c/p\u003e\n\n\n\n\u003cp\u003eIf we can fix the site\u0026#39;s CLS problem, we\u0026#39;ll give readers a faster experience, and boost the search ranking so David can help even more people. Sounds like a great incentive, let\u0026#39;s figure it out.\u003c/p\u003e\n\n\n\n\u003ch2 id=\"Crashing with Google Lighthouse\"\u003eCrashing with Google Lighthouse\u003c/h2\u003e\n\n\n\n\u003cp\u003eTo find a performance problem, many developers will use a tool like Google Lighthouse. I ran a Lighthouse report on David\u0026#39;s site, and here\u0026#39;s what I got.\u003c/p\u003e\n\n\n\n\u003cfigure\u003e\u003cimg src=\"https://davidwalsh.name/demo/2024/01/image-3-1024x728.png\" alt=\"\"/\u003e\u003c/figure\u003e\n\n\n\n\u003cp\u003eA perfect score! Let\u0026#39;s pack it up and go home.\u003c/p\u003e\n\n\n\n\u003cp\u003eThe trouble is that \u003cb\u003eGoogle Lighthouse is a lie\u003c/b\u003e. Real users won\u0026#39;t have this performance. That score only represents a single test, from my lightning-fast computer, in the USA, on a fast broadband connection.\u003c/p\u003e\n\n\n\n\u003cp\u003eDavid\u0026#39;s real users come from all over the world, on varying devices and networks, and at all times of the day. Their performance experience is far from perfect. That\u0026#39;s why we need to get \u003ca href=\"https://requestmetrics.com/real-user-monitoring/?utm_source=davidwalsh_content\"\u003ereal user monitoring\u003c/a\u003e for the performance, otherwise we might never know that there is a problem.\u003c/p\u003e\n\n\n\n\u003ch2 id=\"Where are the CLS problems?\"\u003eWhere are the CLS problems?\u003c/h2\u003e\n\n\n\n\u003cp\u003eDavid has been writing for a long time and has hundreds of posts on his site. Request Metrics tracks the CLS score per page so we can zero-in on the problems.\u003c/p\u003e\n\n\n\n\u003cfigure\u003e\u003cimg src=\"https://davidwalsh.name/demo/2024/01/image-2-1024x521.png\" alt=\"\"/\u003e\u003c/figure\u003e\n\n\n\n\u003cp\u003eThe largest traffic page is the root page, and that has a good CLS. But many of his posts, like \u003ca href=\"https://davidwalsh.name/play-grand-poo-world-3\"\u003ePlay Grand Poo World\u003c/a\u003e and \u003ca href=\"https://davidwalsh.name/pornhub-interview\"\u003ePornhub Interview\u003c/a\u003e have troubling CLS scores. We can also track the elements responsible for CLS, and for most of the posts its \u003ccode\u003emain \u0026gt; article \u0026gt; p\u003c/code\u003e. That means the first paragraph of the article is the thing shifting. Why would it do that?\u003c/p\u003e\n\n\n\n\u003cp\u003eWhat is common about these posts with the worst CLS scores? Images. Images are a very common cause of CLS problems because a browser doesn\u0026#39;t always know how big an image is until it\u0026#39;s downloaded. The browser assumes it\u0026#39;s 0x0 until it has the image, then \u003ci\u003eshifts\u003c/i\u003e everything around it to make room.\u003c/p\u003e\n\n\n\n\u003cp\u003ePosts with lots of images would shift many times as each image was downloaded and the article shifted to make room for the new content.\u003c/p\u003e\n\n\n\n\u003ch2 id=\"Using images correctly for CLS\"\u003eUsing images correctly for CLS\u003c/h2\u003e\n\n\n\n\u003cp\u003eTo avoid layout shifts when using images, we need to give the browser hints about how big the images will be. The browser will use these hints to reserve space in the layout for the image when it\u0026#39;s finished downloading.\u003c/p\u003e\n\n\n\n\u003cpre\u003e\u0026lt;img src=\u0026#34;/path/to/image\u0026#34; width=\u0026#34;300\u0026#34; height=\u0026#34;100\u0026#34; /\u0026gt;\n\u003c/pre\u003e\n\n\n\n\u003cp\u003eNotice that the width and height are specified as their own attributes — not part of a style tag. These attributes set both a base size of the image as well as the aspect ratio to use. You can still use CSS to make the image bigger or smaller from here.\u003c/p\u003e\n\n\n\n\u003cp\u003eAlso notice that there is no \u003ccode\u003epx\u003c/code\u003e unit specified.\u003c/p\u003e\n\n\n\n\u003ch3 id=\"Image Sizes in WordPress\"\u003eImage Sizes in WordPress\u003c/h3\u003e\n\n\n\n\u003cp\u003eDavidWalsh.name is hosted on WordPress, where there are some built-in tools to do this. We can utilize \u003ca href=\"https://developer.wordpress.org/reference/functions/wp_image_src_get_dimensions/\"\u003e\u003ccode\u003ewp_image_src_get_dimensions\u003c/code\u003e\u003c/a\u003e to get the dimensions of images he\u0026#39;s using and add them to the markup.\u003c/p\u003e\n\n\n\n\u003ch2 id=\"Proving it works\"\u003eProving it works\u003c/h2\u003e\n\n\n\n\u003cp\u003eDavid made the image changes a few days ago, and we\u0026#39;re already seeing an improvement. CLS has dropped 20% to 0.123. We\u0026#39;re real close to the “Good” range of CLS now.\u003c/p\u003e\n\n\n\n\u003cfigure\u003e\u003cimg src=\"https://davidwalsh.name/demo/2024/01/image-1024x280.png\" alt=\"\"/\u003e\u003c/figure\u003e\n\n\n\n\u003cp\u003eThere\u0026#39;s still some issues to sort out around fonts, but that will be a story for another time and another post.\u003c/p\u003e\n\n\n\n\u003cp\u003eIf you\u0026#39;re looking to improve the real performance of your site, or worried about losing your SEO juice from Core Web Vital problems, have a look at \u003ca href=\"https://requestmetrics.com/?utm_source=davidwalsh_content\"\u003eRequest Metrics\u003c/a\u003e. It\u0026#39;s got the tools to track your performance and actionable tips to actually fix the problems.\u003c/p\u003e\n\n\n\n\u003cp\u003ePlus it\u0026#39;s free, so it\u0026#39;s got that going for it.\u003c/p\u003e\n\n\n\n\u003cdiv\u003e\n    \n    \n    \u003cp\u003e\u003ca href=\"https://requestmetrics.com/?utm_source=davidwalsh\"\u003e\n        \u003cimg src=\"https://davidwalsh.name/demo/rm_perf_banner-728.min.svg\" alt=\"Request Metrics real user monitoring\" loading=\"lazy\" width=\"728\" height=\"90\"/\u003e\n    \u003c/a\u003e\n    \u003c/p\u003e\n    \u003cp\u003e\u003ca href=\"https://requestmetrics.com/?utm_source=davidwalsh\"\u003e\n        \u003cimg src=\"https://davidwalsh.name/demo/rm_perf_block_300.min.svg\" alt=\"Request Metrics real user monitoring\" loading=\"lazy\" width=\"300\" height=\"250\"/\u003e\n    \u003c/a\u003e\n    \u003c/p\u003e\n\u003c/div\u003e\n\n\n\n\n\n\u003cdiv id=\"gb-bio\"\u003e\u003cp\u003e\u003cimg data-src=\"https://davidwalsh.name/demo/todd-new.jpeg\" alt=\"Todd Gardner\" src=\"https://davidwalsh.name/demo/todd-new.jpeg\"/\u003e\u003c/p\u003e\u003ch3\u003eAbout Todd Gardner\u003c/h3\u003e\u003cp\u003eTodd Gardner is a software entrepreneur and developer who has built multiple profitable products. He pushes for simple tools, maintainable software, and balancing complexity with risk. He is the cofounder of TrackJS and Request Metrics, where he helps thousands of developers build faster and more reliable websites. He also produces the PubConf software comedy show.\u003c/p\u003e\u003cp\u003e\u003ca href=\"https://toddhgardner.com/\"\u003etoddhgardner.com\u003c/a\u003e\u003ca href=\"https://twitter.com/toddhgardner\"\u003etoddhgardner\u003c/a\u003e\u003ca href=\"https://davidwalsh.name/author/toddhgardner\"\u003ePosts\u003c/a\u003e\u003c/p\u003e\u003c/div\u003e\u003c/article\u003e\u003cdiv\u003e\u003ch2\u003e\u003ca href=\"https://davidwalsh.name/tutorials/features\"\u003eRecent Features\u003ci\u003e\u003c/i\u003e\u003c/a\u003e\u003c/h2\u003e\u003cul\u003e\u003cli data-url=\"https://davidwalsh.name/leaving-mozilla\" itemscope=\"\" itemtype=\"http://schema.org/Article\"\u003e\u003cspan itemscope=\"\" itemtype=\"https://schema.org/ImageObject\"\u003e\u003cimg data-src=\"https://davidwalsh.name/demo/mozilla-shirts.jpeg?preview\" alt=\"39 Shirts \u0026amp;#8211; Leaving Mozilla\" src=\"https://davidwalsh.name/demo/mozilla-shirts.jpeg?preview\"/\u003e\u003c/span\u003e\u003cdiv\u003e\u003ch3 itemprop=\"name\"\u003e\u003ca href=\"https://davidwalsh.name/leaving-mozilla\" itemprop=\"url\"\u003e39 Shirts – Leaving Mozilla\u003c/a\u003e\u003c/h3\u003e\u003cp\u003eIn 2001 I had just graduated from a small town high school and headed off to a small town college. I found myself in the quaint computer lab where the substandard computers featured two browsers: Internet Explorer and Mozilla. It was this lab where I fell...\u003c/p\u003e\u003c/div\u003e\u003c/li\u003e\u003cli data-url=\"https://davidwalsh.name/parallax\" itemscope=\"\" itemtype=\"http://schema.org/Article\"\u003e\u003cspan itemscope=\"\" itemtype=\"https://schema.org/ImageObject\"\u003e\u003cimg data-src=\"https://davidwalsh.name/demo/stefan.jpeg?preview\" alt=\"Creating Scrolling Parallax Effects with CSS\" src=\"https://davidwalsh.name/demo/stefan.jpeg?preview\"/\u003e\u003c/span\u003e\u003cdiv\u003e\u003ch3 itemprop=\"name\"\u003e\u003ca href=\"https://davidwalsh.name/parallax\" itemprop=\"url\"\u003eCreating Scrolling Parallax Effects with CSS\u003c/a\u003e\u003c/h3\u003e\u003cp\u003eIntroduction\nFor quite a long time now websites with the so called \u0026#34;parallax\u0026#34; effect have been really popular.\nIn case you have not heard of this effect, it basically includes different layers of images that are moving in different directions or with different speed. This leads to a...\u003c/p\u003e\u003c/div\u003e\u003c/li\u003e\u003c/ul\u003e\u003c/div\u003e\u003cdiv\u003e\u003ch2\u003e\u003ca href=\"https://davidwalsh.name/tutorials/demos\"\u003eIncredible Demos\u003ci\u003e\u003c/i\u003e\u003c/a\u003e\u003c/h2\u003e\u003cul\u003e\u003cli data-url=\"https://davidwalsh.name/sifr-print-css-mootools\" itemscope=\"\" itemtype=\"http://schema.org/Article\"\u003e\u003cspan itemscope=\"\" itemtype=\"https://schema.org/ImageObject\"\u003e\u003cimg data-src=\"/demo/css3logo250.jpg?preview\" alt=\"Fixing sIFR Printing with CSS and MooTools\" src=\"https://davidwalsh.name/demo/css3logo250.jpg?preview\"/\u003e\u003c/span\u003e\u003cdiv\u003e\u003ch3 itemprop=\"name\"\u003e\u003ca href=\"https://davidwalsh.name/sifr-print-css-mootools\" itemprop=\"url\"\u003eFixing sIFR Printing with CSS and MooTools\u003c/a\u003e\u003c/h3\u003e\u003cp\u003eWhile I\u0026#39;m not a huge sIFR advocate I can understand its allure.  A customer recently asked us to implement sIFR on their website but I ran into a problem:  the sIFR headings wouldn\u0026#39;t print because they were Flash objects.  Here\u0026#39;s how to fix...\u003c/p\u003e\u003c/div\u003e\u003c/li\u003e\u003cli data-url=\"https://davidwalsh.name/css-selection\" itemscope=\"\" itemtype=\"http://schema.org/Article\"\u003e\u003cspan itemscope=\"\" itemtype=\"https://schema.org/ImageObject\"\u003e\u003cimg data-src=\"/demo/css3logo250.jpg?preview\" alt=\"CSS Selection Styling\" src=\"https://davidwalsh.name/demo/css3logo250.jpg?preview\"/\u003e\u003c/span\u003e\u003cdiv\u003e\u003ch3 itemprop=\"name\"\u003e\u003ca href=\"https://davidwalsh.name/css-selection\" itemprop=\"url\"\u003eCSS Selection Styling\u003c/a\u003e\u003c/h3\u003e\u003cp\u003eThe goal of CSS is to allow styling of content and structure within a web page.  We all know that, right?  As CSS revisions arrive, we\u0026#39;re provided more opportunity to control.  One of the little known styling option available within the browser is text selection styling.\u003c/p\u003e\u003c/div\u003e\u003c/li\u003e\u003c/ul\u003e\u003c/div\u003e\u003c/div\u003e",
  "readingTime": "7 min read",
  "publishedTime": "2024-01-24T11:56:41Z",
  "modifiedTime": "2024-01-24T16:49:15Z"
}
