{
  "id": "c4662d95-6214-49cf-98bc-7f30f02f9799",
  "title": "Improving Search Ranking for Maps",
  "link": "https://medium.com/airbnb-engineering/improving-search-ranking-for-maps-13b03f2c2cca?source=rss----53c7c27702d5---4",
  "description": "",
  "author": "Malay Haldar",
  "published": "Wed, 18 Dec 2024 18:02:37 GMT",
  "source": "https://medium.com/feed/airbnb-engineering",
  "categories": [
    "machine-learning",
    "data-science",
    "engineering",
    "artificial-intelligence",
    "technology"
  ],
  "byline": "Malay Haldar",
  "length": 6738,
  "excerpt": "Search is the core mechanism that connects guests with Hosts at Airbnb. Results from a guest’s search for listings are displayed through two interfaces: (1) as a list of rectangular cards that…",
  "siteName": "The Airbnb Tech Blog",
  "favicon": "https://miro.medium.com/v2/resize:fill:1000:1000/7*GAOKVe--MXbEJmV9230oOQ.png",
  "text": "How Airbnb is adapting ranking for our map interface.Malay Haldar, Hongwei Zhang, Kedar Bellare Sherry ChenSearch is the core mechanism that connects guests with Hosts at Airbnb. Results from a guest’s search for listings are displayed through two interfaces: (1) as a list of rectangular cards that contain the listing image, price, rating, and other details on it, referred to as list-results and (2) as oval pins on a map showing the listing price, called map-results. Since its inception, the core of the ranking algorithm that powered both these interfaces was the same — ordering listings by their booking probabilities and selecting the top listings for display.But some of the basic assumptions underlying ranking, built for a world where search results are presented as lists, simply break down for maps.What Is Different About Maps?The central concept that drives ranking for list-results is that user attention decays starting from the top of the list, going down towards the bottom. A plot of rank vs click-through rates in Figure 1 illustrates this concept. X-axis represents the rank of listings in search results. Y-axis represents the click-through rate (CTR) for listings at the particular rank.Figure 1: Click-through rates by listing search rankTo maximize the connections between guests and Hosts, the ranking algorithm sorts listings by their booking probabilities based on a number of factors and sequentially assigns their position in the list-results. This often means that the larger a listing’s booking probability, the more attention it receives from searchers.But in map-results, listings are scattered as pins over an area (see Figure 2). There is no ranked list, and there is no decay of user attention by ranking position. Therefore, for listings that are shown on the map, the strategy of sorting by booking probabilities is no longer applicable.Figure 2: Map resultsUniform User AttentionTo adapt ranking to the map interface, we look at new ways of modeling user attention flow across a map. We start with the most straightforward assumption that user attention is spread equally across the map pins. User attention is a very precious commodity and most searchers only click through a few map pins (see Figure 3). A large number of pins on the map means those limited clicks may miss discovering the best options available. Conversely, limiting the number of pins to the topmost choices increases the probability of the searcher finding something suitable, but runs the risk of removing their preferred choice.Figure 3: Number of distinct map pins clicked by percentage of searchersWe test this hypothesis, controlled by a parameter . The parameter serves as an upper bound on the ratio of the highest booking probability vs the lowest booking probability when selecting the map pins. The bounds set by the parameter controls the booking probability of the listings behind the map pins. The more restricted the bounds, the higher the average booking probability of the listings presented as map pins. Figure 4 summarizes the results from A/B testing a range of parameters.The reduction in the average impressions to discovery metric in Figure 4 denotes the fewer number of map pins a searcher has to process before clicking the listing that they eventually book. Similarly, the reduction in average clicks to discovery shows the fewer number of map pins a searcher has to click through to find the listing they booked.Figure 4: Exploring through online A/B experimentsLaunching the restricted version resulted in one of the largest bookings improvement in Airbnb ranking history. More importantly, the gains were not only for bookings, but for quality bookings. This could be seen by the increase in trips that resulted in 5-star rating after the stay from the treatment group, in comparison to trips from the control group.Tiered User AttentionIn our next iteration of modeling user attention, we separate the map pins into two tiers. The listings with the highest booking probabilities are displayed as regular oval pins with price. Listings with comparatively lower booking probabilities are displayed as smaller ovals without price, referred to as mini-pins (Figure 5). By design, mini-pins draw less user attention, with click-through rates about 8x less than regular pins.Figure 5: Oval pins with price and mini-pinsThis comes in handy particularly for searches on desktop where 18 results are shown in a grid on the left, each of them requiring a map pin on the right (Figure 6).Figure 6: Search results on desktopThe number of map pins is fixed in this case, and limiting them, as we did in the previous section, is not an option. Creating the two tiers prioritizes user attention towards the map pins with the highest probabilities of getting booked. Figure 7 shows the results of testing the idea through an online A/B experiment.Figure 7: Experiment results for tiered map pinsDiscounted User AttentionIn our final iteration, we refine our understanding of how user attention is distributed over the map by plotting the click-through rate of map pins located at different coordinates on the map. Figure 8 shows these plots for the mobile (top) and the desktop apps (bottom).Figure 8: Click-through rates of map pins across map coordinates.To maximize the chances that a searcher will discover the listings with the highest booking probabilities, we design an algorithm that re-centers the map such that the listings with the highest booking probabilities appear closer to the center. The steps of this algorithm are illustrated in Figure 9, where a range of potential coordinates are evaluated and the one which is closer to the listings with the highest booking probabilities is chosen as the new center.Figure 9: Algorithm for finding optimal centerWhen tested in an online A/B experiment, the algorithm improved uncancelled bookings by 0.27%. We also observed a reduction of 1.5% in map moves, indicating less effort from the searchers to use the map.ConclusionUsers interact with maps in a way that’s fundamentally different from interacting with items in a list. By modeling the user interaction with maps in a progressively sophisticated manner, we were able to improve the user experience for guests in the real world. However, the current approach has a challenge that remains unsolved: how can we represent the full range of available listings on the map? This is part of our future work. A more in-depth discussion of the topics covered here, along with technical details, is presented in our research paper that was published at the KDD ’24 conference. We welcome all feedback and suggestions.If this type of work interests you, we encourage you to apply for an open position today.",
  "image": "https://miro.medium.com/v2/da:true/resize:fit:1200/0*DO7m1JZFPSvVRlBG",
  "html": "\u003cdiv id=\"readability-page-1\" class=\"page\"\u003e\u003cdiv\u003e\u003cdiv\u003e\u003cdiv aria-hidden=\"false\"\u003e\u003ca rel=\"noopener follow\" href=\"https://medium.com/@malay-haldar?source=post_page---byline--13b03f2c2cca---------------------------------------\"\u003e\u003cdiv\u003e\u003cp\u003e\u003cimg alt=\"Malay Haldar\" src=\"https://miro.medium.com/v2/resize:fill:88:88/1*ZjSdfj1GMj5YQjyhbnin-A.jpeg\" width=\"44\" height=\"44\" loading=\"lazy\" data-testid=\"authorPhoto\"/\u003e\u003c/p\u003e\u003c/div\u003e\u003c/a\u003e\u003c/div\u003e\u003cdiv aria-hidden=\"false\"\u003e\u003ca href=\"https://medium.com/airbnb-engineering?source=post_page---byline--13b03f2c2cca---------------------------------------\" rel=\"noopener follow\"\u003e\u003cdiv\u003e\u003cp\u003e\u003cimg alt=\"The Airbnb Tech Blog\" src=\"https://miro.medium.com/v2/resize:fill:48:48/1*MlNQKg-sieBGW5prWoe9HQ.jpeg\" width=\"24\" height=\"24\" loading=\"lazy\" data-testid=\"publicationPhoto\"/\u003e\u003c/p\u003e\u003c/div\u003e\u003c/a\u003e\u003c/div\u003e\u003c/div\u003e\u003cp id=\"b93d\"\u003eHow Airbnb is adapting ranking for our map interface.\u003c/p\u003e\u003cfigure\u003e\u003c/figure\u003e\u003cp id=\"2f0e\"\u003e\u003ca href=\"https://www.linkedin.com/in/malayhaldar/\" rel=\"noopener ugc nofollow\" target=\"_blank\"\u003eMalay Haldar\u003c/a\u003e, \u003ca href=\"https://www.linkedin.com/in/hongwei-zhang-86b15624/\" rel=\"noopener ugc nofollow\" target=\"_blank\"\u003eHongwei Zhang\u003c/a\u003e, \u003ca href=\"https://www.linkedin.com/in/kedar-bellare-3048128a/\" rel=\"noopener ugc nofollow\" target=\"_blank\"\u003eKedar Bellare\u003c/a\u003e \u003ca href=\"https://www.linkedin.com/in/sherrytchen/\" rel=\"noopener ugc nofollow\" target=\"_blank\"\u003eSherry Chen\u003c/a\u003e\u003c/p\u003e\u003cp id=\"d1b7\"\u003eSearch is the core mechanism that connects guests with Hosts at Airbnb. Results from a guest’s search for listings are displayed through two interfaces: (1) as a list of rectangular cards that contain the listing image, price, rating, and other details on it, referred to as \u003cem\u003elist-results\u003c/em\u003e and (2) as oval pins on a map showing the listing price, called \u003cem\u003emap-results\u003c/em\u003e. Since its inception, the core of the ranking algorithm that powered both these interfaces was the same — ordering listings by their booking probabilities and selecting the top listings for display.\u003c/p\u003e\u003cp id=\"087b\"\u003eBut some of the basic assumptions underlying ranking, built for a world where search results are presented as lists, simply break down for maps.\u003c/p\u003e\u003ch2 id=\"6fc0\"\u003eWhat Is Different About Maps?\u003c/h2\u003e\u003cp id=\"0926\"\u003eThe central concept that drives ranking for list-results is that \u003cem\u003euser attention decays\u003c/em\u003e starting from the top of the list, going down towards the bottom. A plot of rank vs click-through rates in Figure 1 illustrates this concept. X-axis represents the rank of listings in search results. Y-axis represents the click-through rate (CTR) for listings at the particular rank.\u003c/p\u003e\u003cfigure\u003e\u003cfigcaption\u003eFigure 1: Click-through rates by listing search rank\u003c/figcaption\u003e\u003c/figure\u003e\u003cp id=\"b486\"\u003eTo maximize the connections between guests and Hosts, the ranking algorithm sorts listings by their booking probabilities based on a \u003ca href=\"https://www.airbnb.com/help/article/39\" rel=\"noopener ugc nofollow\" target=\"_blank\"\u003enumber of factors\u003c/a\u003e and sequentially assigns their position in the list-results. This often means that the larger a listing’s booking probability, the more attention it receives from searchers.\u003c/p\u003e\u003cp id=\"a432\"\u003eBut in map-results, listings are scattered as pins over an area (see Figure 2). There is no ranked list, and there is no decay of user attention by ranking position. Therefore, for listings that are shown on the map, the strategy of sorting by booking probabilities is no longer applicable.\u003c/p\u003e\u003cfigure\u003e\u003cfigcaption\u003eFigure 2: Map results\u003c/figcaption\u003e\u003c/figure\u003e\u003ch2 id=\"6eef\"\u003eUniform User Attention\u003c/h2\u003e\u003cp id=\"dade\"\u003eTo adapt ranking to the map interface, we look at new ways of modeling user attention flow across a map. We start with the most straightforward assumption that user attention is spread equally across the map pins. User attention is a very precious commodity and most searchers only click through a few map pins (see Figure 3). A large number of pins on the map means those limited clicks may miss discovering the best options available. Conversely, limiting the number of pins to the topmost choices increases the probability of the searcher finding something suitable, but runs the risk of removing their preferred choice.\u003c/p\u003e\u003cfigure\u003e\u003cfigcaption\u003eFigure 3: Number of distinct map pins clicked by percentage of searchers\u003c/figcaption\u003e\u003c/figure\u003e\u003cp id=\"e5b2\"\u003eWe test this hypothesis, controlled by a parameter . The parameter serves as an upper bound on the ratio of the highest booking probability vs the lowest booking probability when selecting the map pins. The bounds set by the parameter controls the booking probability of the listings behind the map pins. The more restricted the bounds, the higher the average booking probability of the listings presented as map pins. Figure 4 summarizes the results from A/B testing a range of parameters.\u003c/p\u003e\u003cp id=\"458a\"\u003eThe reduction in the average impressions to discovery metric in Figure 4 denotes the fewer number of map pins a searcher has to process before clicking the listing that they eventually book. Similarly, the reduction in average clicks to discovery shows the fewer number of map pins a searcher has to click through to find the listing they booked.\u003c/p\u003e\u003cfigure\u003e\u003cfigcaption\u003eFigure 4: Exploring through online A/B experiments\u003c/figcaption\u003e\u003c/figure\u003e\u003cp id=\"d078\"\u003eLaunching the restricted version resulted in one of the largest bookings improvement in Airbnb ranking history. More importantly, the gains were not only for bookings, but for quality bookings. This could be seen by the increase in trips that resulted in 5-star rating after the stay from the treatment group, in comparison to trips from the control group.\u003c/p\u003e\u003ch2 id=\"ca47\"\u003eTiered User Attention\u003c/h2\u003e\u003cp id=\"51d7\"\u003eIn our next iteration of modeling user attention, we separate the map pins into two tiers. The listings with the highest booking probabilities are displayed as regular oval pins with price. Listings with comparatively lower booking probabilities are displayed as smaller ovals without price, referred to as mini-pins (Figure 5). By design, mini-pins draw less user attention, with click-through rates about 8x less than regular pins.\u003c/p\u003e\u003cfigure\u003e\u003cfigcaption\u003eFigure 5: Oval pins with price and mini-pins\u003c/figcaption\u003e\u003c/figure\u003e\u003cp id=\"b9d7\"\u003eThis comes in handy particularly for searches on desktop where 18 results are shown in a grid on the left, each of them requiring a map pin on the right (Figure 6).\u003c/p\u003e\u003cfigure\u003e\u003cfigcaption\u003eFigure 6: Search results on desktop\u003c/figcaption\u003e\u003c/figure\u003e\u003cp id=\"86f1\"\u003eThe number of map pins is fixed in this case, and limiting them, as we did in the previous section, is not an option. Creating the two tiers prioritizes user attention towards the map pins with the highest probabilities of getting booked. Figure 7 shows the results of testing the idea through an online A/B experiment.\u003c/p\u003e\u003cfigure\u003e\u003cfigcaption\u003eFigure 7: Experiment results for tiered map pins\u003c/figcaption\u003e\u003c/figure\u003e\u003ch2 id=\"ab81\"\u003eDiscounted User Attention\u003c/h2\u003e\u003cp id=\"f6ee\"\u003eIn our final iteration, we refine our understanding of how user attention is distributed over the map by plotting the click-through rate of map pins located at different coordinates on the map. Figure 8 shows these plots for the mobile (top) and the desktop apps (bottom).\u003c/p\u003e\u003cfigure\u003e\u003c/figure\u003e\u003cfigure\u003e\u003cfigcaption\u003eFigure 8: Click-through rates of map pins across map coordinates.\u003c/figcaption\u003e\u003c/figure\u003e\u003cp id=\"66fc\"\u003eTo maximize the chances that a searcher will discover the listings with the highest booking probabilities, we design an algorithm that re-centers the map such that the listings with the highest booking probabilities appear closer to the center. The steps of this algorithm are illustrated in Figure 9, where a range of potential coordinates are evaluated and the one which is closer to the listings with the highest booking probabilities is chosen as the new center.\u003c/p\u003e\u003cfigure\u003e\u003cfigcaption\u003eFigure 9: Algorithm for finding optimal center\u003c/figcaption\u003e\u003c/figure\u003e\u003cp id=\"c53d\"\u003eWhen tested in an online A/B experiment, the algorithm improved uncancelled bookings by 0.27%. We also observed a reduction of 1.5% in map moves, indicating less effort from the searchers to use the map.\u003c/p\u003e\u003ch2 id=\"9615\"\u003eConclusion\u003c/h2\u003e\u003cp id=\"95a0\"\u003eUsers interact with maps in a way that’s fundamentally different from interacting with items in a list. By modeling the user interaction with maps in a progressively sophisticated manner, we were able to improve the user experience for guests in the real world. However, the current approach has a challenge that remains unsolved: how can we represent the full range of available listings on the map? This is part of our future work. A more in-depth discussion of the topics covered here, along with technical details, is presented in our research paper that was \u003ca href=\"https://arxiv.org/pdf/2407.00091\" rel=\"noopener ugc nofollow\" target=\"_blank\"\u003epublished at the \u003cstrong\u003eKDD ’24\u003c/strong\u003e conference\u003c/a\u003e. We welcome all feedback and suggestions.\u003c/p\u003e\u003cp id=\"09f1\"\u003eIf this type of work interests you, we encourage you to apply for an\u003ca href=\"https://careers.airbnb.com/\" rel=\"noopener ugc nofollow\" target=\"_blank\"\u003e open position\u003c/a\u003e today.\u003c/p\u003e\u003c/div\u003e\u003c/div\u003e",
  "readingTime": "8 min read",
  "publishedTime": "2024-12-18T18:02:37.371Z",
  "modifiedTime": null
}
