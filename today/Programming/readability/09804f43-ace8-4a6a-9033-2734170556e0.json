{
  "id": "09804f43-ace8-4a6a-9033-2734170556e0",
  "title": "Using WSL and Let's Encrypt to create Azure App Service SSL Wildcard Certificates",
  "link": "http://feeds.hanselman.com/~/749206136/0/scotthanselman~Using-WSL-and-Lets-Encrypt-to-create-Azure-App-Service-SSL-Wildcard-Certificates",
  "description": "There are many let's encrypt automatic tools for azure but I also wanted to see if I could use certbot in wsl to generate a wildcard certificate for the azure Friday website and then upload the resulting certificates to azure app service. Azure app service ultimately needs a specific format called dot PFX that includes the full certificate path and all intermediates. Per the docs, App Service private certificates must meet the following requirements: Exported as a password-protected PFX file, encrypted using triple DES. Contains private key at least 2048 bits long Contains all intermediate certificates and the root certificate in the certificate chain. If you have a PFX that doesn't meet all these requirements you can have Windows reencrypt the file. I use WSL and certbot to create the cert, then I import/export in Windows and upload the resulting PFX. Within WSL, install certbot:sudo apt updatesudo apt install python3 python3-venv libaugeas0sudo python3 -m venv /opt/certbot/sudo /opt/certbot/bin/pip install --upgrade pipsudo /opt/certbot/bin/pip install certbot Then I generate the cert. You'll get a nice text UI from certbot and update your DNS as a verification challenge. Change this to make sure it's two lines, and your domains and subdomains are correct and your paths are correct.sudo certbot certonly --manual --preferred-challenges=dns --email YOUR@EMAIL.COM --server https://acme-v02.api.letsencrypt.org/directory --agree-tos --manual-public-ip-logging-ok -d \"azurefriday.com\" -d \"*.azurefriday.com\"sudo openssl pkcs12 -export -out AzureFriday2023.pfx -inkey /etc/letsencrypt/live/azurefriday.com/privkey.pem -in /etc/letsencrypt/live/azurefriday.com/fullchain.pem I then copy the resulting file to my desktop (check your desktop path) so it's now in the Windows world.sudo cp AzureFriday2023.pfx /mnt/c/Users/Scott/OneDrive/Desktop Now from Windows, import the PFX, note the thumbprint and export that cert.Import-PfxCertificate -FilePath \"AzureFriday2023.pfx\" -CertStoreLocation Cert:\\LocalMachine\\My -Password (ConvertTo-SecureString -String 'PASSWORDHERE' -AsPlainText -Force) -ExportableExport-PfxCertificate -Cert Microsoft.PowerShell.Security\\Certificate::LocalMachine\\My\\597THISISTHETHUMBNAILCF1157B8CEBB7CA1 -FilePath 'AzureFriday2023-fixed.pfx' -Password (ConvertTo-SecureString -String 'PASSWORDHERE' -AsPlainText -Force) Then upload the cert to the Certificates section of your App Service, under Bring Your Own Cert. Then under Custom Domains, click Update Binding and select the new cert (with the latest expiration date). Next step is to make this even more automatic or select a more automated solution but for now, I'll worry about this in September and it solved my expensive Wildcard Domain issue.© 2021 Scott Hanselman. All rights reserved.",
  "author": "Scott Hanselman",
  "published": "Tue, 27 Jun 2023 17:17:25 GMT",
  "source": "http://feeds.hanselman.com/ScottHanselman",
  "categories": [
    "Azure"
  ],
  "byline": "Scott Hanselman",
  "length": 3307,
  "excerpt": "There are many let's encrypt automatic tools for azure but I also wanted to see ...",
  "siteName": "",
  "favicon": "https://images.hanselman.com/main/apple-touch-icon-114x114.png",
  "text": "There are many let's encrypt automatic tools for azure but I also wanted to see if I could use certbot in wsl to generate a wildcard certificate for the azure Friday website and then upload the resulting certificates to azure app service. Azure app service ultimately needs a specific format called dot PFX that includes the full certificate path and all intermediates. Per the docs, App Service private certificates must meet the following requirements: Exported as a password-protected PFX file, encrypted using triple DES. Contains private key at least 2048 bits long Contains all intermediate certificates and the root certificate in the certificate chain. If you have a PFX that doesn't meet all these requirements you can have Windows reencrypt the file. I use WSL and certbot to create the cert, then I import/export in Windows and upload the resulting PFX. Within WSL, install certbot:sudo apt updatesudo apt install python3 python3-venv libaugeas0sudo python3 -m venv /opt/certbot/sudo /opt/certbot/bin/pip install --upgrade pipsudo /opt/certbot/bin/pip install certbot Then I generate the cert. You'll get a nice text UI from certbot and update your DNS as a verification challenge. Change this to make sure it's two lines, and your domains and subdomains are correct and your paths are correct.sudo certbot certonly --manual --preferred-challenges=dns --email YOUR@EMAIL.COM --server https://acme-v02.api.letsencrypt.org/directory --agree-tos --manual-public-ip-logging-ok -d \"azurefriday.com\" -d \"*.azurefriday.com\"sudo openssl pkcs12 -export -out AzureFriday2023.pfx -inkey /etc/letsencrypt/live/azurefriday.com/privkey.pem -in /etc/letsencrypt/live/azurefriday.com/fullchain.pem I then copy the resulting file to my desktop (check your desktop path) so it's now in the Windows world.sudo cp AzureFriday2023.pfx /mnt/c/Users/Scott/OneDrive/Desktop Now from Windows, import the PFX, note the thumbprint and export that cert.Import-PfxCertificate -FilePath \"AzureFriday2023.pfx\" -CertStoreLocation Cert:\\LocalMachine\\My -Password (ConvertTo-SecureString -String 'PASSWORDHERE' -AsPlainText -Force) -ExportableExport-PfxCertificate -Cert Microsoft.PowerShell.Security\\Certificate::LocalMachine\\My\\597THISISTHETHUMBNAILCF1157B8CEBB7CA1 -FilePath 'AzureFriday2023-fixed.pfx' -Password (ConvertTo-SecureString -String 'PASSWORDHERE' -AsPlainText -Force) Then upload the cert to the Certificates section of your App Service, under Bring Your Own Cert. Then under Custom Domains, click Update Binding and select the new cert (with the latest expiration date). Next step is to make this even more automatic or select a more automated solution but for now, I'll worry about this in September and it solved my expensive Wildcard Domain issue. About Scott Scott Hanselman is a former professor, former Chief Architect in finance, now speaker, consultant, father, diabetic, and Microsoft employee. He is a failed stand-up comic, a cornrower, and a book author. About   Newsletter Hosting By",
  "image": "https://www.hanselman.com/blog/content/binary/Windows-Live-Writer/Using-WSL-and-Lets-Encrypt-to-create-Azu_C384/image_3849c466-fcdb-4abd-96ad-8d52a5e93730.png",
  "html": "\u003cdiv id=\"readability-page-1\" class=\"page\"\u003e\u003csection\u003e\n            \n            \u003cp\u003eThere are many let\u0026#39;s encrypt automatic tools for azure but I also wanted to see if I could use certbot in wsl to generate a wildcard certificate for the azure Friday website and then upload the resulting certificates to azure app service. \u003c/p\u003e \u003cp\u003eAzure app service ultimately needs a specific format called dot PFX that includes the full certificate path and all intermediates.\u003c/p\u003e \u003cp\u003ePer the docs, App Service private certificates must meet \u003ca href=\"https://learn.microsoft.com/en-us/azure/app-service/configure-ssl-certificate?tabs=apex%2Cportal#private-certificate-requirements\"\u003ethe following requirements\u003c/a\u003e:  \u003c/p\u003e\u003cul\u003e \u003cli\u003eExported as a password-protected PFX file, encrypted using triple DES.  \u003c/li\u003e\u003cli\u003eContains private key at least 2048 bits long  \u003c/li\u003e\u003cli\u003eContains all intermediate certificates and the root certificate in the certificate chain.\u003c/li\u003e\u003c/ul\u003e \u003cp\u003eIf you have a PFX that doesn\u0026#39;t meet all these requirements you can have Windows reencrypt the file.\u003c/p\u003e \u003cp\u003eI use WSL and certbot to create the cert, then I import/export in Windows and upload the resulting PFX.\u003c/p\u003e \u003cp\u003eWithin WSL, install certbot:\u003c/p\u003e\u003cpre\u003esudo apt update\u003cbr/\u003esudo apt install python3 python3-venv libaugeas0\u003cbr/\u003esudo python3 -m venv /opt/certbot/\u003cbr/\u003esudo /opt/certbot/bin/pip install --upgrade pip\u003cbr/\u003esudo /opt/certbot/bin/pip install certbot\u003c/pre\u003e\n\u003cp\u003eThen I generate the cert. You\u0026#39;ll get a nice text UI from certbot and update your DNS as a verification challenge. Change this to make sure it\u0026#39;s \u003cstrong\u003etwo\u003c/strong\u003e lines, and your domains and subdomains are correct and your paths are correct.\u003c/p\u003e\u003cpre\u003esudo certbot certonly --manual --preferred-challenges=dns --email YOUR@EMAIL.COM   \u003cbr/\u003e    --server https://acme-v02.api.letsencrypt.org/directory   \u003cbr/\u003e    --agree-tos   --manual-public-ip-logging-ok   -d \u0026#34;azurefriday.com\u0026#34;   -d \u0026#34;*.azurefriday.com\u0026#34;\u003cbr/\u003esudo openssl pkcs12 -export -out AzureFriday2023.pfx \u003cbr/\u003e    -inkey /etc/letsencrypt/live/azurefriday.com/privkey.pem \u003cbr/\u003e    -in /etc/letsencrypt/live/azurefriday.com/fullchain.pem\u003c/pre\u003e\n\u003cp\u003eI then copy the resulting file to my desktop (check your desktop path) so it\u0026#39;s now in the Windows world.\u003c/p\u003e\u003cpre\u003esudo cp AzureFriday2023.pfx /mnt/c/Users/Scott/OneDrive/Desktop\n\u003c/pre\u003e\n\u003cp\u003eNow from Windows, import the PFX, note the thumbprint and export that cert.\u003c/p\u003e\u003cpre\u003eImport-PfxCertificate -FilePath \u0026#34;AzureFriday2023.pfx\u0026#34; -CertStoreLocation Cert:\\LocalMachine\\My \u003cbr/\u003e    -Password (ConvertTo-SecureString -String \u0026#39;PASSWORDHERE\u0026#39; -AsPlainText -Force) -Exportable\u003cp\u003eExport-PfxCertificate -Cert Microsoft.PowerShell.Security\\Certificate::LocalMachine\\My\\597THISISTHETHUMBNAILCF1157B8CEBB7CA1 \u003cbr/\u003e    -FilePath \u0026#39;AzureFriday2023-fixed.pfx\u0026#39; -Password (ConvertTo-SecureString -String \u0026#39;PASSWORDHERE\u0026#39; -AsPlainText -Force) \u003c/p\u003e\u003c/pre\u003e\n\u003cp\u003eThen upload the cert to the Certificates section of your App Service, under Bring Your Own Cert. \u003c/p\u003e\u003cfigure\u003e\u003cimg title=\"Custom Domains in Azure App Service\" alt=\"Custom Domains in Azure App Service\" src=\"https://hanselmanblogcontent.azureedge.net/Windows-Live-Writer/Using-WSL-and-Lets-Encrypt-to-create-Azu_C384/image_3849c466-fcdb-4abd-96ad-8d52a5e93730.png\" width=\"858\" height=\"437\"/\u003e\u003c/figure\u003e \n\u003cp\u003eThen under Custom Domains, click Update Binding and select the new cert (with the latest expiration date).\u003c/p\u003e\n\u003cp\u003e\u003cimg title=\"image\" alt=\"image\" src=\"https://hanselmanblogcontent.azureedge.net/Windows-Live-Writer/Using-WSL-and-Lets-Encrypt-to-create-Azu_C384/image_3d6c1eb8-4a3e-4004-985a-75e8f8f56118.png\" width=\"522\" height=\"437\"/\u003e\u003c/p\u003e\n\u003cp\u003eNext step is to make this even more automatic or select a more automated solution but for now, I\u0026#39;ll worry about this in September and it solved my expensive Wildcard Domain issue.\u003c/p\u003e\n\n\n\n            \u003cdiv\u003e\n                \u003cdiv\u003e\n                    \u003ch4\u003eAbout Scott\u003c/h4\u003e\n                    \u003cdiv\u003e\n                        \u003cp\u003eScott Hanselman is a former professor, former Chief Architect in finance, now speaker, consultant, father, diabetic, and Microsoft employee. He is a failed stand-up comic, a cornrower, and a book author.\u003c/p\u003e\n                        \u003cp\u003e\u003ca href=\"https://facebook.com/shanselman\"\u003e\u003cimg src=\"http://images.hanselman.com/main/icon-fb.png\" alt=\"facebook\"/\u003e\u003c/a\u003e\n                        \u003ca href=\"https://twitter.com/shanselman\"\u003e\u003cimg src=\"http://images.hanselman.com/main/icon-twitter.png\" alt=\"twitter\"/\u003e\u003c/a\u003e\n                        \u003ca href=\"http://feeds.hanselman.com/ScottHanselman\"\u003e\u003cimg src=\"http://images.hanselman.com/main/icon-rss.png\" alt=\"subscribe\"/\u003e\u003c/a\u003e\u003cbr/\u003e\n                        \u003ca href=\"http://hanselman.com/about\"\u003eAbout\u003c/a\u003e   \u003ca href=\"http://www.hanselman.com/newsletter\"\u003eNewsletter\u003c/a\u003e\n                    \u003c/p\u003e\u003c/div\u003e\n                \u003c/div\u003e\n\n                \u003cdiv\u003e\n                    \u003cp\u003e\u003cstrong\u003eHosting By\u003c/strong\u003e\u003cbr/\u003e\n                        \u003ca rel=\"nofollow\" href=\"https://azure.microsoft.com/free\"\u003e\u003cimg alt=\"Hosted in an Azure App Service\" width=\"125\" height=\"125\" src=\"http://images.hanselman.com/main/azure-250x250.png\"/\u003e\u003c/a\u003e\n                    \u003c/p\u003e\n\n                \u003c/div\u003e\n            \u003c/div\u003e\n\n            \n\n\n            \n\n            \n        \u003c/section\u003e\u003c/div\u003e",
  "readingTime": "4 min read",
  "publishedTime": null,
  "modifiedTime": null
}
