{
  "id": "5b1cfafb-7b4f-48ea-b28e-57db0a7c1409",
  "title": "Improve Your Next Experiment by Learning Better Proxy Metrics From Past Experiments",
  "link": "https://netflixtechblog.com/improve-your-next-experiment-by-learning-better-proxy-metrics-from-past-experiments-64c786c2a3ac?source=rss----2615bd06b42e---4",
  "description": "",
  "author": "Netflix Technology Blog",
  "published": "Mon, 26 Aug 2024 15:46:24 GMT",
  "source": "https://netflixtechblog.com/feed",
  "categories": [
    "data-science",
    "experimentation",
    "machine-learning",
    "a-b-testing",
    "statistics"
  ],
  "byline": "Netflix Technology Blog",
  "length": 7982,
  "excerpt": "We are excited to share our work on how to learn good proxy metrics from historical experiments at KDD 2024. This work addresses a fundamental question for technology companies and academic…",
  "siteName": "Netflix TechBlog",
  "favicon": "https://miro.medium.com/v2/resize:fill:1000:1000/7*GAOKVe--MXbEJmV9230oOQ.png",
  "text": "We are excited to share our work on how to learn good proxy metrics from historical experiments at KDD 2024. This work addresses a fundamental question for technology companies and academic researchers alike: how do we establish that a treatment that improves short-term (statistically sensitive) outcomes also improves long-term (statistically insensitive) outcomes? Or, faced with multiple short-term outcomes, how do we optimally trade them off for long-term benefit?For example, in an A/B test, you may observe that a product change improves the click-through rate. However, the test does not provide enough signal to measure a change in long-term retention, leaving you in the dark as to whether this treatment makes users more satisfied with your service. The click-through rate is a proxy metric (S, for surrogate, in our paper) while retention is a downstream business outcome or north star metric (Y). We may even have several proxy metrics, such as other types of clicks or the length of engagement after click. Taken together, these form a vector of proxy metrics.The goal of our work is to understand the true relationship between the proxy metric(s) and the north star metric — so that we can assess a proxy’s ability to stand in for the north star metric, learn how to combine multiple metrics into a single best one, and better explore and compare different proxies.Several intuitive approaches to understanding this relationship have surprising pitfalls:Looking only at user-level correlations between the proxy S and north star Y. Continuing the example from above, you may find that users with a higher click-through rate also tend to have a higher retention. But this does not mean that a product change that improves the click-through rate will also improve retention (in fact, promoting clickbait may have the opposite effect). This is because, as any introductory causal inference class will tell you, there are many confounders between S and Y — many of which you can never reliably observe and control for.Looking naively at treatment effect correlations between S and Y. Suppose you are lucky enough to have many historical A/B tests. Further imagine the ordinary least squares (OLS) regression line through a scatter plot of Y on S in which each point represents the (S,Y)-treatment effect from a previous test. Even if you find that this line has a positive slope, you unfortunately cannot conclude that product changes that improve S will also improve Y. The reason for this is correlated measurement error — if S and Y are positively correlated in the population, then treatment arms that happen to have more users with high S will also have more users with high Y.Between these naive approaches, we find that the second one is the easier trap to fall into. This is because the dangers of the first approach are well-known, whereas covariances between estimated treatment effects can appear misleadingly causal. In reality, these covariances can be severely biased compared to what we actually care about: covariances between true treatment effects. In the extreme — such as when the negative effects of clickbait are substantial but clickiness and retention are highly correlated at the user level — the true relationship between S and Y can be negative even if the OLS slope is positive. Only more data per experiment could diminish this bias — using more experiments as data points will only yield more precise estimates of the badly biased slope. At first glance, this would appear to imperil any hope of using existing experiments to detect the relationship.This figure shows a hypothetical treatment effect covariance matrix between S and Y (white line; negative correlation), a unit-level sampling covariance matrix creating correlated measurement errors between these metrics (black line; positive correlation), and the covariance matrix of estimated treatment effects which is a weighted combination of the first two (orange line; no correlation).To overcome this bias, we propose better ways to leverage historical experiments, inspired by techniques from the literature on weak instrumental variables. More specifically, we show that three estimators are consistent for the true proxy/north-star relationship under different constraints (the paper provides more details and should be helpful for practitioners interested in choosing the best estimator for their setting):A Total Covariance (TC) estimator allows us to estimate the OLS slope from a scatter plot of true treatment effects by subtracting the scaled measurement error covariance from the covariance of estimated treatment effects. Under the assumption that the correlated measurement error is the same across experiments (homogeneous covariances), the bias of this estimator is inversely proportional to the total number of units across all experiments, as opposed to the number of members per experiment.Jackknife Instrumental Variables Estimation (JIVE) converges to the same OLS slope as the TC estimator but does not require the assumption of homogeneous covariances. JIVE eliminates correlated measurement error by removing each observation’s data from the computation of its instrumented surrogate values.A Limited Information Maximum Likelihood (LIML) estimator is statistically efficient as long as there are no direct effects between the treatment and Y (that is, S fully mediates all treatment effects on Y). We find that LIML is highly sensitive to this assumption and recommend TC or JIVE for most applications.Our methods yield linear structural models of treatment effects that are easy to interpret. As such, they are well-suited to the decentralized and rapidly-evolving practice of experimentation at Netflix, which runs thousands of experiments per year on many diverse parts of the business. Each area of experimentation is staffed by independent Data Science and Engineering teams. While every team ultimately cares about the same north star metrics (e.g., long-term revenue), it is highly impractical for most teams to measure these in short-term A/B tests. Therefore, each has also developed proxies that are more sensitive and directly relevant to their work (e.g., user engagement or latency). To complicate matters more, teams are constantly innovating on these secondary metrics to find the right balance of sensitivity and long-term impact.In this decentralized environment, linear models of treatment effects are a highly useful tool for coordinating efforts around proxy metrics and aligning them towards the north star:Managing metric tradeoffs. Because experiments in one area can affect metrics in another area, there is a need to measure all secondary metrics in all tests, but also to understand the relative impact of these metrics on the north star. This is so we can inform decision-making when one metric trades off against another metric.Informing metrics innovation. To minimize wasted effort on metric development, it is also important to understand how metrics correlate with the north star “net of” existing metrics.Enabling teams to work independently. Lastly, teams need simple tools in order to iterate on their own metrics. Teams may come up with dozens of variations of secondary metrics, and slow, complicated tools for evaluating these variations are unlikely to be adopted. Conversely, our models are easy and fast to fit, and are actively used to develop proxy metrics at Netflix.We are thrilled about the research and implementation of these methods at Netflix — while also continuing to strive for great and always better, per our culture. For example, we still have some way to go to develop a more flexible data architecture to streamline the application of these methods within Netflix. Interested in helping us? See our open job postings!For feedback on this blog post and for supporting and making this work better, we thank Apoorva Lal, Martin Tingley, Patric Glynn, Richard McDowell, Travis Brooks, and Ayal Chen-Zion.",
  "image": "https://miro.medium.com/v2/resize:fit:1200/1*m_lKjIe460GlWr5JseoQzw.jpeg",
  "html": "\u003cdiv id=\"readability-page-1\" class=\"page\"\u003e\u003cdiv\u003e\u003cp id=\"a71b\"\u003eWe are excited to share \u003ca href=\"https://arxiv.org/pdf/2402.17637\" rel=\"noopener ugc nofollow\" target=\"_blank\"\u003eour work\u003c/a\u003e on how to learn good proxy metrics from historical experiments at \u003ca href=\"https://kdd2024.kdd.org/\" rel=\"noopener ugc nofollow\" target=\"_blank\"\u003eKDD 2024\u003c/a\u003e. This work addresses a fundamental question for technology companies and academic researchers alike: how do we establish that a treatment that improves short-term (statistically sensitive) outcomes also improves long-term (statistically insensitive) outcomes? Or, faced with multiple short-term outcomes, how do we optimally trade them off for long-term benefit?\u003c/p\u003e\u003cp id=\"2b17\"\u003eFor example, in an A/B test, you may observe that a product change improves the click-through rate. However, the test does not provide enough signal to measure a change in long-term retention, leaving you in the dark as to whether this treatment makes users more satisfied with your service. The click-through rate is a \u003cem\u003eproxy metric\u003c/em\u003e (\u003cem\u003eS\u003c/em\u003e, for surrogate, in our paper) while retention is a downstream \u003cem\u003ebusiness outcome \u003c/em\u003eor \u003cem\u003enorth star metric \u003c/em\u003e(\u003cem\u003eY\u003c/em\u003e). We may even have several proxy metrics, such as other types of clicks or the length of engagement after click. Taken together, these form a \u003cem\u003evector\u003c/em\u003e of proxy metrics.\u003c/p\u003e\u003cp id=\"ca1c\"\u003eThe goal of our work is to understand the true relationship between the proxy metric(s) and the north star metric — so that we can assess a proxy’s ability to stand in for the north star metric, learn how to combine multiple metrics into a single best one, and better explore and compare different proxies.\u003c/p\u003e\u003cp id=\"8738\"\u003eSeveral intuitive approaches to understanding this relationship have surprising pitfalls:\u003c/p\u003e\u003cul\u003e\u003cli id=\"9fd6\"\u003e\u003cstrong\u003eLooking only at user-level correlations between the proxy \u003cem\u003eS \u003c/em\u003eand north star \u003cem\u003eY\u003c/em\u003e.\u003c/strong\u003e Continuing the example from above, you may find that users with a higher click-through rate also tend to have a higher retention. But this does not mean that a \u003cem\u003eproduct change \u003c/em\u003ethat improves the click-through rate will also improve retention (in fact, promoting clickbait may have the opposite effect). This is because, as any introductory causal inference class will tell you, there are many confounders between \u003cem\u003eS \u003c/em\u003eand \u003cem\u003eY\u003c/em\u003e — many of which you can never reliably observe and control for.\u003c/li\u003e\u003cli id=\"1221\"\u003e\u003cstrong\u003eLooking naively at treatment effect correlations between \u003cem\u003eS \u003c/em\u003eand \u003cem\u003eY.\u003c/em\u003e\u003c/strong\u003e Suppose you are lucky enough to have many historical A/B tests. Further imagine the ordinary least squares (OLS) regression line through a scatter plot of \u003cem\u003eY \u003c/em\u003eon \u003cem\u003eS\u003c/em\u003e in which each point represents the (\u003cem\u003eS\u003c/em\u003e,\u003cem\u003eY\u003c/em\u003e)-treatment effect from a previous test. Even if you find that this line has a positive slope, you unfortunately \u003cem\u003ecannot\u003c/em\u003e conclude that product changes that improve \u003cem\u003eS \u003c/em\u003ewill also improve \u003cem\u003eY\u003c/em\u003e. The reason for this is correlated measurement error — if \u003cem\u003eS\u003c/em\u003e and \u003cem\u003eY\u003c/em\u003e are positively correlated in the population, then treatment arms that happen to have more users with high \u003cem\u003eS\u003c/em\u003e will also have more users with high \u003cem\u003eY\u003c/em\u003e.\u003c/li\u003e\u003c/ul\u003e\u003cp id=\"31fc\"\u003eBetween these naive approaches, we find that the second one is the easier trap to fall into. This is because the dangers of the first approach are well-known, whereas covariances between \u003cem\u003eestimated\u003c/em\u003e treatment effects can appear misleadingly causal. In reality, these covariances can be severely biased compared to what we actually care about: covariances between \u003cem\u003etrue\u003c/em\u003e treatment effects. In the extreme — such as when the negative effects of clickbait are substantial but clickiness and retention are highly correlated at the user level — the true relationship between \u003cem\u003eS \u003c/em\u003eand \u003cem\u003eY \u003c/em\u003ecan be negative even if the OLS slope is positive. Only more data per experiment could diminish this bias — using more experiments as data points will only yield more precise estimates of the badly biased slope. At first glance, this would appear to imperil any hope of using existing experiments to detect the relationship.\u003c/p\u003e\u003cfigure\u003e\u003cfigcaption\u003e\u003cem\u003eThis figure shows a hypothetical treatment effect covariance matrix between S and Y (white line; negative correlation), a unit-level sampling covariance matrix creating correlated measurement errors between these metrics (black line; positive correlation), and the covariance matrix of estimated treatment effects which is a weighted combination of the first two (orange line; no correlation).\u003c/em\u003e\u003c/figcaption\u003e\u003c/figure\u003e\u003cp id=\"8f12\"\u003eTo overcome this bias, we propose better ways to leverage historical experiments, inspired by techniques from the literature on weak instrumental variables. More specifically, we show that three estimators are consistent for the true proxy/north-star relationship under different constraints (the \u003ca href=\"https://arxiv.org/pdf/2402.17637\" rel=\"noopener ugc nofollow\" target=\"_blank\"\u003epaper\u003c/a\u003e provides more details and should be helpful for practitioners interested in choosing the best estimator for their setting):\u003c/p\u003e\u003cul\u003e\u003cli id=\"7bee\"\u003eA \u003cstrong\u003eTotal Covariance (TC) \u003c/strong\u003eestimator allows us to estimate the OLS slope from a scatter plot of \u003cem\u003etrue \u003c/em\u003etreatment effects by subtracting the scaled measurement error covariance from the covariance of estimated treatment effects. Under the assumption that the correlated measurement error is the same across experiments (homogeneous covariances), the bias of this estimator is inversely proportional to the total number of units across all experiments, as opposed to the number of members per experiment.\u003c/li\u003e\u003cli id=\"15f5\"\u003e\u003cstrong\u003eJackknife Instrumental Variables Estimation (JIVE)\u003c/strong\u003e converges to the same OLS slope as the TC estimator but does not require the assumption of homogeneous covariances. JIVE eliminates correlated measurement error by removing each observation’s data from the computation of its instrumented surrogate values.\u003c/li\u003e\u003cli id=\"a4aa\"\u003eA \u003cstrong\u003eLimited Information Maximum Likelihood (LIML) \u003c/strong\u003eestimator is statistically efficient as long as there are no direct effects between the treatment and \u003cem\u003eY\u003c/em\u003e (that is, \u003cem\u003eS\u003c/em\u003e fully mediates all treatment effects on \u003cem\u003eY\u003c/em\u003e). We find that LIML is highly sensitive to this assumption and recommend TC or JIVE for most applications.\u003c/li\u003e\u003c/ul\u003e\u003cp id=\"e658\"\u003eOur methods yield linear structural models of treatment effects that are easy to interpret. As such, they are well-suited to the decentralized and rapidly-evolving practice of experimentation at Netflix, which runs \u003ca rel=\"noopener ugc nofollow\" target=\"_blank\" href=\"https://netflixtechblog.com/experimentation-is-a-major-focus-of-data-science-across-netflix-f67923f8e985\"\u003ethousands of experiments per year\u003c/a\u003e on many diverse parts of the business. Each area of experimentation is staffed by independent Data Science and Engineering teams. While every team ultimately cares about the same north star metrics (e.g., long-term revenue), it is highly impractical for most teams to measure these in short-term A/B tests. Therefore, each has also developed proxies that are more sensitive and directly relevant to their work (e.g., user engagement or latency). To complicate matters more, teams are constantly innovating on these secondary metrics to find the right balance of sensitivity and long-term impact.\u003c/p\u003e\u003cp id=\"7ad9\"\u003eIn this decentralized environment, linear models of treatment effects are a highly useful tool for coordinating efforts around proxy metrics and aligning them towards the north star:\u003c/p\u003e\u003col\u003e\u003cli id=\"6178\"\u003e\u003cstrong\u003eManaging metric tradeoffs.\u003c/strong\u003e Because experiments in one area can affect metrics in another area, there is a need to measure all secondary metrics in all tests, but also to understand the relative impact of these metrics on the north star. This is so we can inform decision-making when one metric trades off against another metric.\u003c/li\u003e\u003cli id=\"96f2\"\u003e\u003cstrong\u003eInforming metrics innovation.\u003c/strong\u003e To minimize wasted effort on metric development, it is also important to understand how metrics correlate with the north star “net of” existing metrics.\u003c/li\u003e\u003cli id=\"5c65\"\u003e\u003cstrong\u003eEnabling teams to work independently.\u003c/strong\u003e Lastly, teams need simple tools in order to iterate on their own metrics. Teams may come up with dozens of variations of secondary metrics, and slow, complicated tools for evaluating these variations are unlikely to be adopted. Conversely, our models are easy and fast to fit, and are actively used to develop proxy metrics at Netflix.\u003c/li\u003e\u003c/ol\u003e\u003cp id=\"0d35\"\u003eWe are thrilled about the research and implementation of these methods at Netflix — while also continuing to strive for \u003cstrong\u003e\u003cem\u003egreat and always better\u003c/em\u003e\u003c/strong\u003e, per our \u003ca href=\"https://jobs.netflix.com/culture\" rel=\"noopener ugc nofollow\" target=\"_blank\"\u003eculture\u003c/a\u003e. For example, we still have some way to go to develop a more flexible data architecture to streamline the application of these methods within Netflix. Interested in helping us? See our \u003ca href=\"https://jobs.netflix.com/\" rel=\"noopener ugc nofollow\" target=\"_blank\"\u003eopen job postings\u003c/a\u003e!\u003c/p\u003e\u003cp id=\"f30b\"\u003e\u003cem\u003eFor feedback on this blog post and for supporting and making this work better, we thank Apoorva Lal, Martin Tingley, Patric Glynn, Richard McDowell, Travis Brooks, and Ayal Chen-Zion.\u003c/em\u003e\u003c/p\u003e\u003c/div\u003e\u003c/div\u003e",
  "readingTime": "9 min read",
  "publishedTime": "2024-08-26T15:44:02.705Z",
  "modifiedTime": null
}
