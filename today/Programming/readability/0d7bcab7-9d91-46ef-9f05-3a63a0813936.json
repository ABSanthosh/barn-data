{
  "id": "0d7bcab7-9d91-46ef-9f05-3a63a0813936",
  "title": "Cloudflare Experiences Major Incident in November, Resulting in Log Loss",
  "link": "https://www.infoq.com/news/2024/12/cloudflare-incident-log-loss/?utm_campaign=infoq_content\u0026utm_source=infoq\u0026utm_medium=feed\u0026utm_term=global",
  "description": "Cloudflare has recently confirmed that on November 14th they experienced an incident affecting Cloudflare Logs with 55% of logs during a 3.5-hour period being lost. The incident impacted most customers using the service, with a misconfiguration triggering a cascading series of system failures and exposing weaknesses in handling unexpected spikes in demand. By Renato Losio",
  "author": "Renato Losio",
  "published": "Sat, 07 Dec 2024 06:33:00 GMT",
  "source": "https://feed.infoq.com",
  "categories": [
    "Incident Response",
    "Cloudflare",
    "Logging",
    "Architecture \u0026 Design",
    "DevOps",
    "news"
  ],
  "byline": "Renato Losio",
  "length": 3540,
  "excerpt": "Cloudflare has recently confirmed that on November 14th they experienced an incident affecting Cloudflare Logs with 55% of logs during a 3.5-hour period being lost. The incident impacted most custome",
  "siteName": "InfoQ",
  "favicon": "https://cdn.infoq.com/statics_s1_20241205201138/apple-touch-icon.png",
  "text": "Cloudflare has recently confirmed that on November 14th they experienced an incident affecting Cloudflare Logs with 55% of logs during a 3.5-hour period being lost. The incident impacted most customers using the service, with a misconfiguration triggering a cascading series of system failures and exposing weaknesses in handling unexpected spikes in demand. Jamie Herre, Tom Walwyn, Christian Endres, Gabriele Viglianisi, Mik Kocikowski, and Rian van der Merwe explain: On a typical day, Cloudflare sends about 4.5 trillion individual event logs to customers. Although this represents less than 10% of the over 50 trillion total customer event logs processed, it presents unique challenges of scale when building a reliable and fault-tolerant system. To deliver logs from tens of thousands of servers in over 330 cities worldwide, Cloudflare developed Logpush, a Golang service designed to collect and push logs into predictable file sizes while scaling automatically with usage. The internal Buftee service provides buffers for each Logpush job, containing 100% of the logs generated by the zone or account. Logpush reads logs from these buffers and pushes them in batches to various customer-configured destinations, with over 600 million batches processed daily. In the article, the team highlights what went wrong on November 14th, detailing the systems involved, the failures experienced, and the actions that Cloudflare plans to take moving forward. The authors acknowledge: We made a change to support an additional dataset for Logpush. This required adding a new configuration to be provided to Logfwdr in order for it to know which customers’ logs to forward for this new stream. (...) A bug in this system resulted in a blank configuration being provided to Logfwdr. Although the team identified the mistake and reverted the change in under 5 minutes, this failure triggered a second, latent bug in Logfwdr, causing a massive overload that rendered Buftee unresponsive. Nermin Smajic, senior corporate cybersecurity advisor at ESET, comments: This incident exemplifies why cybersecurity is not just about preventing external threats, but also about maintaining robust, resilient internal systems that can withstand complex technical challenges. Recovering from the incorrect Buftee configuration took Cloudflare several hours. The authors clarify: When Logfwdr began to send event logs for all customers, Buftee began to create buffers for each one as those logs arrived (...) This massive increase, resulting in roughly 40 times more buffers, is not something we’ve provisioned Buftee clusters to handle. Source: Cloudflare blog Lorin Hochstein, staff software engineer at Airbnb and author of Surfing Complexity, observes: Cloudflare consistently generates the highest quality public incident writeups of any tech company. Their latest is no exception. (...) Automated safety mechanisms themselves add complexity, and we are no better at implementing bug-free safety code than we are at implementing bug-free feature code. While Cloudflare's operational team promises to implement more alerts to ensure these specific misconfigurations are impossible to miss, they acknowledge that mistakes and misconfigurations are inevitable. They emphasize that the goal of all Cloudflare systems should be to respond to such issues predictably and gracefully. About the Author Renato Losio",
  "image": "https://res.infoq.com/news/2024/12/cloudflare-incident-log-loss/en/headerimage/generatedHeaderImage-1733201228951.jpg",
  "html": "\u003cdiv id=\"readability-page-1\" class=\"page\"\u003e\u003cdiv\u003e\n\t\t\t\t\t\t\t\t\u003cp\u003eCloudflare has recently confirmed that on November 14th they experienced an incident affecting \u003ca href=\"https://developers.cloudflare.com/logs/\"\u003eCloudflare Logs\u003c/a\u003e with \u003ca href=\"https://blog.cloudflare.com/cloudflare-incident-on-november-14-2024-resulting-in-lost-logs/\"\u003e55% of logs during a 3.5-hour period being lost\u003c/a\u003e.\u003c/p\u003e\n\n\u003cp\u003eThe incident impacted most customers using the service, with a misconfiguration triggering a cascading series of system failures and exposing weaknesses in handling unexpected spikes in demand. Jamie Herre, Tom Walwyn, Christian Endres, Gabriele Viglianisi, Mik Kocikowski, and Rian van der Merwe explain:\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eOn a typical day, Cloudflare sends about 4.5 trillion individual event logs to customers. Although this represents less than 10% of the over 50 trillion total customer event logs processed, it presents unique challenges of scale when building a reliable and fault-tolerant system.\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eTo deliver logs from tens of thousands of servers in over 330 cities worldwide, Cloudflare developed \u003ca href=\"https://developers.cloudflare.com/logs/about/\"\u003eLogpush\u003c/a\u003e, a Golang service designed to collect and push logs into predictable file sizes while scaling automatically with usage. The internal Buftee service provides buffers for each Logpush job, containing 100% of the logs generated by the zone or account. Logpush reads logs from these buffers and pushes them in batches to various customer-configured destinations, with over 600 million batches processed daily.\u003c/p\u003e\n\n\u003cp\u003eIn the article, the team highlights what went wrong on November 14th, detailing the systems involved, the failures experienced, and the actions that Cloudflare plans to take moving forward. The authors acknowledge:\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eWe made a change to support an additional dataset for Logpush. This required adding a new configuration to be provided to Logfwdr in order for it to know which customers’ logs to forward for this new stream. (...) A bug in this system resulted in a blank configuration being provided to Logfwdr.\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eAlthough the team identified the mistake and reverted the change in under 5 minutes, this failure triggered a second, latent bug in Logfwdr, causing a massive overload that rendered Buftee unresponsive. Nermin Smajic, senior corporate cybersecurity advisor at ESET, \u003ca href=\"https://www.linkedin.com/posts/nsmajic_cloudflare-incident-on-november-14-2024-activity-7268169153386094593-8ZUj\"\u003ecomments\u003c/a\u003e:\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eThis incident exemplifies why cybersecurity is not just about preventing external threats, but also about maintaining robust, resilient internal systems that can withstand complex technical challenges.\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eRecovering from the incorrect Buftee configuration took Cloudflare several hours. The authors clarify:\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eWhen Logfwdr began to send event logs for all customers, Buftee began to create buffers for each one as those logs arrived (...) This massive increase, resulting in roughly 40 times more buffers, is not something we’ve provisioned Buftee clusters to handle.\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003e\u003cimg alt=\"\" data-src=\"news/2024/12/cloudflare-incident-log-loss/en/resources/7image3-1733201399476.png\" src=\"https://imgopt.infoq.com/fit-in/3000x4000/filters:quality(85)/filters:no_upscale()/news/2024/12/cloudflare-incident-log-loss/en/resources/7image3-1733201399476.png\" rel=\"share\"/\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003cem\u003eSource: Cloudflare blog\u003c/em\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003ca href=\"https://www.linkedin.com/in/lhochstein/\"\u003eLorin Hochstein\u003c/a\u003e, staff software engineer at Airbnb and author of Surfing Complexity, \u003ca href=\"https://surfingcomplexity.blog/2024/11/28/quick-takes-on-the-latest-cloudflare-public-incident-write-up/\"\u003eobserves\u003c/a\u003e:\u003c/p\u003e\n\n\u003cblockquote\u003e\n\u003cp\u003eCloudflare consistently generates the highest quality public incident writeups of any tech company. Their latest is no exception. (...) Automated safety mechanisms themselves add complexity, and we are no better at implementing bug-free safety code than we are at implementing bug-free feature code.\u003c/p\u003e\n\u003c/blockquote\u003e\n\n\u003cp\u003eWhile Cloudflare\u0026#39;s operational team promises to implement more alerts to ensure these specific misconfigurations are impossible to miss, they acknowledge that mistakes and misconfigurations are inevitable. They emphasize that the goal of all Cloudflare systems should be to respond to such issues predictably and gracefully.\u003c/p\u003e\n\n\n\n\t\t\t\t\t\t\t\t\n\n\n\n\n\n\n\n\n\n  \n    \u003cdiv\u003e \n        \u003ch2\u003eAbout the Author\u003c/h2\u003e \n\n        \n            \n                \n            \n            \u003cdiv data-id=\"author-Renato-Losio\"\u003e\n                    \u003ch4\u003e\u003cstrong\u003eRenato Losio\u003c/strong\u003e\u003c/h4\u003e\n                    \n                \u003c/div\u003e\n        \n    \u003c/div\u003e\n\n\t\t\t\t\t\t\t\u003c/div\u003e\u003c/div\u003e",
  "readingTime": "5 min read",
  "publishedTime": "2024-12-07T00:00:00Z",
  "modifiedTime": null
}
