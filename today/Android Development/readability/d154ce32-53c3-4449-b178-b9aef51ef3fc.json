{
  "id": "d154ce32-53c3-4449-b178-b9aef51ef3fc",
  "title": "Safely accessing lateinit variables",
  "link": "https://okkotlin.com/lateinits/",
  "description": "Kotlin, by design, doesn't allow a non-null variable to be left uninitialised during its declaration. To get past this issue, Kotlin's…",
  "author": "",
  "published": "Sun, 29 Dec 2019 00:00:00 GMT",
  "source": "https://okkotlin.com/rss.xml",
  "categories": null,
  "byline": "",
  "length": 3403,
  "excerpt": "Lateinit variables are handy when we can't define a variable value upfront. Let's see how we can safely access lateinit variables without crashing our program.",
  "siteName": "",
  "favicon": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAQKADAAQAAAABAAAAQAAAAABlmWCKAAAFGUlEQVR4Ae1Zb2wURRT/zc5eqxQM2BZIJQEKUk1D/BewBg0otIAiwcAXEb4ZP0hsAkbUiCQYY4wmajBGiZiYmPiBWEMNH6SUaIEoJhA0Go1FW62FRNuKkYtpe7szvtm73e7e7rW0t6Xc3Uyy2Tdv/r3fb9+8ebsL6KIZ0AxoBjQDmgHNgGZAM6AZ0AyUIgNsvKCH96+5Q1pyEw28T4LdxJiskRLTxzvPVPYv33Xcw21eqSHWm01bbNgvE/g6NUY6AyUIfEGXMQmQbzctTKXEx7a0GwoaaQ7jRyUgtb9xZcoSLfScK3OML3h1TgIUeGmLY+TiiYJHOQoAI6pNub20ZUuxg1fYIz1A7flidnv/Qw95gIr2BL4oA54fuCuHCFBHndtYCvcAASrJoQPeOedLAbzCGCBAZXilAtzFGQiC6fTWbZqCu0HmVNyYXjg1CAz+O+lGBAhQub2b5MaxMpt9M9jcW+laAja9GrK/C/LPTogLPwDJvtASrGoBEo+95+jtn9phf/5qqE/cigABmReb/NcorwB/oBn8ltXBuebf5dSlNQz71EGIc58G26egFowBMbzVscr5SGw/GAIvlUtnCjPLYK56EuYjr1AU4q56Su4BD8jbAmaAN+0Gm1HtTCX/uwT7i3cgfj8LDF0GZs0DX/oQjDu3gDEGY8FykjdDnDmU99ITnSDgAROdxB2ngBlz06eoTA4g9dETEJ1fpsGrTpd6YZ84ALvtdXcIeMN2YMZsrx4pELEoqxi5VD2mEt9MZBBfut4zy+54FyAPiCrixzaIP751mljiehhLVkZ1S+sIrLlhL8p2tDqXuf554JokgIBg5jzHaGmnIH45mRsUtYjODq+dVdV6crbAG5+GsfheRy1+OwPryD4abGV3m3A9Ng9g1Yucfa0skeTqEPaoRsm/e7x2VrXQk/0CX7UDvH6to1IeY322FyBy4yzxBUHLF+XLpo1to7/PUDLU36i9B4yOU1VE7/ewDu8h8MOhfvkqYvMAOdBD3weFYw+7YQ6QMT6Xgcpj3CL/Ou+K3t0FrxSy/1fAR7DXKQYhNgLU05H93Z5JfNmjnhwSKKLz2zZ6apUdRhWZ2Ub89k0wspOqqAET0MVHAC1uf/WhZ4Jz1i9a4dU9gYKlufYZsEzOL/q6IM6f8JpdQfR+B6tlNzwS1uxErljhjpnIPVYCZNfXED3nHDsYN5HYuA/8wRdg1K8DU0nP8q1IbDvgRXUFzskJIgKmvNwHSSTYpz5Iz5e4DubDdAKMsbXGS0J8QTCzsnXkJZjrnoVR2+BoeN39gLqyihxMwj7+FqL2v7+rOHsIoqaeSFsBNrOG5n4OVuuL/i55ybF6gGMJpbxW6x5YJ9+HTPaHjFNPXXR/Q1ni4+ksMdQjrLCOvgb5z0WnQZ0Oxt3bwp2uUMMAyslHCtVHytAbq+P/zzNtFticOnodroSk/S77KKJPwnE2gmIsiXWW72r3vnrFvgVCy1M6LLtPZ36lhVqvuoJBXvAvGv8W8M9+Dcrk4oEcveQIYCY77H8upUUAw89lze3pczrDQkkRwMHphSJYSoYABnba3Nn2SRB+jn+D2Z0KvU6f3wYSprE1CkfRewB9ekwxzjazp9pG3tR8TBQ1AerJM240JpqPdfgwB8SiJUDteXL7ZaOBV0xMfiYY4PsqVOioU9E+KuBFrV7QBND+TkrJLqr0VmV4KsnJPuejQGudZkAzoBnQDGgGNAOaAc2AZkAzoBn4H3WFe3QRC8LrAAAAAElFTkSuQmCC",
  "text": "Kotlin, by design, doesn't allow a non-null variable to be left uninitialised during its declaration. To get past this issue, Kotlin's lateinit allows us to declare a variable first and then initialise it some point in the future during our program's execution cycle. The concept is simple, but when we try to access an uninitialised property, it's a different story. Let's talk more about that. First, let's crash our app Whenever we declare a lateinit var, we need to initialise it before we can access it. Failing to do that will result in an exception as follows: Exception in thread \"main\" kotlin.UninitializedPropertyAccessException: lateinit property fullName has not been initialized at UninitializedPropertyKt.main(UninitializedProperty.kt:3) The above is not one of those warnings that we can safely ignore and move on. An exception like this will crash our app. And this is a common situation. For example, in an Android app: We might have a list of news items that we need to fetch from a remote server. When the data finally arrives, we need to initialise a RecyclerView adapter, let's say NewsAdapter based on that data to show up the news articles. What do you think will happen when we try to access that adapter before we initialise it with the fetched data? Our app crashes because of the exception we talked about earlier. The lateinit var adapter: NewsAdapter has not been initialised. Does that mean lateinit properties are useless? No. Here's a secret: Before accessing the property, we can check if it's initialised or not. There's a reflection based API On Kotlin 1.2 and up, we can quickly check whether a lateinit property has been initialised or not using a reflection based API. Here's how it works: lateinit var fullName: String if (::fullName.isInitialized) { print(\"Hi, $fullName\") } You can read more about this API in the official blog post announcing this update. The backing field might not be accessible always There's a small caveat here. This reflection API works only on properties which are defined: In the same class where the check is being made In an outer class As top-level in the same file So, if we have a lateinit property in one class and try to check whether it's initialised or not in another class, like this: class LateComer { lateinit var student: Student } class School { val lateComer = LateComer() fun printLateComer() { if (lateComer::student.isInitialized) { println(\"Late Comer: ${lateComer.student}\") } } } The program will get a compile time error saying: Error:(9, 32) Kotlin: Backing field of 'var student: Student /* = String */' is not accessible at this point In some case, where we need to verify whether lateinit property of some class is initialised or not, there's a workaround. Taking note from this StackOverflow answer, we can check lateinit properties of other classes by adding a new method on the target class: class LateComer { lateinit var student: Student fun isStudentInitialised() = ::student.isInitialized } It is not an elegant solution but it works. Safe to use This API is neither experimental nor unstable. I have been using it for a long time, and it works every time. Feel free to take advantage of this small feature and instead of ditching lateinit altogether and falling back to nullable properties. Here's a sketch note on the topic",
  "image": "https://okkotlin.com/images/lateinits-featured.png",
  "html": "\u003cdiv id=\"readability-page-1\" class=\"page\"\u003e\u003cdiv\u003e\u003cp\u003eKotlin, by design, doesn\u0026#39;t allow a non-null variable to be left uninitialised during its declaration.\u003c/p\u003e\n\u003cp\u003eTo get past this issue, Kotlin\u0026#39;s \u003ccode\u003elateinit\u003c/code\u003e allows us to declare a variable first and then initialise it some point in the future during our program\u0026#39;s execution cycle.\u003c/p\u003e\n\u003cp\u003eThe concept is simple, but when we try to access an uninitialised property, it\u0026#39;s a different story. Let\u0026#39;s talk more about that.\u003c/p\u003e\n\u003ch2 id=\"first-lets-crash-our-app\"\u003eFirst, let\u0026#39;s crash our app\u003c/h2\u003e\n\u003cp\u003eWhenever we declare a \u003ccode\u003elateinit var\u003c/code\u003e, we need to initialise it before we can access it. Failing to do that will result in an exception as follows:\u003c/p\u003e\n\u003cdiv data-language=\"text\"\u003e\u003cpre\u003e\u003ccode\u003eException in thread \u0026#34;main\u0026#34; kotlin.UninitializedPropertyAccessException: lateinit property fullName has not been initialized at UninitializedPropertyKt.main(UninitializedProperty.kt:3)\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThe above is not one of those warnings that we can safely ignore and move on. An exception like this will crash our app.\u003c/p\u003e\n\u003cp\u003eAnd this is a common situation. For example, in an Android app:\u003c/p\u003e\n\u003cp\u003eWe might have a list of news items that we need to fetch from a remote server. When the data finally arrives, we need to initialise a \u003ccode\u003eRecyclerView\u003c/code\u003e adapter, let\u0026#39;s say \u003ccode\u003eNewsAdapter\u003c/code\u003e based on that data to show up the news articles.\u003c/p\u003e\n\u003cp\u003eWhat do you think will happen when we try to access that adapter before we initialise it with the fetched data?\u003c/p\u003e\n\u003cp\u003eOur app crashes because of the exception we talked about earlier. The \u003ccode\u003elateinit var adapter: NewsAdapter\u003c/code\u003e has not been initialised.\u003c/p\u003e\n\u003cp\u003eDoes that mean \u003ccode\u003elateinit\u003c/code\u003e properties are useless? No.\u003c/p\u003e\n\u003cp\u003eHere\u0026#39;s a secret:\u003c/p\u003e\n\u003cp\u003eBefore accessing the property, we can check if it\u0026#39;s initialised or not.\u003c/p\u003e\n\u003ch2 id=\"theres-a-reflection-based-api\"\u003eThere\u0026#39;s a reflection based API\u003c/h2\u003e\n\u003cp\u003eOn \u003cstrong\u003eKotlin 1.2\u003c/strong\u003e and up, we can quickly check whether a \u003ccode\u003elateinit\u003c/code\u003e property has been initialised or not using a reflection based API.\u003c/p\u003e\n\u003cp\u003eHere\u0026#39;s how it works:\u003c/p\u003e\n\u003cdiv data-language=\"kotlin\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan\u003elateinit\u003c/span\u003e \u003cspan\u003evar\u003c/span\u003e fullName\u003cspan\u003e:\u003c/span\u003e String\n    \n\u003cspan\u003eif\u003c/span\u003e \u003cspan\u003e(\u003c/span\u003e\u003cspan\u003e::\u003c/span\u003efullName\u003cspan\u003e.\u003c/span\u003eisInitialized\u003cspan\u003e)\u003c/span\u003e \u003cspan\u003e{\u003c/span\u003e\n    \u003cspan\u003eprint\u003c/span\u003e\u003cspan\u003e(\u003c/span\u003e\u003cspan\u003e\u0026#34;Hi, \u003cspan\u003e$fullName\u003c/span\u003e\u0026#34;\u003c/span\u003e\u003cspan\u003e)\u003c/span\u003e\n\u003cspan\u003e}\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eYou can read more about this API in the \u003ca href=\"https://blog.jetbrains.com/kotlin/2017/09/kotlin-1-2-beta-is-out/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003eofficial blog post\u003c/a\u003e announcing this update.\u003c/p\u003e\n\u003ch2 id=\"the-backing-field-might-not-be-accessible-always\"\u003eThe backing field might not be accessible always\u003c/h2\u003e\n\u003cp\u003eThere\u0026#39;s a small caveat here. This reflection API works only on properties which are defined:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eIn the same class where the check is being made\u003c/li\u003e\n\u003cli\u003eIn an outer class\u003c/li\u003e\n\u003cli\u003eAs top-level in the same file\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eSo, if we have a \u003ccode\u003elateinit\u003c/code\u003e property in one class and try to check whether it\u0026#39;s initialised or not in another class, like this:\u003c/p\u003e\n\u003cdiv data-language=\"kotlin\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan\u003eclass\u003c/span\u003e LateComer \u003cspan\u003e{\u003c/span\u003e\n    \u003cspan\u003elateinit\u003c/span\u003e \u003cspan\u003evar\u003c/span\u003e student\u003cspan\u003e:\u003c/span\u003e Student\n\u003cspan\u003e}\u003c/span\u003e\n    \n\u003cspan\u003eclass\u003c/span\u003e School \u003cspan\u003e{\u003c/span\u003e\n    \u003cspan\u003eval\u003c/span\u003e lateComer \u003cspan\u003e=\u003c/span\u003e \u003cspan\u003eLateComer\u003c/span\u003e\u003cspan\u003e(\u003c/span\u003e\u003cspan\u003e)\u003c/span\u003e\n    \n    \u003cspan\u003efun\u003c/span\u003e \u003cspan\u003eprintLateComer\u003c/span\u003e\u003cspan\u003e(\u003c/span\u003e\u003cspan\u003e)\u003c/span\u003e \u003cspan\u003e{\u003c/span\u003e\n        \u003cspan\u003eif\u003c/span\u003e \u003cspan\u003e(\u003c/span\u003elateComer\u003cspan\u003e::\u003c/span\u003estudent\u003cspan\u003e.\u003c/span\u003eisInitialized\u003cspan\u003e)\u003c/span\u003e \u003cspan\u003e{\u003c/span\u003e\n            \u003cspan\u003eprintln\u003c/span\u003e\u003cspan\u003e(\u003c/span\u003e\u003cspan\u003e\u0026#34;Late Comer: \u003cspan\u003e\u003cspan\u003e${\u003c/span\u003elateComer\u003cspan\u003e.\u003c/span\u003estudent\u003cspan\u003e}\u003c/span\u003e\u003c/span\u003e\u0026#34;\u003c/span\u003e\u003cspan\u003e)\u003c/span\u003e\n        \u003cspan\u003e}\u003c/span\u003e\n    \u003cspan\u003e}\u003c/span\u003e\n\u003cspan\u003e}\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eThe program will get a compile time error saying:\u003c/p\u003e\n\u003cdiv data-language=\"text\"\u003e\u003cpre\u003e\u003ccode\u003eError:(9, 32) Kotlin: Backing field of \u0026#39;var student: Student /* = String */\u0026#39; is not accessible at this point\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eIn some case, where we need to verify whether \u003ccode\u003elateinit\u003c/code\u003e property of some class is initialised or not, there\u0026#39;s a workaround.\u003c/p\u003e\n\u003cp\u003eTaking note from this \u003ca href=\"https://stackoverflow.com/a/51258077/3922919\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003eStackOverflow answer\u003c/a\u003e, we can check \u003ccode\u003elateinit\u003c/code\u003e properties of other classes by adding a new method on the target class:\u003c/p\u003e\n\u003cdiv data-language=\"kotlin\"\u003e\u003cpre\u003e\u003ccode\u003e\u003cspan\u003eclass\u003c/span\u003e LateComer \u003cspan\u003e{\u003c/span\u003e\n    \u003cspan\u003elateinit\u003c/span\u003e \u003cspan\u003evar\u003c/span\u003e student\u003cspan\u003e:\u003c/span\u003e Student\n    \n    \u003cspan\u003efun\u003c/span\u003e \u003cspan\u003eisStudentInitialised\u003c/span\u003e\u003cspan\u003e(\u003c/span\u003e\u003cspan\u003e)\u003c/span\u003e \u003cspan\u003e=\u003c/span\u003e \u003cspan\u003e::\u003c/span\u003estudent\u003cspan\u003e.\u003c/span\u003eisInitialized\n\u003cspan\u003e}\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\n\u003cp\u003eIt is not an elegant solution but it works.\u003c/p\u003e\n\u003ch2 id=\"safe-to-use\"\u003eSafe to use\u003c/h2\u003e\n\u003cp\u003eThis API is neither experimental nor unstable. I have been using it for a long time, and it works every time.\u003c/p\u003e\n\u003cp\u003eFeel free to take advantage of this small feature and instead of ditching \u003ccode\u003elateinit\u003c/code\u003e altogether and falling back to nullable properties.\u003c/p\u003e\n\u003ch2 id=\"heres-a-sketch-note-on-the-topic\"\u003eHere\u0026#39;s a sketch note on the topic\u003c/h2\u003e\n\u003cp\u003e\u003cspan\u003e\n      \u003ca href=\"https://okkotlin.com/static/859e64adb6dfef9b22ec0e67fda55294/d40c8/lateinits-sketch-note.png\" target=\"_blank\" rel=\"noopener\"\u003e\n    \u003cspan\u003e\u003c/span\u003e\n  \u003cimg alt=\"Lateinits sketch note\" title=\"Lateinits sketch note\" src=\"https://okkotlin.com/static/859e64adb6dfef9b22ec0e67fda55294/dbb61/lateinits-sketch-note.png\" srcset=\"https://okkotlin.com/static/859e64adb6dfef9b22ec0e67fda55294/19bd1/lateinits-sketch-note.png 163w,\nhttps://okkotlin.com/static/859e64adb6dfef9b22ec0e67fda55294/d3bcb/lateinits-sketch-note.png 325w,\nhttps://okkotlin.com/static/859e64adb6dfef9b22ec0e67fda55294/dbb61/lateinits-sketch-note.png 650w,\nhttps://okkotlin.com/static/859e64adb6dfef9b22ec0e67fda55294/6b691/lateinits-sketch-note.png 975w,\nhttps://okkotlin.com/static/859e64adb6dfef9b22ec0e67fda55294/91670/lateinits-sketch-note.png 1300w,\nhttps://okkotlin.com/static/859e64adb6dfef9b22ec0e67fda55294/d40c8/lateinits-sketch-note.png 2000w\" sizes=\"(max-width: 650px) 100vw, 650px\" loading=\"lazy\"/\u003e\n  \u003c/a\u003e\n    \u003c/span\u003e\u003c/p\u003e\u003c/div\u003e\u003c/div\u003e",
  "readingTime": "4 min read",
  "publishedTime": null,
  "modifiedTime": null
}
