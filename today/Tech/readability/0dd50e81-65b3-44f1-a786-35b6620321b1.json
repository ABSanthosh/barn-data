{
  "id": "0dd50e81-65b3-44f1-a786-35b6620321b1",
  "title": "Root shell on a credit card terminal",
  "link": "https://stefan-gloor.ch/yomani-hack",
  "description": "Comments",
  "author": "",
  "published": "Sun, 01 Jun 2025 13:42:49 +0000",
  "source": "https://news.ycombinator.com/rss",
  "categories": null,
  "byline": "",
  "length": 14509,
  "excerpt": "In this project, I started to reverse engineer payment card terminals because they seemed to be an interesting target for security research, given the high stakes involved. Although I initially didn’t know much about this industry, I did expect a ton of security features and a very security-hardened device. And to some degree, this was also correct.",
  "siteName": "",
  "favicon": "https://stefan-gloor.ch/img/favicon.png",
  "text": "In this project, I started to reverse engineer payment card terminals because they seemed to be an interesting target for security research, given the high stakes involved. Although I initially didn’t know much about this industry, I did expect a ton of security features and a very security-hardened device. And to some degree, this was also correct. First Look The model I went with is a Worldline Yomani XR terminal. Although it seems to be discontinued at the time of writing, this is the model that is everywhere in Switzerland. From big grocery chains to the small repair shop on the corner, everyone has one or a whole fleet of this exact terminal. After booting it up and aimlessly clicking through the UI, I did a quick port scan, but couldn’t find anything interesting. So naturally, I started to take it apart. The housing and the PCBs appear to be well-made. The design consists of multiple PCBs: a small connector board for the outward-facing connectors, the main board, and a vertical board the card slot sits on. The main SoC seems to be a custom ASIC, a dual-core Arm processor code-named “Samoa II” in the firmware, but I am jumping ahead. According to Worldline documentation, this seems to indeed be a custom ASIC, rather than just a rebranded off-the-shelf chip. Next to it, there is a small external flash and RAM. Tamper Protections During disassembly, I kept looking for a tamper switch that would detect when the device’s housing was opened, like I had seen previously on laptops and other devices. However, I couldn’t find such a switch. Rather, they use the board-to-board interconnects as a way of detecting when the device is opened. Because they use relatively pressure-sensitive Zebra strips between the boards, they have to be tightly screwed together. Even unscrewing some of the screws is enough to break contact and trigger a tamper event. Of course, the tamper detection must also work when the power is disconnected, so that’s the purpose of the coin cell battery. But this is not all in terms of tamper resistance: The “vulnerable” PCBs are covered by zick-zack traces that act as a tamper detection mechanism. Accidentally breaking a single copper trace during a physical penetration attempt (hole drill etc.) is enough to trigger the tamper detection. Trace meander on the display PCB acting as tamper detection. The card slot itself is contained in an additional, internal housing. Wrapped around this housing, there is a flex PCB acting as tamper protection. Card reader assembly wrapped in a tamper detection flex PCB. After putting the device back together, it was clear that my intrusion had not gone undetected. Sure enough, the device would now only show a big red screen screaming “TAMPER DETECTED”. In this mode, the device seems to be fully unresponsive to any kind of external input. So, game over? Chip-Off Firmware Extraction Since any “runtime” exploration seems to be futile now, I wanted to take a look a the firmware. For this, I desoldered the on-board flash chip, soldered some wires to it in “dead bug” style and proceeded to dump the contents. BGA flash chip of the card terminal desoldered and connected to a flash reader. To my surprise, the contents seemed to be entirely unencrypted! However, the contents seemed to have a strange ECC layout. Instead of following the flash chip’s inherent page layout and putting the ECC data in the interleaved spare areas, it appeared as if the some ECC data was present in the page and some clear text was in the spare areas. With the help of some friends, I figured out the layout: instead of using the standard 2048 byte payload + 64 byte ECC/spare layout, it uses 3x 694 byte chunks of data each followed by 10 ECC bytes. The ECC bytes do not appear to be all used. Instead, the last 16 bytes of the spare area seem to act as metadata for the YAFFS2 file system. Now normally, there are less ECC bytes per page and therefore the usable metadata area for the filesystem is larger than 16 bytes. For this reason, the YAFFS2 filesystem had to be patched to work with smaller metadata structures. I implemented a compatible filesystem reader and with it, I could successfully dump the filesystem contents! Now it was clear that this device runs Linux. I found a standard Linux filesystem with a lot of interesting files to browse through. The system runs a 3.6 kernel, built with Buildroot 2010.02 (!) in February of 2023. The system seems to use a custom bootloader, “Booter v1.7”. Although I don’t know how recent the firware version was that I ended up dumping, it must have been released after February 2023. So finding such an ancient kernel is rather concerning. Userspace-wise, the system uses classy init scripts, busybox, and uClibc (final release was 13 years ago). libcrypt has version 0.9.26, ouch. Finding a Root Shell on Accident Having seen the firmware gave me some new confidence that there might be more stuff to find. So I reattached the flash chip using wires, ignoring everything I know about signal integrity. To my surprise the device booted up again (showing the tamper message). Flash chip reunited with the PCB, as good as new. My next goal was to find the serial console of the Linux system. Surely, it must have one for debugging. By looking at a boot log, I might get some more valuable information. So, equipped with a logic analyzer, I started poking. Probing the debug connector. It didn’t take long until I found some activity on one pad of the unpopulated debug connector. Bingo! ------------------------------------------------------------------------ Booter: 1.7b+00002:gbe6b338 Jun 3 2014 08:51:58 owi Reset reason: Tamper Start USB boot ... Got address 0x00000015 Enumerated. Dfu timeout yaffs: checkpoint restore ... KO! yaffs: clean up the mess caused by an aborted checkpoint file \"hwinfo-l0\" found file \"hwinfo-l1\" found file \"hwinfo-l2\" found file \"loadercode\" found file \"mp1.img\" found file \"linux\" found Uncompressing Linux... done, booting the kernel. Linux version 3.6.0-samoa-01844-g1f05798 (ppd@debian) (gcc version 4.3.4 (Buildroot 2010.02) ) #0 Fri, 10 Feb 2023 16:26:07 +0100 cpufreq: initial frequency: 264000 kHz MAC-1G DMA: 430ab000 - 430ab9ff MAC addr = 00:08:19:4e:56:2c eth0: ioaddr: d00d0000, dev: c30ac000 probing samoafb: rc = 0 DMA = 4F500000-\u003ec3a00000, IO = (null) UART 1 probing UART 1 probing OK UART 2 probing UART 2 probing OK UART 3 probing UART 3 probing OK pca953x 0-0049: failed reading register ba315 ba315.0: NAND ID: id[0-3]=’EF A1 00 95’, manu=’Winbond’, dev=’NAND 128MiB 1,8V 8-bit’ drivers/rtc/hctosys.c: unable to open rtc device (rtc0) yaffs: Attempting MTD mount of 31.0,\"mtdblock0\" yaffs: yaffs_read_super: is_checkpointed 0 starting pid 398, tty ’’: ’/etc/init.d/rcS’ /etc/init.d/rcS started Mounting local file systems: ok rootfs on / type rootfs (rw) /dev/root on / type yaffs2 (rw,relatime) proc on /proc type proc (rw,relatime) devpts on /dev/pts type devpts (rw,relatime,mode=600) tmpfs on /tmp type tmpfs (rw,relatime) none on /sys type sysfs (rw,relatime) Mounting usbfs: failed Terminal is initializing\\nPlease wait ... dropbear is not present emv-engine-4.3e-with-trace is not present tim-server-nexo-config_3.1.6.0-1140_arm is not present mp1-samoa2-eft-sr-prod is not present Checking for FW updates\\nPlease wait FW is up to date. Starting Application Monitoring Daemons Mounting USB stick: failed starting pid 600, tty ’/dev/ttyCU’: ’/sbin/getty 115200 ttyCU’ samoa login: It even shows a login prompt, neat! So this is definitely the Linux boot log. Many embedded Linux systems will have such a more or less exposed serial console, but most of the time the login is disabled altogether or a random, hard-to-crack password is either hard-coded or generated at boot. Not expecting much, just out of curiosity, I entered “root” as the login, and... samoa login: root ~ # Wait, what!? That’s it? I’m in? Well, yes. That was the boring story of how I got the root shell. It is just there, exposed. No sophisticated exploit chain, no brute-force password cracking required. Additionally, everything seems to still work although the device still shows the tamper message. Now you may say: well okay, that’s not ideal, but in order to get access to the exposed root shell, you need to open up the device, which triggers the tamper protection and effectively renders the device useless. But in fact, the serial port is accessible from the outside!. Without opening up the device and triggering the tamper protection, the debug connector can be accessed through a little hatch on the back of the device. All an attacker needs is just 30 seconds alone with the device to attach to the serial port, log in, deploy malware, and leave. This sounds really bad. The debug connector with the serial console is accessible from the outside of the device. Is This as Bad as It Looks? All this fancy hardware made useless by some lazy software engineers? Actually, no. Hear me out: During my analysis of this device, it became clear that the Linux system is not the whole story. For example, there seems to be no graphics driver for the display and the only framebuffer device does not seem to do anything. Instead, only text strings seem to be passed to a binary (display_tool), that issues some inter-processor messages. The same goes for the key pad or the card reader itself. I could not find any evidence that these peripherals could be accessed directly from Linux. Instead, there is an entirely separate processor, refered to as mp1, that seems to handle all the “secure” stuff, like handling the card, getting the pin and showing information on the screen. The “insecure” Linux, running on the second processor, mp2, only handles the networking, the updating, and the business logic. The Linux core seems to always boot, regardless of the tamper state. From there, the secure core is booted. For this, Linux apparently loads a secure bootloader (named loadercode) into memory. This loadercode checks whether the tamper protections have been triggered and based on the result, either show the red screen or continue to boot the actual “secure” image (mp1.img, in the Linux filesystem). This secure image seems to be properly encrypted and signed by two entities. My current understanding of the Yomani boot process featuring the Samoa II ASIC. The first core (insecure, application) always boots Linux, which in turn loads a secure bootloader and the secure image on the second core. The loadercode is what displays the tamper messages on screen. The secure image, that handles the card, display, and key pad, is properly encrypted and signed. Disclosure Timeline 14/11/2024 Discovered the root shell 15/11/2024 Informed manufacturer, announced 90 days until publication 18/11/2024 Manufacturer confirms that they got the report --- I forgot this project existed --- 01/06/2025 Publication Conclusion While concerning, the exposed root shell does not seem to be as big of a risk as initially feared. While still being a huge unnecessary attack surface, and a massive oversight from the engineers in my opinion, I could not find any evidence that sensitive data, such as card details, could become compromised this way. Also, I could not definitively prove which firmware versions were vulnerable. During my research, I also encountered devices that had a disabled root login. My guess is that somehow this debug feature accidentally made it into production firmware at some point. Chances are that this was discovered and fixed internally before I reported it to the manufacturer (as I had no way of updating the firmware, or verifying that I was running the latest firmware). This project was a lot of fun and I wish I had some more time to dig deeper into the firmware and explore more possibilities. If you want to take on this challenge, feel free to reach out to me. I’d like to thank anyone involved in this project for their valuable input.",
  "image": "",
  "html": "\u003cdiv id=\"readability-page-1\" class=\"page\"\u003e\u003cdiv\u003e\n        \u003cp\u003eIn this project, I started to reverse engineer payment card\n        terminals because they seemed to be an interesting target for security\n        research, given the high stakes involved. Although I initially didn’t\n        know much about this industry, I did expect a ton of security features\n        and a very security-hardened device. And to some degree, this was also\n        correct.\u003c/p\u003e\n        \u003ch2\u003eFirst Look\u003c/h2\u003e\n        \u003cp\u003eThe model I went with is a Worldline Yomani XR terminal. Although it\n        seems to be discontinued at the time of writing, this is the model that\n        is \u003ci\u003eeverywhere\u003c/i\u003e in Switzerland. From big grocery chains to the\n        small repair shop on the corner, everyone has one or a whole fleet of\n        this exact terminal.\u003c/p\u003e\n        \u003cp\u003eAfter booting it up and aimlessly clicking through the UI, I did a\n        quick port scan, but couldn’t find anything interesting. So naturally,\n        I started to take it apart.\u003c/p\u003e\n        \u003cdiv\u003e\n          \u003cfigure\u003e\n            \u003ca href=\"https://stefan-gloor.ch/img/yomani_pcb.jpg\"\u003e\u003cimg src=\"https://stefan-gloor.ch/img/yomani_pcb.jpg\" width=\"100%\" alt=\"Picture of the main PCB of the Yomani XR terminal with annotation of different board components.\"/\u003e\u003c/a\u003e\n          \u003c/figure\u003e\n        \u003c/div\u003e\n        \u003cp\u003eThe housing and the PCBs appear to be well-made. The design consists\n        of multiple PCBs: a small connector board for the outward-facing\n        connectors, the main board, and a vertical board the card slot sits on.\n        The main SoC seems to be a custom ASIC, a dual-core Arm processor\n        code-named “Samoa II” in the firmware, but I am jumping ahead.\n        According to Worldline documentation, this seems to indeed be a custom\n        ASIC, rather than just a rebranded off-the-shelf chip. Next to it,\n        there is a small external flash and RAM.\u003c/p\u003e\n        \u003ch2\u003eTamper Protections\u003c/h2\u003e\n        \u003cp\u003eDuring disassembly, I kept looking for a tamper switch that would\n        detect when the device’s housing was opened, like I had seen previously\n        on laptops and other devices. However, I couldn’t find such a switch.\n        Rather, they use the board-to-board interconnects as a way of detecting\n        when the device is opened. Because they use relatively\n        pressure-sensitive Zebra strips between the boards, they have to be\n        tightly screwed together. Even unscrewing some of the screws is enough\n        to break contact and trigger a tamper event. Of course, the tamper\n        detection must also work when the power is disconnected, so that’s the\n        purpose of the coin cell battery.\u003c/p\u003e\n        \u003cp\u003eBut this is not all in terms of tamper resistance: The “vulnerable”\n        PCBs are covered by zick-zack traces that act as a tamper detection\n        mechanism. Accidentally breaking a single copper trace during a\n        physical penetration attempt (hole drill etc.) is enough to trigger the\n        tamper detection.\u003c/p\u003e\n        \u003cdiv\u003e\n          \u003cfigure\u003e\n            \u003ca href=\"https://stefan-gloor.ch/img/yomani_mesh2.jpg\"\u003e\u003cimg src=\"https://stefan-gloor.ch/img/yomani_mesh2.jpg\" width=\"100%\" alt=\"PCB showing a zick-zack line pattern across the whole board, acting as a temper detection mechanism.\"/\u003e\u003c/a\u003e\n            \u003cfigcaption\u003e\n              Trace meander on the display PCB acting as tamper detection.\n            \u003c/figcaption\u003e\n          \u003c/figure\u003e\n        \u003c/div\u003e\n        \u003cp\u003eThe card slot itself is contained in an additional, internal\n        housing. Wrapped around this housing, there is a flex PCB acting as\n        tamper protection.\u003c/p\u003e\n        \u003cdiv\u003e\n          \u003cfigure\u003e\n            \u003ca href=\"https://stefan-gloor.ch/img/yomani_mesh.jpg\"\u003e\u003cimg src=\"https://stefan-gloor.ch/img/yomani_mesh.jpg\" width=\"100%\" alt=\"Inner plastic housing is wrapped in a flex PCB with zick zack traces, acting as a temper detection mechanism.\"/\u003e\u003c/a\u003e\n            \u003cfigcaption\u003e\n              Card reader assembly wrapped in a tamper detection flex PCB.\n            \u003c/figcaption\u003e\n          \u003c/figure\u003e\n        \u003c/div\u003e\n        \u003cp\u003eAfter putting the device back together, it was clear that my\n        intrusion had not gone undetected. Sure enough, the device would now\n        only show a big red screen screaming “TAMPER DETECTED”. In this mode,\n        the device seems to be fully unresponsive to any kind of external\n        input. So, game over?\u003c/p\u003e\n        \u003cdiv\u003e\n          \u003cfigure\u003e\n            \u003ca href=\"https://stefan-gloor.ch/img/yomani_tampered.jpg\"\u003e\u003cimg src=\"https://stefan-gloor.ch/img/yomani_tampered.jpg\" width=\"100%\" alt=\"Yomani Credit Card terminal showing an all-red screen saying OUT OF ORDER, TAMPERED STATE, no key loaded.\"/\u003e\u003c/a\u003e\n          \u003c/figure\u003e\n        \u003c/div\u003e\n        \u003ch2\u003eChip-Off Firmware Extraction\u003c/h2\u003e\n        \u003cp\u003eSince any “runtime” exploration seems to be futile now, I wanted to\n        take a look a the firmware. For this, I desoldered the on-board flash\n        chip, soldered some wires to it in “dead bug” style and proceeded to\n        dump the contents.\u003c/p\u003e\n        \u003cdiv\u003e\n          \u003cfigure\u003e\n            \u003ca href=\"https://stefan-gloor.ch/img/yomani_chipoff.jpg\"\u003e\u003cimg src=\"https://stefan-gloor.ch/img/yomani_chipoff.jpg\" width=\"100%\" alt=\"Flash chip in BGA housing mounted upside-down on a perfboard. Thin copper wires are connected from the chip’s contacts to a flash reader.\"/\u003e\u003c/a\u003e\n            \u003cfigcaption\u003e\n              BGA flash chip of the card terminal desoldered and connected to a\n              flash reader.\n            \u003c/figcaption\u003e\n          \u003c/figure\u003e\n        \u003c/div\u003e\n        \u003cp\u003eTo my surprise, the contents seemed to be entirely unencrypted!\n        However, the contents seemed to have a strange ECC layout. Instead of\n        following the flash chip’s inherent page layout and putting the ECC\n        data in the interleaved spare areas, it appeared as if the some ECC\n        data was present in the page and some clear text was in the spare\n        areas. With the help of some friends, I figured out the layout: instead\n        of using the standard 2048 byte payload + 64 byte ECC/spare layout, it\n        uses 3x 694 byte chunks of data each followed by 10 ECC bytes. The ECC\n        bytes do not appear to be all used. Instead, the last 16 bytes of the\n        spare area seem to act as metadata for the YAFFS2 file system. Now\n        normally, there are less ECC bytes per page and therefore the usable\n        metadata area for the filesystem is larger than 16 bytes. For this\n        reason, the YAFFS2 filesystem had to be patched to work with smaller\n        metadata structures.\u003c/p\u003e\n        \u003cp\u003eI implemented a compatible filesystem reader and with it, I could\n        successfully dump the filesystem contents!\u003c/p\u003e\n        \n        \u003cp\u003eNow it was clear that this device runs Linux. I found a standard\n        Linux filesystem with a lot of interesting files to browse through. The\n        system runs a 3.6 kernel, built with Buildroot 2010.02 (!) in February\n        of 2023. The system seems to use a custom bootloader, “Booter v1.7”.\n        Although I don’t know how recent the firware version was that I ended\n        up dumping, it must have been released after February 2023. So finding\n        such an ancient kernel is rather concerning. Userspace-wise, the system\n        uses classy init scripts, busybox, and uClibc (final release was 13\n        years ago). libcrypt has version 0.9.26, ouch.\u003c/p\u003e\n        \u003ch2\u003eFinding a Root Shell on Accident\u003c/h2\u003e\n        \u003cp\u003eHaving seen the firmware gave me some new confidence that there\n        might be more stuff to find. So I reattached the flash chip using\n        wires, ignoring everything I know about signal integrity. To my\n        surprise the device booted up again (showing the tamper message).\u003c/p\u003e\n        \u003cdiv\u003e\n          \u003cfigure\u003e\n            \u003ca href=\"https://stefan-gloor.ch/img/yomani_flash_attached.jpg\"\u003e\u003cimg src=\"https://stefan-gloor.ch/img/yomani_flash_attached.jpg\" width=\"100%\" alt=\"BGA flash chip attached to PCB using wires\"/\u003e\u003c/a\u003e\n            \u003cfigcaption\u003e\n              Flash chip reunited with the PCB, as good as new.\n            \u003c/figcaption\u003e\n          \u003c/figure\u003e\n        \u003c/div\u003e\n        \u003cp\u003eMy next goal was to find the serial console of the Linux system.\n        Surely, it must have one for debugging. By looking at a boot log, I\n        might get some more valuable information. So, equipped with a logic\n        analyzer, I started poking.\u003c/p\u003e\n        \u003cdiv\u003e\n          \u003cfigure\u003e\n            \u003ca href=\"https://stefan-gloor.ch/img/yomani_probing.jpg\"\u003e\u003cimg src=\"https://stefan-gloor.ch/img/yomani_probing.jpg\" width=\"100%\" alt=\"PCB with needle probes attached to a logic analyzer\"/\u003e\u003c/a\u003e\n            \u003cfigcaption\u003e\n              Probing the debug connector.\n            \u003c/figcaption\u003e\n          \u003c/figure\u003e\n        \u003c/div\u003e\n        \u003cp\u003eIt didn’t take long until I found some activity on one pad of the\n        unpopulated debug connector. Bingo!\u003c/p\u003e\n        \u003cpre\u003e------------------------------------------------------------------------\nBooter: 1.7b+00002:gbe6b338 Jun  3 2014 08:51:58 owi\nReset reason: Tamper\nStart USB boot ...\nGot address 0x00000015\nEnumerated.\nDfu timeout\nyaffs: checkpoint restore ... KO!\nyaffs: clean up the mess caused by an aborted checkpoint\nfile \u0026#34;hwinfo-l0\u0026#34; found\nfile \u0026#34;hwinfo-l1\u0026#34; found\nfile \u0026#34;hwinfo-l2\u0026#34; found\nfile \u0026#34;loadercode\u0026#34; found\nfile \u0026#34;mp1.img\u0026#34; found\nfile \u0026#34;linux\u0026#34; found\nUncompressing Linux... done, booting the kernel.\nLinux version 3.6.0-samoa-01844-g1f05798 (ppd@debian) (gcc version 4.3.4 (Buildroot 2010.02) ) #0 Fri, 10 Feb 2023 16:26:07 +0100\ncpufreq: initial frequency: 264000 kHz\nMAC-1G DMA: 430ab000 - 430ab9ff\nMAC addr = 00:08:19:4e:56:2c\neth0: ioaddr: d00d0000, dev: c30ac000\nprobing samoafb: rc = 0\n  DMA = 4F500000-\u0026gt;c3a00000, IO =   (null)\nUART 1 probing\nUART 1 probing OK\nUART 2 probing\nUART 2 probing OK\nUART 3 probing\nUART 3 probing OK\npca953x 0-0049: failed reading register\nba315 ba315.0: NAND ID: id[0-3]=’EF A1 00 95’, manu=’Winbond’, dev=’NAND 128MiB 1,8V 8-bit’\ndrivers/rtc/hctosys.c: unable to open rtc device (rtc0)\nyaffs: Attempting MTD mount of 31.0,\u0026#34;mtdblock0\u0026#34;\nyaffs: yaffs_read_super: is_checkpointed 0\nstarting pid 398, tty ’’: ’/etc/init.d/rcS’\n/etc/init.d/rcS started\nMounting local file systems: ok\nrootfs on / type rootfs (rw)\n/dev/root on / type yaffs2 (rw,relatime)\nproc on /proc type proc (rw,relatime)\ndevpts on /dev/pts type devpts (rw,relatime,mode=600)\ntmpfs on /tmp type tmpfs (rw,relatime)\nnone on /sys type sysfs (rw,relatime)\nMounting usbfs: failed\nTerminal is initializing\\nPlease wait\n...\ndropbear is not present\nemv-engine-4.3e-with-trace is not present\ntim-server-nexo-config_3.1.6.0-1140_arm is not present\nmp1-samoa2-eft-sr-prod is not present\nChecking for FW updates\\nPlease wait\n\n FW is up to date.\n\nStarting Application Monitoring Daemons\nMounting USB stick: failed\nstarting pid 600, tty ’/dev/ttyCU’: ’/sbin/getty 115200 ttyCU’\n\nsamoa login: \n\u003c/pre\u003e\n        \u003cp\u003eIt even shows a login prompt, neat! So this is definitely the Linux\n        boot log. Many embedded Linux systems will have such a more or less\n        exposed serial console, but most of the time the login is disabled\n        altogether or a random, hard-to-crack password is either hard-coded or\n        generated at boot. Not expecting much, just out of curiosity, I entered\n        “root” as the login, and...\u003c/p\u003e\n        \u003cpre\u003esamoa login: root\n~ #\n\u003c/pre\u003e\n        \u003cp\u003eWait, what!? That’s it? I’m in?\u003c/p\u003e\n        \u003cp\u003eWell, yes. That was the boring story of how I got the root shell. It\n        is just there, exposed. No sophisticated exploit chain, no brute-force\n        password cracking required. Additionally, everything seems to still\n        work although the device still shows the tamper message.\u003c/p\u003e\n        \u003cp\u003eNow you may say: well okay, that’s not ideal, but in order to get\n        access to the exposed root shell, you need to open up the device, which\n        triggers the tamper protection and effectively renders the device\n        useless. But in fact, the \u003cb\u003eserial port is accessible from the\n        outside!\u003c/b\u003e. Without opening up the device and triggering the tamper\n        protection, the debug connector can be accessed through a little hatch\n        on the back of the device. All an attacker needs is just 30 seconds\n        alone with the device to attach to the serial port, log in, deploy\n        malware, and leave. This sounds really bad.\u003c/p\u003e\n        \u003cdiv\u003e\n          \u003cfigure\u003e\n            \u003ca href=\"https://stefan-gloor.ch/img/yomani_uart_conn.jpg\"\u003e\u003cimg src=\"https://stefan-gloor.ch/img/yomani_uart_conn.jpg\" width=\"100%\" alt=\"PCB showing 3 wires attached with labels, RX, TX, and GND.\"/\u003e\u003c/a\u003e\n            \u003cfigcaption\u003e\n              The debug connector with the serial console is accessible from\n              the outside of the device.\n            \u003c/figcaption\u003e\n          \u003c/figure\u003e\n          \u003ch2\u003eIs This as Bad as It Looks?\u003c/h2\u003e\n          \u003cdiv\u003e\n            \u003cfigure\u003e\n              \u003ca href=\"https://stefan-gloor.ch/img/yomani_meme.jpg\"\u003e\u003cimg src=\"https://stefan-gloor.ch/img/yomani_meme.jpg\" width=\"100%\" alt=\"Two-panel meme of freight train hitting a school bus. Bus is standing on the tracks labelled ’extensive hardware tamper protection features’, in the second panel, freight train labelled ’exposed serial port with root shell’ rams the bus away.\"/\u003e\u003c/a\u003e\n              \u003cfigcaption\u003e\n                All this fancy hardware made useless by some lazy software\n                engineers?\n              \u003c/figcaption\u003e\n            \u003c/figure\u003e\n          \u003c/div\u003e\n          \u003cp\u003eActually, no. Hear me out: During my analysis of this device, it\n          became clear that the Linux system is not the whole story. For\n          example, there seems to be no graphics driver for the display and the\n          only framebuffer device does not seem to do anything. Instead, only\n          text strings seem to be passed to a binary\n          (\u003ccode\u003edisplay_tool\u003c/code\u003e), that issues some inter-processor\n          messages. The same goes for the key pad or the card reader itself. I\n          could not find any evidence that these peripherals could be accessed\n          directly from Linux.\u003c/p\u003e\n          \u003cp\u003eInstead, there is an entirely separate processor, refered to as\n          \u003ccode\u003emp1\u003c/code\u003e, that seems to handle all the “secure” stuff, like\n          handling the card, getting the pin and showing information on the\n          screen. The “insecure” Linux, running on the second processor,\n          \u003ccode\u003emp2\u003c/code\u003e, only handles the networking, the updating, and the\n          business logic.\u003c/p\u003e\n          \u003cp\u003eThe Linux core seems to always boot, regardless of the tamper\n          state. From there, the secure core is booted. For this, Linux\n          apparently loads a secure bootloader (named \u003ccode\u003eloadercode\u003c/code\u003e)\n          into memory. This loadercode checks whether the tamper protections\n          have been triggered and based on the result, either show the red\n          screen or continue to boot the actual “secure” image\n          (\u003ccode\u003emp1.img\u003c/code\u003e, in the Linux filesystem). This secure image\n          seems to be properly encrypted and signed by two entities.\u003c/p\u003e\n          \u003cdiv\u003e\n            \u003cfigure\u003e\n              \u003ca href=\"https://stefan-gloor.ch/img/yomani_diagram.jpg\"\u003e\u003cimg src=\"https://stefan-gloor.ch/img/yomani_diagram.jpg\" width=\"100%\" alt=\"Diagram showing the presumed boot process of the Yomani device. Linux always boots on mp2, which is the insecure application core. After that, it will take loadercode and mp1.img from the filesystem and boot it on the other, secure core.\"/\u003e\u003c/a\u003e\n              \u003cfigcaption\u003e\n                My current understanding of the Yomani boot process featuring\n                the Samoa II ASIC. The first core (insecure, application)\n                always boots Linux, which in turn loads a secure bootloader and\n                the secure image on the second core. The loadercode is what\n                displays the tamper messages on screen. The secure image, that\n                handles the card, display, and key pad, is properly encrypted\n                and signed.\n              \u003c/figcaption\u003e\n            \u003c/figure\u003e\n          \u003c/div\u003e\n          \u003ch2\u003eDisclosure Timeline\u003c/h2\u003e\n          \u003ctable\u003e\n            \u003ctbody\u003e\u003ctr\u003e\n              \u003cth scope=\"col\"\u003e\u003c/th\u003e\n              \u003cth scope=\"col\"\u003e\u003c/th\u003e\n            \u003c/tr\u003e\n            \u003ctr\u003e\n              \u003ctd\u003e14/11/2024\u003c/td\u003e\n              \u003ctd\u003eDiscovered the root shell\u003c/td\u003e\n            \u003c/tr\u003e\n            \u003ctr\u003e\n              \u003ctd\u003e15/11/2024\u003c/td\u003e\n              \u003ctd\u003eInformed manufacturer, announced 90 days until\n              publication\u003c/td\u003e\n            \u003c/tr\u003e\n            \u003ctr\u003e\n              \u003ctd\u003e18/11/2024\u003c/td\u003e\n              \u003ctd\u003eManufacturer confirms that they got the report\u003c/td\u003e\n            \u003c/tr\u003e\n            \u003ctr\u003e\n              \u003ctd\u003e\u003c/td\u003e\n              \u003ctd\u003e--- I forgot this project existed ---\u003c/td\u003e\n            \u003c/tr\u003e\n            \u003ctr\u003e\n              \u003ctd\u003e01/06/2025\u003c/td\u003e\n              \u003ctd\u003ePublication\u003c/td\u003e\n            \u003c/tr\u003e\n          \u003c/tbody\u003e\u003c/table\u003e\n          \u003ch2\u003eConclusion\u003c/h2\u003e\n          \u003cp\u003eWhile concerning, the exposed root shell does not seem to be as\n          big of a risk as initially feared.\n\t\t\tWhile still being a huge unnecessary attack surface, and a massive oversight from the engineers in my opinion,\n\t\t\tI could not find any evidence that sensitive data, such as card details, could become compromised this way.\n\t\t\tAlso, I could not definitively prove which firmware versions were vulnerable. During my research, I also encountered devices that\n\t\t\thad a disabled root login. My guess is that somehow this debug feature accidentally made it into production firmware at some point.\n\t\t\tChances are that this was discovered and fixed internally before I reported it to the manufacturer (as I had no way of updating the firmware,\n\t\t\tor verifying that I was running the latest firmware).\u003c/p\u003e\n\t\t\t\u003cp\u003e\n\t\t\tThis project was a lot of fun and I wish I had some more time to dig deeper into the firmware and explore more possibilities.\n\t\t\tIf you want to take on this challenge, feel free to reach out to me.\n\t\t\tI’d like to thank anyone involved in this project for their valuable input.\n\t\t\u003c/p\u003e\n        \u003c/div\u003e\n      \u003c/div\u003e\u003c/div\u003e",
  "readingTime": "16 min read",
  "publishedTime": null,
  "modifiedTime": null
}
