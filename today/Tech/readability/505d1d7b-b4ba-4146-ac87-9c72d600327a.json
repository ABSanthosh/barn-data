{
  "id": "505d1d7b-b4ba-4146-ac87-9c72d600327a",
  "title": "GPD Pocket 4 Speaker DSP: Configuring PipeWire so laptop speakers sound better",
  "link": "https://kittenlabs.de/blog/2025/04/06/gpd-pocket-4-speaker-dsp/",
  "description": "Comments",
  "author": "",
  "published": "Wed, 09 Apr 2025 18:07:14 +0000",
  "source": "https://news.ycombinator.com/rss",
  "categories": null,
  "byline": "By Manawyrm (@manawyrm@chaos.social) | Sunday, April 06, 2025",
  "length": 2038,
  "excerpt": "Configuring PipeWire to make laptop speakers sound better (Bankstown, Convolution/FIR, etc.)",
  "siteName": "KittenLabs",
  "favicon": "https://kittenlabs.de/favicons/android-192x192.png",
  "text": "Configuring PipeWire to make laptop speakers sound better (Bankstown, Convolution/FIR, etc.)ResultMotivationModern speakers require a lot of DSP magic to sound as good as they do.Speakers traditionally needed to be built very carefully to achieve a very flat frequency response and as few artifacts as possible.These days, many mobile devices like phones, laptops, etc. do a lot of digital signal processing in software in order to make tiny speakers output a lot of sound.Many different tricks are used, such as psycho-acoustic bass enhancement, limiters (allowing for higher power peaks) and volume-dependent equalization (frequency response of human hearing is very volume-dependent).The Asahi Linux project (Linux on Apple Silicon MacBooks) has done a lot of work to make MacBooks sound as good as possible on Linux:AsahiLinux/asahi-audio: Userspace audio for Asahi LinuxHow?Using Room EQ Wizard the frequency/impulse response of the built-in speakers was measured.Even with very suboptimal measurement equipment (cheap microphone, questionable audio interface), we can clearly see the sloped bass response (expected with speakers of this size) and then also a very noticeable peak/resonance at ~4kHz.This peak is very audible and leads to a harsh, distorted sound when listening to music.REW can do arithmetic operations on the curves, so after generating a filter curve for a 300Hz slope, both channels were divided (A/B) against that curve and then inverted (1/A) and exported as a .wav impulse response.That impulse response .wav file can then be used in a convolution DSP filter.The DSP configuration/pipeline of a 14\" MacBook Pro was then used as a template, the multi-speaker setup (modern MacBooks have 6 speakers!) was stripped-down to just a single stereo pair and the parameters were changed a bit.The impulse response .wav was (of course) replaced with our newly generated REW output.Linksgpd-pocket-4-pipewire: GitHub Repositorygpd-pocket-4-pipewire: AUR packageRoom EQ Wizard: Software used to measure speaker parameters",
  "image": "https://kittenlabs.de/blog/2025/04/06/gpd-pocket-4-speaker-dsp/featured-before.png",
  "html": "\u003cdiv id=\"readability-page-1\" class=\"page\"\u003e\u003cdiv\u003e\u003cp\u003eConfiguring PipeWire to make laptop speakers sound better (Bankstown, Convolution/FIR, etc.)\u003c/p\u003e\u003ch3 id=\"result\"\u003eResult\u003ca href=\"#result\" aria-label=\"Heading self-link\"\u003e\u003c/a\u003e\u003c/h3\u003e\u003ciframe width=\"90%\" src=\"https://www.youtube-nocookie.com/embed/wNm5xq_xw3s\" title=\"YouTube video player\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share\" allowfullscreen=\"\"\u003e\u003c/iframe\u003e\u003ch3 id=\"motivation\"\u003eMotivation\u003ca href=\"#motivation\" aria-label=\"Heading self-link\"\u003e\u003c/a\u003e\u003c/h3\u003e\u003cp\u003eModern speakers require a lot of DSP magic to sound as good as they do.\u003cbr/\u003eSpeakers traditionally needed to be built very carefully to achieve a very flat frequency response and as few artifacts as possible.\u003c/p\u003e\u003cp\u003eThese days, many mobile devices like phones, laptops, etc. do a lot of digital signal processing in software in order to make tiny speakers output a lot of sound.\u003cbr/\u003eMany different tricks are used, such as \u003ca href=\"https://github.com/chadmed/bankstown\" target=\"_blank\"\u003epsycho-acoustic bass enhancement\u003c/a\u003e, limiters (allowing for higher power peaks) and \u003ca href=\"https://lsp-plug.in/?page=manuals\u0026amp;section=loud_comp_mono\" target=\"_blank\"\u003evolume-dependent equalization\u003c/a\u003e (frequency response of human hearing is very volume-dependent).\u003c/p\u003e\u003cp\u003eThe Asahi Linux project (Linux on Apple Silicon MacBooks) has done a lot of work to make MacBooks sound as good as possible on Linux:\u003cbr/\u003e\u003ca href=\"https://github.com/AsahiLinux/asahi-audio\" target=\"_blank\"\u003eAsahiLinux/asahi-audio: Userspace audio for Asahi Linux\u003c/a\u003e\u003c/p\u003e\u003ch3 id=\"how\"\u003eHow?\u003ca href=\"#how\" aria-label=\"Heading self-link\"\u003e\u003c/a\u003e\u003c/h3\u003e\u003cp\u003eUsing \u003ca href=\"https://www.roomeqwizard.com/\" target=\"_blank\"\u003eRoom EQ Wizard\u003c/a\u003e the frequency/impulse response of the built-in speakers was measured.\u003cbr/\u003eEven with very suboptimal measurement equipment (cheap microphone, questionable audio interface), we can clearly see the sloped bass response (expected with speakers of this size) and then also a very noticeable peak/resonance at ~4kHz.\u003cbr/\u003eThis peak is very audible and leads to a harsh, distorted sound when listening to music.\u003c/p\u003e\u003cp\u003e\u003cimg src=\"https://kittenlabs.de/blog/2025/04/06/gpd-pocket-4-speaker-dsp/featured-before.png\" alt=\"Frequency response curve, showing a very low bass response and a resonance at ~4kHz\"/\u003e\u003c/p\u003e\u003cp\u003eREW can do arithmetic operations on the curves, so after generating a filter curve for a 300Hz slope, both channels were divided (A/B) against that curve and then inverted (1/A) and exported as a .wav impulse response.\u003cbr/\u003eThat impulse response .wav file can then be used in a convolution DSP filter.\u003c/p\u003e\u003cp\u003eThe DSP configuration/pipeline of a 14\u0026#34; MacBook Pro was then used as a template, the multi-speaker setup (modern MacBooks have 6 speakers!) was stripped-down to just a single stereo pair and the parameters were changed a bit.\u003cbr/\u003eThe impulse response .wav was (of course) replaced with our newly generated REW output.\u003c/p\u003e\u003ch3 id=\"links\"\u003eLinks\u003ca href=\"#links\" aria-label=\"Heading self-link\"\u003e\u003c/a\u003e\u003c/h3\u003e\u003cul\u003e\u003cli\u003e\u003ca href=\"https://github.com/Manawyrm/gpd-pocket-4-pipewire\" target=\"_blank\"\u003egpd-pocket-4-pipewire\u003c/a\u003e: GitHub Repository\u003c/li\u003e\u003cli\u003e\u003ca href=\"https://aur.archlinux.org/packages/gpd-pocket-4-pipewire\" target=\"_blank\"\u003egpd-pocket-4-pipewire\u003c/a\u003e: AUR package\u003c/li\u003e\u003cli\u003e\u003ca href=\"https://www.roomeqwizard.com/\" target=\"_blank\"\u003eRoom EQ Wizard\u003c/a\u003e: Software used to measure speaker parameters\u003c/li\u003e\u003c/ul\u003e\u003c/div\u003e\u003c/div\u003e",
  "readingTime": "3 min read",
  "publishedTime": "2025-04-06T00:00:00Z",
  "modifiedTime": "2025-04-06T00:00:00Z"
}
