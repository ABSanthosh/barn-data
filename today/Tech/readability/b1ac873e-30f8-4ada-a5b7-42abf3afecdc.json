{
  "id": "b1ac873e-30f8-4ada-a5b7-42abf3afecdc",
  "title": "Kelly Can't Fail",
  "link": "https://win-vector.com/2024/12/19/kelly-cant-fail/",
  "description": "Comments",
  "author": "",
  "published": "Thu, 19 Dec 2024 23:07:15 +0000",
  "source": "https://news.ycombinator.com/rss",
  "categories": null,
  "byline": "John Mount",
  "length": 8139,
  "excerpt": "Introduction You may have heard of the Kelly bet allocation strategy. It is a system for correctly exploiting information or bias in a gambling situation. It is also known as a maximally aggressive…",
  "siteName": "Win Vector LLC",
  "favicon": "https://i0.wp.com/win-vector.com/wp-content/uploads/2020/06/cropped-wvlogosmall.png?fit=192%2C192\u0026ssl=1",
  "text": "By on December 19, 2024 • Introduction You may have heard of the Kelly bet allocation strategy. It is a system for correctly exploiting information or bias in a gambling situation. It is also known as a maximally aggressive or high variance strategy, in that betting more than the Kelly selection can be quite ruinous. I recently ran into a strange card game where the Kelly strategy is risk free with zero variance. Peter Winkler calls the game “Next Card Bet” in his remarkable book Mathematical Puzzles. The problem and solution appear to come from Thomas Cover. I find this betting game and its analysis amazing, and want to share them with you here. The Game The game is played as follows. A standard 52 card deck consisting of 26 red cards and 26 black cards is shuffled and the player start with a stake of $1. Each card is exposed one at a time, without being replaced in the deck. The player is allowed to bet any fraction of their current stake on whether the next card is black or red at a one to one payoff. The player clearly has advantageous strategies involving counting the number of black and red cards seen. Counting cards seen lets them know how many cards of each color remain in the unseen portion of the deck. For example they can safely double their stake by not betting on any card other than the last. This allows them to safely bet their entire stake on the now inferable color of the final unseen card. The Kelly strategy The Kelly strategy is to pick a bet that maximizes the expected logarithm of the stake. We can derive it as follows. Let r be the number red cards remaining in the deck and b black cards remaining. Without loss of generality assume r \u003e b. We then want to maximize P[draw red] * log(1 + bet_fraction) + P[draw black] * log(1 - bet_fraction) as a function of bet_fraction. This expression is maximized where its derivative is zero. The probability of drawing red next is r/(r + b). So we need to solve (r/(r + b)) / (1 + bet_fraction) - (b/(r + b)) / (1 - bet_fraction) = 0. Some algebra tells us bet_fraction = (r - b) / (r + b). The entire Kelly betting strategy is then: If r = b, then no bet If r \u003e b bet a |r - b| / (r + b) fraction of your stake on “red” If b \u003e r bet a |r - b| / (r + b) fraction of your stake on “black.” Trying the strategy You really should see this strategy in action. It is a strong claim that it is in fact zero variance, so we really should insist on that being confirmed. We will work the example in Python. In[1]: # import tools import numpy as np In[2]: # set up our pseudo-random number generator to produce shuffled decks rng = np.random.default_rng(2024) In[3]: # define our deck shuffling tool def k_array_with_t_true(k: int, t: int): \"\"\"Create a length-k boolean array with t-True values\"\"\" is_true = np.array([False] * k, dtype=bool) is_true[rng.choice(k, size=t, replace=False)] = True return is_true In[4]: # implement our betting strategy def run_bets(is_red) -\u003e float: \"\"\"Run the Kelly betting strategy\"\"\" stake = 1.0 n_red_remaining = int(np.sum(is_red)) n_black_remaining = len(is_red) - n_red_remaining for i in range(len(is_red)): # form bet bet_red = 0 bet_black = 0 fraction = np.abs(n_red_remaining - n_black_remaining) / (n_red_remaining + n_black_remaining) if n_red_remaining \u003e n_black_remaining: bet_red = stake * fraction elif n_black_remaining \u003e n_red_remaining: bet_black = stake * fraction # derive outcome stake = stake - (bet_red + bet_black) if is_red[i]: stake = stake + 2 * bet_red n_red_remaining = n_red_remaining - 1 else: stake = stake + 2 * bet_black n_black_remaining = n_black_remaining - 1 return stake In[5]: # play the game 10000 times payoffs = [ run_bets(k_array_with_t_true(52, 26)) for _ in range(10000) ] assert np.max(payoffs) - 1e-8 \u003c np.min(payoffs) (np.min(payoffs), np.max(payoffs)) Out[5]: (9.081329549427776, 9.081329549427803) For each run we made a return of 9.08 times our starting stake. It is remarkable that there was no variation or variance in the outcomes. Notice this 9.08 times return is much larger than the 2 times return of the simple “wait to the end” strategy. This result is very unusual for a Kelly strategy. Kelly strategies guarantee to not “bust” (lose all of the money) and to maximize the expected growth rate of the logarithm of the stake. But they usually guarantee little else, can in fact lose money, and are usually high variance. How is it that in this case Kelly can’t fail? An explanation There is a remarkable proof that the strategy is zero variance. There are (52 choose 26) = 495,918,532,948,104 possible arrangements of red versus black cards. It is a standard result (not proven here) that each of these arrangements is in fact equally likely in a properly shuffled deck. We define a new “portfolio” strategy as follows. Each of the (52 choose 26) possible red/black arrangements is assigned as a sub-strategy in our portfolio. We allocate a 1/(52 choose 26) fraction of our initial stake to each sub-strategy. We allow each sub-strategy to keep its own money and do not re-allocate money between sub-strategies. Each sub-strategy assumes its assigned red/black arrangement is what is going to happen in the actual deck. The sub-strategy bets its entire stake on each card, betting the card exposed will match the corresponding one it its own defining arrangement. All but one of the portfolio sub-strategies will lose all of their money- as they eventually bet all their stake on a wrong guess. The single strategy that correctly guesses the entire deck ends experiences 52 doublings and no losses. Thus this strategy multiplies its starting stake by 2^(52). So our portfolio strategy itself always experiences a total aggregate return of $1/(52 choose 26) * 2^(52) ~ $9.08 on an initial $1 stake. This ending portfolio return is independent of the order of the cards. The claim to finish the argument is: the new portfolio strategy is in fact identical to the earlier Kelly strategy. Consider what happens to the portfolio when we draw a red card. In our portfolio strategy a r / (r + b) fraction of the non-bankrupt sub-strategies expect the next card to be “red”, and a b / (r + b) fraction of the non-bankrupt sub-strategies expect the next card to be “black”. The next draw bankrupts one of these families, and doubles the other (depending on the drawn color). Some though shows the portfolio strategy evolves its combined stake as follows: Aggregate stake goes to stake * 2 * b / (r + b) on drawing “red” Aggregate stake goes to stake * 2 * r / (r + b) on drawing “black.” It is a matter of algebra to confirm this portfolio payoff is exactly the payoff pattern for our earlier Kelly strategy of putting |r - b| / (r + b) on the most common color remaining. The Kelly strategy has exactly the same payoffs as the portfolio strategy, and we have our result that the two strategies are one and the same. The Kelly strategy is zero variance because it is identical to the portfolio strategy that is itself zero variance. An idea I like to take away is as follows. As we are betting on majority color, every time we lose a bet the deck becomes more unbalanced and more favorable to us. If we make the bet small enough then the gain in edge on a wrong bet offsets the loss of capital. In this case the Kelly strategy is pricing information or pricing uncertainty just right. This is similar to considerations of “exploration versus exploitation phases” in problems such as A/B testing. The proof given is from Winkler Mathematical Puzzles. I strongly recommend picking up the book to see his writeup on this and many other problems. The proof itself is very much the style of Cover. This is the Cover who later goes on to invent the universal portfolio investment strategy. Categories: Mathematics Quantitative Finance Tutorials Tagged as: betting iPython Kelly Criterion pydata python John Mount",
  "image": "https://i0.wp.com/win-vector.com/wp-content/uploads/2020/06/cropped-wvlogosmall.png?fit=512%2C512\u0026ssl=1",
  "html": "\u003cdiv id=\"readability-page-1\" class=\"page\"\u003e\u003carticle id=\"post-17429\"\u003e\n\t\n\t\t\u003cp\u003e\nBy  on \u003ca href=\"https://win-vector.com/2024/12/19/kelly-cant-fail/\" title=\"3:05 pm\" rel=\"bookmark\"\u003e\u003ctime datetime=\"2024-12-19T15:05:19-08:00\"\u003eDecember 19, 2024\u003c/time\u003e\u003c/a\u003e\t• \n\t\u003c/p\u003e\n\t\u003csection\u003e\n\n\u003cdiv data-mime-type=\"text/markdown\" tabindex=\"0\"\u003e\n\u003ch2 id=\"Introduction\"\u003eIntroduction\u003ca href=\"#Introduction\"\u003e \u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003eYou may have heard of the \u003ca href=\"https://en.wikipedia.org/wiki/Kelly_criterion\"\u003eKelly bet allocation strategy\u003c/a\u003e. It is a system for correctly exploiting information or bias in a gambling situation. It is also known as a maximally aggressive or high variance strategy, in that betting more than the Kelly selection can be quite ruinous.\u003cbr/\u003e\nI recently ran into a strange card game where the Kelly strategy is risk free with \u003cem\u003ezero variance\u003c/em\u003e. Peter Winkler calls the game “Next Card Bet” in his remarkable book \u003cem\u003eMathematical Puzzles\u003c/em\u003e. The problem and solution appear to come from Thomas Cover. I find this betting game and its analysis amazing, and want to share them with you here.\n\u003c/p\u003e\u003c/div\u003e\n\u003cdiv data-mime-type=\"text/markdown\" tabindex=\"0\"\u003e\n\u003ch2 id=\"The-Game\"\u003eThe Game\u003ca href=\"#The-Game\"\u003e \u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003eThe game is played as follows. A standard 52 card deck consisting of 26 red cards and 26 black cards is shuffled and the player start with a stake of $1. Each card is exposed one at a time, without being replaced in the deck. The player is allowed to bet any fraction of their current stake on whether the next card is black or red at a one to one payoff.\u003cbr/\u003e\nThe player clearly has advantageous strategies involving counting the number of black and red cards seen. Counting cards seen lets them know how many cards of each color remain in the unseen portion of the deck. For example they can safely double their stake by not betting on any card other than the last. This allows them to safely bet their entire stake on the now inferable color of the final unseen card.\n\u003c/p\u003e\u003c/div\u003e\n\u003cdiv data-mime-type=\"text/markdown\" tabindex=\"0\"\u003e\n\u003ch2 id=\"The-Kelly-strategy\"\u003eThe Kelly strategy\u003ca href=\"#The-Kelly-strategy\"\u003e \u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003eThe Kelly strategy is to pick a bet that maximizes the expected logarithm of the stake. We can derive it as follows.\u003cbr/\u003e\nLet \u003ccode\u003er\u003c/code\u003e be the number red cards remaining in the deck and \u003ccode\u003eb\u003c/code\u003e black cards remaining. Without loss of generality assume \u003ccode\u003er \u0026gt; b\u003c/code\u003e. We then want to maximize \u003ccode\u003eP[draw red] * log(1 + bet_fraction) + P[draw black] * log(1 - bet_fraction)\u003c/code\u003e as a function of \u003ccode\u003ebet_fraction\u003c/code\u003e. This expression is maximized where its derivative is zero. The probability of drawing red next is \u003ccode\u003er/(r + b)\u003c/code\u003e. So we need to solve \u003ccode\u003e(r/(r + b)) / (1 + bet_fraction) - (b/(r + b)) / (1 - bet_fraction) = 0\u003c/code\u003e. Some algebra tells us \u003ccode\u003ebet_fraction = (r - b) / (r + b)\u003c/code\u003e.\u003cbr/\u003e\nThe entire Kelly betting strategy is then:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eIf \u003ccode\u003er = b\u003c/code\u003e, then no bet\u003c/li\u003e\n\u003cli\u003eIf \u003ccode\u003er \u0026gt; b\u003c/code\u003e bet a \u003ccode\u003e|r - b| / (r + b)\u003c/code\u003e fraction of your stake on “red”\u003c/li\u003e\n\u003cli\u003eIf \u003ccode\u003eb \u0026gt; r\u003c/code\u003e bet a \u003ccode\u003e|r - b| / (r + b)\u003c/code\u003e fraction of your stake on “black.”\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/div\u003e\n\u003cdiv data-mime-type=\"text/markdown\" tabindex=\"0\"\u003e\n\u003ch2 id=\"Trying-the-strategy\"\u003eTrying the strategy\u003ca href=\"#Trying-the-strategy\"\u003e \u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003eYou really should see this strategy in action. It is a strong claim that it is in fact zero variance, so we really should insist on that being confirmed. We will work the example in Python.\n\u003c/p\u003e\u003c/div\u003e\n\u003cdiv tabindex=\"0\"\u003e\n\u003cp\u003eIn[1]:\u003c/p\u003e\n\u003cdiv data-type=\"inline\"\u003e\n\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan\u003e# import tools\u003c/span\u003e\n\u003cspan\u003eimport\u003c/span\u003e \u003cspan\u003enumpy\u003c/span\u003e \u003cspan\u003eas\u003c/span\u003e \u003cspan\u003enp\u003c/span\u003e\n\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv tabindex=\"0\"\u003e\n\u003cp\u003eIn[2]:\u003c/p\u003e\n\u003cdiv data-type=\"inline\"\u003e\n\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan\u003e# set up our pseudo-random number generator to produce shuffled decks\u003c/span\u003e\n\u003cspan\u003erng\u003c/span\u003e \u003cspan\u003e=\u003c/span\u003e \u003cspan\u003enp\u003c/span\u003e\u003cspan\u003e.\u003c/span\u003e\u003cspan\u003erandom\u003c/span\u003e\u003cspan\u003e.\u003c/span\u003e\u003cspan\u003edefault_rng\u003c/span\u003e\u003cspan\u003e(\u003c/span\u003e\u003cspan\u003e2024\u003c/span\u003e\u003cspan\u003e)\u003c/span\u003e\n\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv tabindex=\"0\"\u003e\n\u003cp\u003eIn[3]:\u003c/p\u003e\n\u003cdiv data-type=\"inline\"\u003e\n\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan\u003e# define our deck shuffling tool\u003c/span\u003e\n\u003cspan\u003edef\u003c/span\u003e \u003cspan\u003ek_array_with_t_true\u003c/span\u003e\u003cspan\u003e(\u003c/span\u003e\u003cspan\u003ek\u003c/span\u003e\u003cspan\u003e:\u003c/span\u003e \u003cspan\u003eint\u003c/span\u003e\u003cspan\u003e,\u003c/span\u003e \u003cspan\u003et\u003c/span\u003e\u003cspan\u003e:\u003c/span\u003e \u003cspan\u003eint\u003c/span\u003e\u003cspan\u003e):\u003c/span\u003e\n\u003cspan\u003e    \u003c/span\u003e\u003cspan\u003e\u0026#34;\u0026#34;\u0026#34;Create a length-k boolean array with t-True values\u0026#34;\u0026#34;\u0026#34;\u003c/span\u003e\n    \u003cspan\u003eis_true\u003c/span\u003e \u003cspan\u003e=\u003c/span\u003e \u003cspan\u003enp\u003c/span\u003e\u003cspan\u003e.\u003c/span\u003e\u003cspan\u003earray\u003c/span\u003e\u003cspan\u003e([\u003c/span\u003e\u003cspan\u003eFalse\u003c/span\u003e\u003cspan\u003e]\u003c/span\u003e \u003cspan\u003e*\u003c/span\u003e \u003cspan\u003ek\u003c/span\u003e\u003cspan\u003e,\u003c/span\u003e \u003cspan\u003edtype\u003c/span\u003e\u003cspan\u003e=\u003c/span\u003e\u003cspan\u003ebool\u003c/span\u003e\u003cspan\u003e)\u003c/span\u003e\n    \u003cspan\u003eis_true\u003c/span\u003e\u003cspan\u003e[\u003c/span\u003e\u003cspan\u003erng\u003c/span\u003e\u003cspan\u003e.\u003c/span\u003e\u003cspan\u003echoice\u003c/span\u003e\u003cspan\u003e(\u003c/span\u003e\u003cspan\u003ek\u003c/span\u003e\u003cspan\u003e,\u003c/span\u003e \u003cspan\u003esize\u003c/span\u003e\u003cspan\u003e=\u003c/span\u003e\u003cspan\u003et\u003c/span\u003e\u003cspan\u003e,\u003c/span\u003e \u003cspan\u003ereplace\u003c/span\u003e\u003cspan\u003e=\u003c/span\u003e\u003cspan\u003eFalse\u003c/span\u003e\u003cspan\u003e)]\u003c/span\u003e \u003cspan\u003e=\u003c/span\u003e \u003cspan\u003eTrue\u003c/span\u003e\n    \u003cspan\u003ereturn\u003c/span\u003e \u003cspan\u003eis_true\u003c/span\u003e\n\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv tabindex=\"0\"\u003e\n\u003cp\u003eIn[4]:\u003c/p\u003e\n\u003cdiv data-type=\"inline\"\u003e\n\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan\u003e# implement our betting strategy\u003c/span\u003e\n\u003cspan\u003edef\u003c/span\u003e \u003cspan\u003erun_bets\u003c/span\u003e\u003cspan\u003e(\u003c/span\u003e\u003cspan\u003eis_red\u003c/span\u003e\u003cspan\u003e)\u003c/span\u003e \u003cspan\u003e-\u0026gt;\u003c/span\u003e \u003cspan\u003efloat\u003c/span\u003e\u003cspan\u003e:\u003c/span\u003e\n\u003cspan\u003e    \u003c/span\u003e\u003cspan\u003e\u0026#34;\u0026#34;\u0026#34;Run the Kelly betting strategy\u0026#34;\u0026#34;\u0026#34;\u003c/span\u003e\n    \u003cspan\u003estake\u003c/span\u003e \u003cspan\u003e=\u003c/span\u003e \u003cspan\u003e1.0\u003c/span\u003e\n    \u003cspan\u003en_red_remaining\u003c/span\u003e \u003cspan\u003e=\u003c/span\u003e \u003cspan\u003eint\u003c/span\u003e\u003cspan\u003e(\u003c/span\u003e\u003cspan\u003enp\u003c/span\u003e\u003cspan\u003e.\u003c/span\u003e\u003cspan\u003esum\u003c/span\u003e\u003cspan\u003e(\u003c/span\u003e\u003cspan\u003eis_red\u003c/span\u003e\u003cspan\u003e))\u003c/span\u003e\n    \u003cspan\u003en_black_remaining\u003c/span\u003e \u003cspan\u003e=\u003c/span\u003e \u003cspan\u003elen\u003c/span\u003e\u003cspan\u003e(\u003c/span\u003e\u003cspan\u003eis_red\u003c/span\u003e\u003cspan\u003e)\u003c/span\u003e \u003cspan\u003e-\u003c/span\u003e \u003cspan\u003en_red_remaining\u003c/span\u003e\n    \u003cspan\u003efor\u003c/span\u003e \u003cspan\u003ei\u003c/span\u003e \u003cspan\u003ein\u003c/span\u003e \u003cspan\u003erange\u003c/span\u003e\u003cspan\u003e(\u003c/span\u003e\u003cspan\u003elen\u003c/span\u003e\u003cspan\u003e(\u003c/span\u003e\u003cspan\u003eis_red\u003c/span\u003e\u003cspan\u003e)):\u003c/span\u003e\n        \u003cspan\u003e# form bet\u003c/span\u003e\n        \u003cspan\u003ebet_red\u003c/span\u003e \u003cspan\u003e=\u003c/span\u003e \u003cspan\u003e0\u003c/span\u003e\n        \u003cspan\u003ebet_black\u003c/span\u003e \u003cspan\u003e=\u003c/span\u003e \u003cspan\u003e0\u003c/span\u003e\n        \u003cspan\u003efraction\u003c/span\u003e \u003cspan\u003e=\u003c/span\u003e \u003cspan\u003enp\u003c/span\u003e\u003cspan\u003e.\u003c/span\u003e\u003cspan\u003eabs\u003c/span\u003e\u003cspan\u003e(\u003c/span\u003e\u003cspan\u003en_red_remaining\u003c/span\u003e \u003cspan\u003e-\u003c/span\u003e \u003cspan\u003en_black_remaining\u003c/span\u003e\u003cspan\u003e)\u003c/span\u003e \u003cspan\u003e/\u003c/span\u003e \u003cspan\u003e(\u003c/span\u003e\u003cspan\u003en_red_remaining\u003c/span\u003e \u003cspan\u003e+\u003c/span\u003e \u003cspan\u003en_black_remaining\u003c/span\u003e\u003cspan\u003e)\u003c/span\u003e\n        \u003cspan\u003eif\u003c/span\u003e \u003cspan\u003en_red_remaining\u003c/span\u003e \u003cspan\u003e\u0026gt;\u003c/span\u003e \u003cspan\u003en_black_remaining\u003c/span\u003e\u003cspan\u003e:\u003c/span\u003e\n            \u003cspan\u003ebet_red\u003c/span\u003e \u003cspan\u003e=\u003c/span\u003e \u003cspan\u003estake\u003c/span\u003e \u003cspan\u003e*\u003c/span\u003e \u003cspan\u003efraction\u003c/span\u003e\n        \u003cspan\u003eelif\u003c/span\u003e \u003cspan\u003en_black_remaining\u003c/span\u003e \u003cspan\u003e\u0026gt;\u003c/span\u003e \u003cspan\u003en_red_remaining\u003c/span\u003e\u003cspan\u003e:\u003c/span\u003e\n            \u003cspan\u003ebet_black\u003c/span\u003e \u003cspan\u003e=\u003c/span\u003e \u003cspan\u003estake\u003c/span\u003e \u003cspan\u003e*\u003c/span\u003e \u003cspan\u003efraction\u003c/span\u003e\n        \u003cspan\u003e# derive outcome\u003c/span\u003e\n        \u003cspan\u003estake\u003c/span\u003e \u003cspan\u003e=\u003c/span\u003e \u003cspan\u003estake\u003c/span\u003e \u003cspan\u003e-\u003c/span\u003e \u003cspan\u003e(\u003c/span\u003e\u003cspan\u003ebet_red\u003c/span\u003e \u003cspan\u003e+\u003c/span\u003e \u003cspan\u003ebet_black\u003c/span\u003e\u003cspan\u003e)\u003c/span\u003e\n        \u003cspan\u003eif\u003c/span\u003e \u003cspan\u003eis_red\u003c/span\u003e\u003cspan\u003e[\u003c/span\u003e\u003cspan\u003ei\u003c/span\u003e\u003cspan\u003e]:\u003c/span\u003e\n            \u003cspan\u003estake\u003c/span\u003e \u003cspan\u003e=\u003c/span\u003e \u003cspan\u003estake\u003c/span\u003e \u003cspan\u003e+\u003c/span\u003e \u003cspan\u003e2\u003c/span\u003e \u003cspan\u003e*\u003c/span\u003e \u003cspan\u003ebet_red\u003c/span\u003e\n            \u003cspan\u003en_red_remaining\u003c/span\u003e \u003cspan\u003e=\u003c/span\u003e \u003cspan\u003en_red_remaining\u003c/span\u003e \u003cspan\u003e-\u003c/span\u003e \u003cspan\u003e1\u003c/span\u003e\n        \u003cspan\u003eelse\u003c/span\u003e\u003cspan\u003e:\u003c/span\u003e\n            \u003cspan\u003estake\u003c/span\u003e \u003cspan\u003e=\u003c/span\u003e \u003cspan\u003estake\u003c/span\u003e \u003cspan\u003e+\u003c/span\u003e \u003cspan\u003e2\u003c/span\u003e \u003cspan\u003e*\u003c/span\u003e \u003cspan\u003ebet_black\u003c/span\u003e\n            \u003cspan\u003en_black_remaining\u003c/span\u003e \u003cspan\u003e=\u003c/span\u003e \u003cspan\u003en_black_remaining\u003c/span\u003e \u003cspan\u003e-\u003c/span\u003e \u003cspan\u003e1\u003c/span\u003e\n    \u003cspan\u003ereturn\u003c/span\u003e \u003cspan\u003estake\u003c/span\u003e\n\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv\u003e\n\u003cdiv tabindex=\"0\"\u003e\n\u003cp\u003eIn[5]:\u003c/p\u003e\n\u003cdiv data-type=\"inline\"\u003e\n\u003cpre\u003e\u003cspan\u003e\u003c/span\u003e\u003cspan\u003e# play the game 10000 times\u003c/span\u003e\n\u003cspan\u003epayoffs\u003c/span\u003e \u003cspan\u003e=\u003c/span\u003e \u003cspan\u003e[\u003c/span\u003e\n    \u003cspan\u003erun_bets\u003c/span\u003e\u003cspan\u003e(\u003c/span\u003e\u003cspan\u003ek_array_with_t_true\u003c/span\u003e\u003cspan\u003e(\u003c/span\u003e\u003cspan\u003e52\u003c/span\u003e\u003cspan\u003e,\u003c/span\u003e \u003cspan\u003e26\u003c/span\u003e\u003cspan\u003e))\u003c/span\u003e \u003cspan\u003efor\u003c/span\u003e \u003cspan\u003e_\u003c/span\u003e \u003cspan\u003ein\u003c/span\u003e \u003cspan\u003erange\u003c/span\u003e\u003cspan\u003e(\u003c/span\u003e\u003cspan\u003e10000\u003c/span\u003e\u003cspan\u003e)\u003c/span\u003e\n\u003cspan\u003e]\u003c/span\u003e\n\u003cspan\u003eassert\u003c/span\u003e \u003cspan\u003enp\u003c/span\u003e\u003cspan\u003e.\u003c/span\u003e\u003cspan\u003emax\u003c/span\u003e\u003cspan\u003e(\u003c/span\u003e\u003cspan\u003epayoffs\u003c/span\u003e\u003cspan\u003e)\u003c/span\u003e \u003cspan\u003e-\u003c/span\u003e \u003cspan\u003e1e-8\u003c/span\u003e \u003cspan\u003e\u0026lt;\u003c/span\u003e \u003cspan\u003enp\u003c/span\u003e\u003cspan\u003e.\u003c/span\u003e\u003cspan\u003emin\u003c/span\u003e\u003cspan\u003e(\u003c/span\u003e\u003cspan\u003epayoffs\u003c/span\u003e\u003cspan\u003e)\u003c/span\u003e \n\n\u003cspan\u003e(\u003c/span\u003e\u003cspan\u003enp\u003c/span\u003e\u003cspan\u003e.\u003c/span\u003e\u003cspan\u003emin\u003c/span\u003e\u003cspan\u003e(\u003c/span\u003e\u003cspan\u003epayoffs\u003c/span\u003e\u003cspan\u003e),\u003c/span\u003e \u003cspan\u003enp\u003c/span\u003e\u003cspan\u003e.\u003c/span\u003e\u003cspan\u003emax\u003c/span\u003e\u003cspan\u003e(\u003c/span\u003e\u003cspan\u003epayoffs\u003c/span\u003e\u003cspan\u003e))\u003c/span\u003e\n\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv\u003e\n\u003cp\u003eOut[5]:\u003c/p\u003e\n\u003cdiv data-mime-type=\"text/plain\" tabindex=\"0\"\u003e\n\u003cpre\u003e(9.081329549427776, 9.081329549427803)\u003c/pre\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003c/div\u003e\n\u003cdiv tabindex=\"0\"\u003e\n\n\u003cp\u003e\nFor each run we made a return of \u003ccode\u003e9.08\u003c/code\u003e times our starting stake. It is remarkable that there was no variation or variance in the outcomes. Notice this \u003ccode\u003e9.08\u003c/code\u003e times return is much larger than the \u003ccode\u003e2\u003c/code\u003e times return of the simple “wait to the end” strategy.\u003cbr/\u003e\nThis result is very unusual for a Kelly strategy. Kelly strategies guarantee to not “bust” (lose all of the money) and to maximize the expected growth rate of the logarithm of the stake. But they usually guarantee little else, can in fact lose money, and are usually high variance. How is it that in this case Kelly \u003cem\u003ecan’t\u003c/em\u003e fail?\n\u003c/p\u003e\n\u003c/div\u003e\n\u003cdiv data-mime-type=\"text/markdown\" tabindex=\"0\"\u003e\n\u003ch2 id=\"An-explanation\"\u003eAn explanation\u003ca href=\"#An-explanation\"\u003e \u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003eThere is a remarkable proof that the strategy is zero variance.\u003cbr/\u003e\nThere are \u003ccode\u003e(52 choose 26) = 495,918,532,948,104\u003c/code\u003e possible arrangements of red versus black cards. It is a standard result (not proven here) that each of these arrangements is in fact equally likely in a properly shuffled deck.\u003cbr/\u003e\nWe define a new “portfolio” strategy as follows.\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eEach of the \u003ccode\u003e(52 choose 26)\u003c/code\u003e possible red/black arrangements is assigned as a sub-strategy in our portfolio.\u003c/li\u003e\n\u003cli\u003eWe allocate a \u003ccode\u003e1/(52 choose 26)\u003c/code\u003e fraction of our initial stake to each sub-strategy. We allow each sub-strategy to keep its own money and do not re-allocate money between sub-strategies.\u003c/li\u003e\n\u003cli\u003eEach sub-strategy assumes its assigned red/black arrangement is what is going to happen in the actual deck. The sub-strategy bets its entire stake on each card, betting the card exposed will match the corresponding one it its own defining arrangement.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eAll but one of the portfolio sub-strategies will lose all of their money- as they eventually bet all their stake on a wrong guess. The single strategy that correctly guesses the entire deck ends experiences \u003ccode\u003e52\u003c/code\u003e doublings and no losses. Thus this strategy multiplies its starting stake by \u003ccode\u003e2^(52)\u003c/code\u003e. So our portfolio strategy itself always experiences a total aggregate return of \u003ccode\u003e$1/(52 choose 26) * 2^(52) ~ $9.08\u003c/code\u003e on an initial \u003ccode\u003e$1\u003c/code\u003e stake. This ending portfolio return is independent of the order of the cards.\u003cbr/\u003e\nThe claim to finish the argument is: the new portfolio strategy is in fact identical to the earlier Kelly strategy.\u003cbr/\u003e\nConsider what happens to the portfolio when we draw a red card. In our portfolio strategy a \u003ccode\u003er / (r + b)\u003c/code\u003e fraction of the non-bankrupt sub-strategies expect the next card to be “red”, and a \u003ccode\u003eb / (r + b)\u003c/code\u003e fraction of the non-bankrupt sub-strategies expect the next card to be “black”. The next draw bankrupts one of these families, and doubles the other (depending on the drawn color). Some though shows the portfolio strategy evolves its combined stake as follows:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eAggregate \u003ccode\u003estake\u003c/code\u003e goes to \u003ccode\u003estake * 2 * b / (r + b)\u003c/code\u003e on drawing “red”\u003c/li\u003e\n\u003cli\u003eAggregate \u003ccode\u003estake\u003c/code\u003e goes to \u003ccode\u003estake * 2 * r / (r + b)\u003c/code\u003e on drawing “black.”\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eIt is a matter of algebra to confirm this portfolio payoff is \u003cem\u003eexactly\u003c/em\u003e the payoff pattern for our earlier Kelly strategy of putting \u003ccode\u003e|r - b| / (r + b)\u003c/code\u003e on the most common color remaining. The Kelly strategy has exactly the same payoffs as the portfolio strategy, and we have our result that the two strategies are one and the same.\u003cbr/\u003e\nThe Kelly strategy is zero variance because it is identical to the portfolio strategy that is itself zero variance.\n\u003c/p\u003e\u003c/div\u003e\n\u003cdiv data-mime-type=\"text/markdown\" tabindex=\"0\"\u003e\n\n\u003cp\u003eAn idea I like to take away is as follows. As we are betting on majority color, every time we lose a bet the deck becomes more unbalanced and more favorable to us. If we make the bet small enough then the gain in edge on a wrong bet offsets the loss of capital. In this case the Kelly strategy is pricing information or pricing uncertainty just right. This is similar to considerations of “exploration versus exploitation phases” in problems such as A/B testing.\u003cbr/\u003e\nThe proof given is from Winkler \u003cem\u003eMathematical Puzzles\u003c/em\u003e. I \u003cem\u003estrongly\u003c/em\u003e recommend picking up the book to see his writeup on this and many other problems. The proof itself is very much the style of Cover. This is the Cover who later goes on to invent the \u003ca href=\"https://isl.stanford.edu/~cover/papers/paper93.pdf\"\u003euniversal portfolio\u003c/a\u003e investment strategy.\n\u003c/p\u003e\u003c/div\u003e\n\t\t\u003cp\u003eCategories: \u003ca href=\"https://win-vector.com/category/mathematics/\" rel=\"category tag\"\u003eMathematics\u003c/a\u003e \u003ca href=\"https://win-vector.com/category/quantitative-finance/\" rel=\"category tag\"\u003eQuantitative Finance\u003c/a\u003e \u003ca href=\"https://win-vector.com/category/tutorials/\" rel=\"category tag\"\u003eTutorials\u003c/a\u003e\t\t\u003c/p\u003e\n\u003cp\u003eTagged as: \u003ca href=\"https://win-vector.com/tag/betting/\" rel=\"tag\"\u003ebetting\u003c/a\u003e \u003ca href=\"https://win-vector.com/tag/ipython/\" rel=\"tag\"\u003eiPython\u003c/a\u003e \u003ca href=\"https://win-vector.com/tag/kelly-criterion/\" rel=\"tag\"\u003eKelly Criterion\u003c/a\u003e \u003ca href=\"https://win-vector.com/tag/pydata/\" rel=\"tag\"\u003epydata\u003c/a\u003e \u003ca href=\"https://win-vector.com/tag/python/\" rel=\"tag\"\u003epython\u003c/a\u003e\u003c/p\u003e\t\u003cdiv\u003e\n\t\t\u003cp\u003e\u003cimg alt=\"\" src=\"https://secure.gravatar.com/avatar/a4b2fbd7b2c8df820b3ee6832ce2152b?s=100\u0026amp;d=identicon\u0026amp;r=g\" srcset=\"https://secure.gravatar.com/avatar/a4b2fbd7b2c8df820b3ee6832ce2152b?s=200\u0026amp;d=identicon\u0026amp;r=g 2x\" height=\"100\" width=\"100\" decoding=\"async\"/\u003e\u003c/p\u003e\u003ch3\u003eJohn Mount\u003c/h3\u003e\n\t\t\t\u003c/div\u003e\n\t\u003c/section\u003e\n\u003c/article\u003e\u003c/div\u003e",
  "readingTime": "9 min read",
  "publishedTime": "2024-12-19T23:05:19Z",
  "modifiedTime": "2024-12-20T00:25:32Z"
}
