{
  "id": "92eb3e81-7d55-4d7c-a065-883915b1e707",
  "title": "IPLS: Privacy-preserving storage for your WhatsApp contacts",
  "link": "https://engineering.fb.com/2024/10/22/security/ipls-privacy-preserving-storage-for-your-whatsapp-contacts/",
  "description": "Your contact list is fundamental to the experiences you love and enjoy on WhatsApp. With contacts, you know which of your friends and family are on WhatsApp, you can easily message or call them, and it helps give you context on who is in your groups. But losing your phone could mean losing your contact [...] Read More... The post IPLS: Privacy-preserving storage for your WhatsApp contacts appeared first on Engineering at Meta.",
  "author": "",
  "published": "Tue, 22 Oct 2024 12:59:46 +0000",
  "source": "https://engineering.fb.com/feed/",
  "categories": [
    "Security",
    "WhatsApp"
  ],
  "byline": "By Slavik Krassovsky, Kevin Lewi, Dillon George, Cheng Tian, Ercan Ozturk",
  "length": 6705,
  "excerpt": "Your contact list is fundamental to the experiences you love and enjoy on WhatsApp. With contacts, you know which of your friends and family are on WhatsApp, you can easily message or call them, an…",
  "siteName": "Engineering at Meta",
  "favicon": "",
  "text": "Your contact list is fundamental to the experiences you love and enjoy on WhatsApp. With contacts, you know which of your friends and family are on WhatsApp, you can easily message or call them, and it helps give you context on who is in your groups. But losing your phone could mean losing your contact list as well. Traditionally, WhatsApp has lacked the ability to store your contact list in a way that can be easily and automatically restored in the event you lose it. What’s more, the only place you were able to add contacts was from your mobile device, by either typing in a phone number or scanning a QR code. As part of WhatsApp’s new feature to privately add and manage your contacts on WhatsApp across linked devices, we’re announcing a novel encrypted storage system we’ve designed called Identity Proof Linked Storage (IPLS). IPLS allows you to save your contacts and automatically restore them directly through WhatsApp. With IPLS in place, you can now create contacts directly within WhatsApp and choose to sync them to your phone or securely save them only to WhatsApp – giving you the ability to create contacts that are specific to your account. If you use linked devices, this also allows you to add and manage contacts seamlessly regardless of which device you’re on. Additionally, if you have multiple accounts on the same phone, such as a work and personal account, you can now customize your contact list for each account. If you lose your phone, your contact list can be restored on a newly registered device.  Contact names are stored encrypted within WhatsApp, and we’ve built this with additional, robust protections by using IPLS to deter access to contacts to anyone except the user. IPLS incorporates new privacy technology that protects your contact lists in a privacy-preserving fashion. To further ensure the safety and security of this system, we’ve partnered with Cloudflare to provide independent third-party auditing of its cryptographic properties. The new technology stack was reviewed by external researchers and NCC Group Cryptography Services, an independent cybersecurity consultancy.  What is Identity Proof Linked Storage? IPLS is a novel system at WhatsApp that allows users to store their contact names in an encrypted way. IPLS allows the client device to save the contact information using a strong encryption key generated on the client device. Its retrieval is based on the client authenticating its primary device identity. IPLS is based on two existing pieces of technology that are already used at scale by WhatsApp: key transparency and our hardware security module (HSM).  Certain events associated with your phone’s WhatsApp application (such as installing or reinstalling) trigger the creation of a new cryptographic keypair that is associated with your phone number. WhatsApp’s key transparency system publishes records of these primary device identity key changes to an append-only, cryptographic Auditable Key Directory (AKD) that allows WhatsApp clients to automatically verify a user’s encryption key.  Key transparency allows WhatsApp, and the public at large, to cryptographically verify if a given phone number used for a WhatsApp account is tied to a given identity key. The HSMs are employed by WhatsApp end-to-end encrypted backups and allow for private, tamper-resistant execution of application logic within WhatsApp data centers in a privacy-preserving way. Data processing within HSM’s security boundary remains opaque even to WhatsApp insiders with the highest privilege and physical access to the hardware.  The components of IPLS The AKD and Cloudflare integration As mentioned, the first building block of IPLS is WhatsApp’s AKD, which maps a client phone number to a client identity key. Primary device identity is used to authenticate the client to ensure that only the owner of the contact encryption key is allowed to restore the contacts. To strengthen the single instance nature of AKD, WhatsApp has engaged Cloudflare to act as an additional witness of the additions to AKD. Cloudflare digitally signs each epoch, and associated root hash, and returns a digital signature validation confirming that the directory was not tampered with. The HSM-based Key Vault validates Cloudflare signature using Cloudflare’s public key. WhatsApp relies on the availability of the Cloudflare signing service and cannot proceed with the updates to AKD in the absence of the digital signature of each update. In addition, WhatsApp provides auditable proofs of consistency for the transitions between epochs. The auditable proofs are published to a write-once, read-many enabled Amazon S3 instance, which has a public interface for any entity to retrieve the proofs. Using AKD and partnering with Cloudflare ensures that there is only a single instance of the directory that is validated by a 3rd party. HSM-based key storage To ensure privacy for user contacts registered on WhatsApp, contact names are first encrypted using a symmetric encryption key generated by the user’s device, and then stored in the HSM-based Key Vault. Storage and retrieval of the contact encryption key occurs via an end-to-end encrypted channel between the client and the HSM-based Key Vault, ensuring that the data in transit remains opaque to WhatsApp.   Storing the contact key in the HSM-based Key Vault ensures its availability even when the user loses their phone. If a user loses their client device and wants to restore their contacts, the new client device can retrieve the contact key by establishing a secure session with the HSM-based Key Vault. The Key Vault verifies the client identity key by accessing AKD via a secure cryptographic protocol and verifying that the client has the corresponding private key. Once the client is verified, the new client is allowed to access the contact key in the HSM-based Key Vault using the secure channel established with the client identity key and the HSM key. IPLS is a new system that deters unauthorized access to sensitive data by effectively coupling any data access to publicly auditable identity key changes published to WhatsApp’s key transparency infrastructure. This approach is similar to how a QR code scanning technology can be used to detect a public key compromise in an end-to-end encrypted messaging system. WhatsApp’s new approach on contacts will give users more ways to easily manage contacts across devices and accounts and store them securely without losing them if they change phones or reinstall WhatsApp. We’re excited about how IPLS has helped enable this new feature and will help ensure WhatsApp contacts are encrypted and can easily move with users when they get a new phone.",
  "image": "https://engineering.fb.com/wp-content/uploads/2024/10/WhatsApp-IPLS-image-3_crop.png",
  "html": "\u003cdiv id=\"readability-page-1\" class=\"page\"\u003e\u003cdiv\u003e\n\n\t\t\u003cp\u003e\u003cspan\u003eYour contact list is fundamental to the experiences you love and enjoy on WhatsApp. With contacts, you know which of your friends and family are on WhatsApp, you can easily message or call them, and it helps give you context on who is in your groups. But losing your phone could mean losing your contact list as well. Traditionally, WhatsApp has lacked the ability to store your contact list in a way that can be easily and automatically restored in the event you lose it. What’s more, the only place you were able to add contacts was from your mobile device, by either typing in a phone number or scanning a QR code.\u003c/span\u003e\u003c/p\u003e\n\u003cp\u003e\u003cspan\u003eAs part of WhatsApp’s new feature to privately add and manage your contacts on WhatsApp across linked devices, we’re announcing a novel encrypted storage system we’ve designed called Identity Proof Linked Storage (IPLS). IPLS allows you to save your contacts and automatically restore them directly through WhatsApp. With IPLS in place, you can now create contacts directly within WhatsApp and choose to sync them to your phone or securely save them only to WhatsApp – giving you the ability to create contacts that are specific to your account. If you use linked devices, this also allows you to add and manage contacts seamlessly regardless of which device you’re on.\u003c/span\u003e\u003c/p\u003e\n\u003cp\u003e\u003cspan\u003eAdditionally, if you have multiple accounts on the same phone, such as a work and personal account, you can now customize your contact list for each account. If you lose your phone, your contact list can be restored on a newly registered device. \u003c/span\u003e\u003c/p\u003e\n\u003cp\u003e\u003cspan\u003eContact names are stored encrypted within WhatsApp, and we’ve built this with additional, robust protections by using IPLS to deter access to contacts to anyone except the user.\u003c/span\u003e\u003c/p\u003e\n\u003cp\u003e\u003cspan\u003eIPLS incorporates new privacy technology that protects your contact lists in a privacy-preserving fashion. To further ensure the safety and security of this system, we’ve \u003c/span\u003e\u003ca href=\"https://www.cloudflare.com/press-releases/2024/cloudflare-helps-secure-the-worlds-most-popular-messaging-applications/\"\u003e\u003cspan\u003epartnered with Cloudflare\u003c/span\u003e\u003c/a\u003e\u003cspan\u003e to provide\u003c/span\u003e\u003ca href=\"https://blog.cloudflare.com/key-transparency/\"\u003e\u003cspan\u003e independent third-party auditing\u003c/span\u003e\u003c/a\u003e\u003cspan\u003e of its cryptographic properties. The new technology stack was reviewed by external researchers and NCC Group Cryptography Services, an independent cybersecurity consultancy. \u003c/span\u003e\u003c/p\u003e\n\u003ch2\u003eWhat is Identity Proof Linked Storage?\u003c/h2\u003e\n\u003cp\u003e\u003cspan\u003eIPLS is a novel system at WhatsApp that allows users to store their contact names in an encrypted way. IPLS allows the client device to save the contact information using a strong encryption key generated on the client device. Its retrieval is based on the client authenticating its primary device identity.\u003c/span\u003e\u003c/p\u003e\n\u003cp\u003e\u003cspan\u003eIPLS is based on two existing pieces of technology that are already used at scale by WhatsApp: \u003c/span\u003e\u003ca href=\"https://engineering.fb.com/2023/04/13/security/whatsapp-key-transparency/\" target=\"_blank\" rel=\"noopener\"\u003e\u003cspan\u003ekey transparency\u003c/span\u003e\u003c/a\u003e\u003cspan\u003e and our \u003ca href=\"https://engineering.fb.com/2021/09/10/security/whatsapp-e2ee-backups/\" target=\"_blank\" rel=\"noopener\"\u003ehardware security module (HSM)\u003c/a\u003e. \u003c/span\u003e\u003c/p\u003e\n\u003cp\u003e\u003cspan\u003eCertain events associated with your phone’s WhatsApp application (such as installing or reinstalling) trigger the creation of a new cryptographic keypair that is associated with your phone number. WhatsApp’s key transparency system publishes records of these primary device identity key changes to an append-only, cryptographic \u003c/span\u003e\u003ca href=\"https://github.com/facebook/akd/\" target=\"_blank\" rel=\"noopener\"\u003e\u003cspan\u003eAuditable Key Directory (AKD)\u003c/span\u003e\u003c/a\u003e\u003cspan\u003e that allows WhatsApp clients to automatically verify a user’s encryption key. \u003c/span\u003e\u003c/p\u003e\n\u003cp\u003e\u003cspan\u003eKey transparency allows WhatsApp, and the public at large, to cryptographically verify if a given phone number used for a WhatsApp account is tied to a given identity key.\u003c/span\u003e\u003c/p\u003e\n\u003cp\u003e\u003cspan\u003eThe HSMs are employed by \u003c/span\u003e\u003ca href=\"https://www.whatsapp.com/security/WhatsApp_Security_Encrypted_Backups_Whitepaper.pdf\" target=\"_blank\" rel=\"noopener\"\u003e\u003cspan\u003eWhatsApp end-to-end encrypted backups\u003c/span\u003e\u003c/a\u003e\u003cspan\u003e and allow for private, tamper-resistant execution of application logic within WhatsApp data centers in a privacy-preserving way. Data processing within HSM’s security boundary remains opaque even to WhatsApp insiders with the highest privilege and physical access to the hardware. \u003c/span\u003e\u003c/p\u003e\n\u003ch2\u003e\u003cspan\u003eThe components of IPLS\u003c/span\u003e\u003c/h2\u003e\n\u003ch3\u003e\u003cspan\u003eThe AKD and Cloudflare integration\u003c/span\u003e\u003c/h3\u003e\n\u003cp\u003e\u003cspan\u003eAs mentioned, the first building block of IPLS is WhatsApp’s AKD, which maps a client phone number to a client identity key. Primary device identity is used to authenticate the client to ensure that only the owner of the contact encryption key is allowed to restore the contacts.\u003c/span\u003e\u003c/p\u003e\n\u003cp\u003e\u003cspan\u003eTo strengthen the single instance nature of AKD, \u003c/span\u003e\u003ca href=\"https://blog.cloudflare.com/key-transparency/\" target=\"_blank\" rel=\"noopener\"\u003e\u003cspan\u003eWhatsApp has engaged Cloudflare\u003c/span\u003e\u003c/a\u003e\u003cspan\u003e to act as an additional witness of the additions to AKD. Cloudflare digitally signs each epoch, and associated root hash, and returns a digital signature validation confirming that the directory was not tampered with. The HSM-based Key Vault validates Cloudflare signature using Cloudflare’s public key.\u003c/span\u003e\u003c/p\u003e\n\u003cp\u003e\u003cspan\u003eWhatsApp relies on the availability of the Cloudflare signing service and cannot proceed with the updates to AKD in the absence of the digital signature of each update.\u003c/span\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg decoding=\"async\" src=\"https://engineering.fb.com/wp-content/uploads/2024/10/WhatsApp-IPLS-image-1_crop-Copy.png?w=1024\" alt=\"\" width=\"1024\" height=\"320\" srcset=\"https://engineering.fb.com/wp-content/uploads/2024/10/WhatsApp-IPLS-image-1_crop-Copy.png 1920w, https://engineering.fb.com/wp-content/uploads/2024/10/WhatsApp-IPLS-image-1_crop-Copy.png?resize=916,286 916w, https://engineering.fb.com/wp-content/uploads/2024/10/WhatsApp-IPLS-image-1_crop-Copy.png?resize=768,240 768w, https://engineering.fb.com/wp-content/uploads/2024/10/WhatsApp-IPLS-image-1_crop-Copy.png?resize=1024,320 1024w, https://engineering.fb.com/wp-content/uploads/2024/10/WhatsApp-IPLS-image-1_crop-Copy.png?resize=1536,480 1536w, https://engineering.fb.com/wp-content/uploads/2024/10/WhatsApp-IPLS-image-1_crop-Copy.png?resize=96,30 96w, https://engineering.fb.com/wp-content/uploads/2024/10/WhatsApp-IPLS-image-1_crop-Copy.png?resize=192,60 192w\" sizes=\"(max-width: 992px) 100vw, 62vw\"/\u003e\u003c/p\u003e\n\u003cp\u003e\u003cspan\u003eIn addition, WhatsApp provides auditable proofs of consistency for the transitions between epochs. The auditable proofs are published to a write-once, read-many enabled Amazon S3 instance, which has a public interface for any entity to retrieve the proofs.\u003c/span\u003e\u003c/p\u003e\n\u003cp\u003e\u003cspan\u003eUsing AKD and partnering with Cloudflare ensures that there is only a single instance of the directory that is validated by a 3rd party.\u003c/span\u003e\u003c/p\u003e\n\u003ch3\u003e\u003cspan\u003eHSM-based key storage\u003c/span\u003e\u003c/h3\u003e\n\u003cp\u003e\u003cspan\u003eTo ensure privacy for user contacts registered on WhatsApp, contact names are first encrypted using a symmetric encryption key generated by the user’s device, and then stored in the HSM-based Key Vault. Storage and retrieval of the contact encryption key occurs via an end-to-end encrypted channel between the client and the HSM-based Key Vault, ensuring that the data in transit remains opaque to WhatsApp.  \u003c/span\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg decoding=\"async\" src=\"https://engineering.fb.com/wp-content/uploads/2024/10/WhatsApp-IPLS-image-2_crop.png?w=1024\" alt=\"\" width=\"1024\" height=\"320\" srcset=\"https://engineering.fb.com/wp-content/uploads/2024/10/WhatsApp-IPLS-image-2_crop.png 1920w, https://engineering.fb.com/wp-content/uploads/2024/10/WhatsApp-IPLS-image-2_crop.png?resize=916,286 916w, https://engineering.fb.com/wp-content/uploads/2024/10/WhatsApp-IPLS-image-2_crop.png?resize=768,240 768w, https://engineering.fb.com/wp-content/uploads/2024/10/WhatsApp-IPLS-image-2_crop.png?resize=1024,320 1024w, https://engineering.fb.com/wp-content/uploads/2024/10/WhatsApp-IPLS-image-2_crop.png?resize=1536,480 1536w, https://engineering.fb.com/wp-content/uploads/2024/10/WhatsApp-IPLS-image-2_crop.png?resize=96,30 96w, https://engineering.fb.com/wp-content/uploads/2024/10/WhatsApp-IPLS-image-2_crop.png?resize=192,60 192w\" sizes=\"(max-width: 992px) 100vw, 62vw\"/\u003e\u003c/p\u003e\n\u003cp\u003e\u003cspan\u003eStoring the contact key in the HSM-based Key Vault ensures its availability even when the user loses their phone. If a user loses their client device and wants to restore their contacts, the new client device can retrieve the contact key by establishing a secure session with the HSM-based Key Vault. The Key Vault verifies the client identity key by accessing AKD via a secure cryptographic protocol and verifying that the client has the corresponding private key.\u003c/span\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg loading=\"lazy\" decoding=\"async\" src=\"https://engineering.fb.com/wp-content/uploads/2024/10/WhatsApp-IPLS-image-3_crop.png?w=1024\" alt=\"\" width=\"1024\" height=\"320\" srcset=\"https://engineering.fb.com/wp-content/uploads/2024/10/WhatsApp-IPLS-image-3_crop.png 1920w, https://engineering.fb.com/wp-content/uploads/2024/10/WhatsApp-IPLS-image-3_crop.png?resize=916,286 916w, https://engineering.fb.com/wp-content/uploads/2024/10/WhatsApp-IPLS-image-3_crop.png?resize=768,240 768w, https://engineering.fb.com/wp-content/uploads/2024/10/WhatsApp-IPLS-image-3_crop.png?resize=1024,320 1024w, https://engineering.fb.com/wp-content/uploads/2024/10/WhatsApp-IPLS-image-3_crop.png?resize=1536,480 1536w, https://engineering.fb.com/wp-content/uploads/2024/10/WhatsApp-IPLS-image-3_crop.png?resize=96,30 96w, https://engineering.fb.com/wp-content/uploads/2024/10/WhatsApp-IPLS-image-3_crop.png?resize=192,60 192w\" sizes=\"(max-width: 992px) 100vw, 62vw\"/\u003e\u003c/p\u003e\n\u003cp\u003e\u003cspan\u003eOnce the client is verified, the new client is allowed to access the contact key in the HSM-based Key Vault using the secure channel established with the client identity key and the HSM key.\u003c/span\u003e\u003c/p\u003e\n\n\u003cp\u003e\u003cspan\u003eIPLS is a new system that deters unauthorized access to sensitive data by effectively coupling any data access to publicly auditable identity key changes published to WhatsApp’s key transparency infrastructure. This approach is similar to how a QR code scanning technology can be used to detect a public key compromise in an \u003c/span\u003e\u003ca href=\"https://faq.whatsapp.com/820124435853543\" target=\"_blank\" rel=\"noopener\"\u003e\u003cspan\u003eend-to-end encrypted messaging\u003c/span\u003e\u003c/a\u003e\u003cspan\u003e system.\u003c/span\u003e\u003c/p\u003e\n\u003cp\u003e\u003cspan\u003eWhatsApp’s new approach on contacts will give users more ways to easily manage contacts across devices and accounts and store them securely without losing them if they change phones or reinstall WhatsApp. We’re excited about how IPLS has helped enable this new feature and will help ensure WhatsApp contacts are encrypted and can easily move with users when they get a new phone. \u003c/span\u003e\u003c/p\u003e\n\n\t\t\n\t\u003c/div\u003e\u003c/div\u003e",
  "readingTime": "8 min read",
  "publishedTime": "2024-10-22T12:59:46Z",
  "modifiedTime": "2024-10-22T14:23:35Z"
}
