{
  "id": "2321b6ed-53c0-4a00-9567-56826a9911fa",
  "title": "Should I Block ICMP?",
  "link": "http://shouldiblockicmp.com/",
  "description": "Comments",
  "author": "",
  "published": "Wed, 21 May 2025 23:17:29 +0000",
  "source": "https://news.ycombinator.com/rss",
  "categories": null,
  "byline": "Jason Ashworth",
  "length": 8518,
  "excerpt": "Should I block ICMP",
  "siteName": "",
  "favicon": "",
  "text": "No!! The Problem Many network administrators feel that ICMP is a security risk, and should therefore always be blocked at the firewall. It is true that ICMP does have some security issues associated with it, and that a lot of ICMP should be blocked. But this is no reason to block all ICMP traffic! ICMP has many important features; some are useful for troubleshooting, while some are essential for a network to function correctly. Here are details of some of the important ICMP traffic that you should know about, and consider allowing through your network. Echo Request and Echo Reply IPv4 - Echo Request (Type8, Code0) and Echo Reply (Type0, Code0) IPv6 - Echo Request (Type128, Code0) and Echo Reply (Type129, Code0) We all know these ones - ping is one of the first troubleshooting tools that we all learn. Yes, if you enable it, it means that your host is now discoverable - but wasn't your web server already listening on port 80 anyway? Sure, block this if you really want at your border to your DMZ, but blocking ping traffic inside your network isn't going to get you much, except harder troubleshooting (\"Can you ping your default gateway?\", \"No, but I never can, so that doesn't tell me anything!\"). Remember you can also allow this with a given direction in mind; you could decide to let Echo Requests out from your network to the Internet, and Echo Replies from the Internet to your network, but not vice versa. Fragmentation Needed (IPv4) / Packet Too Big (IPv6) IPv4 - (Type3, Code4) IPv6 - (Type2, Code0) These ones are important. VERY important. They are an essential component in Path MTU Discovery (PMTUD), which is an essential part of TCP that allows two hosts to adjust their TCP Maximum Segment Size (MSS) value to one that will fit in the smallest MTU along the path of links between the two hosts. If two hosts have a smaller MTU than their own local link on the path between them, and have no means of discovering this, traffic gets silently black-holed; in other words, \"you're gonna have a bad time\". IPv4 packets with the DF bit set (that's most of them!), or IPv6 packets (remember there's no fragmentation by routers in IPv6), that are too large for a router to transmit across an interface will result in that router dropping the packet, and generating a Fragmentation Needed / Packet Too Big ICMP error back to the source, which also contains the MTU of the too-small link. If this error cannot get through to the sender, then the sender will just interpret the lack of ACKs from the receiver as congestion/loss and re-transmit, which of course will also get dropped. This kind of behaviour is tough to troubleshoot because of course the TCP handshakes all work fine, as they are small packets, but then the session appears to stall as soon as any bulk data transmission occurs. RFC 4821 was developed to help hosts get around this problem using Packetization Layer Path MTU Discovery (PLPMTUD), which discovers the path MTU by incrementally increasing the MSS to try to find a suitable value for the path. This removes the dependency on ICMP, and is available in most OS network stacks, but is not as efficient as learning directly what the maximum MTU should be. So please just allow these ICMP messages through in the first place, okay? Time Exceeded IPv4 - (Type11, Code0) IPv6 - (Type3, Code0) Traceroute is a very useful tool for troubleshooting network connections between two hosts, detailing each hop on the path. It does this by sending a packet with a TTL of 1 so that the first hop sends back a Time Exceeded message (including its own source IP), then sending a packet with a TTL of 2, and so on, to discover each hop on the path. Remember when you've run it before, and you get a hop or two that can't be discovered in the middle of your trace? Or even worse, you try to traceroute to a host and *every* hop can't be discovered. Annoying, right? That's because the person running those routers (or your local firewall) decided to block ICMP Time Exceeded messages. Don't be that guy, okay? NDP and SLAAC (IPv6) Router Solicitation (RS) (Type133, Code0) Router Advertisement (RA) (Type134, Code0) Neighbour Solicitation (NS) (Type135, Code0) Neighbour Advertisement (NA) (Type136, Code0) Redirect (Type137, Code0) While IPv4 used Address Resolution Protocol (ARP) for layer 2 to 3 mappings, IPv6 takes a different approach, in the form of Neighbour Discovery Protocol (NDP). NDP provides many functions, including router discovery, prefix discovery, address resolution, and many more besides. In addition to NDP, StateLess Address AutoConfiguration (SLAAC) allows a host to be dynamically configured on the network, similar in concept to DHCP (although DHCPv6 does exist for finer-grained control). These five ICMP types should be permitted within your network (not across your border) in order for these features of IPv6 to function correctly. A Word About Rate Limiting While ICMP messages like the ones covered on this page can be very useful, remember that generating all of these messages takes CPU time on your routers, and generates traffic. Do you really expect that you should be getting 1000 pings a second through your firewall in a normal situation? Would that be considered legitimate traffic if you saw it? Nope, probably not. Rate limit all of these ICMP traffic types as you see fit for your network; it's a good line of defence that should not be ignored. Read, Research, Understand Given that the \"to block or not to block\" discussion for ICMP seems to always result in confusion, anger, and borderline fanatical disagreements, go ahead and read up on the topic yourself. Spend time understanding it as fully as you can; there are plenty of links throughout this page alone. Then you can form your own opinion and make an informed choice about what is best for your network.",
  "image": "",
  "html": "\u003cdiv id=\"readability-page-1\" class=\"page\"\u003e\u003cdiv\u003e\n                    \u003cdiv\u003e\n                        \n                        \u003ch2\u003eNo!!\u003c/h2\u003e\n                        \u003c/div\u003e\n\n                    \u003cdiv id=\"TheProblem\"\u003e\n                        \u003ch4\u003eThe Problem\u003c/h4\u003e\n                        \u003cp\u003eMany network administrators feel that ICMP is a security risk, and should therefore always be blocked\n                        at the firewall.  It is true that ICMP does have some security issues associated with it, and that a lot\n                        of ICMP should be blocked.  But this is no reason to block all ICMP traffic!\u003c/p\u003e\n                        \u003cp\u003eICMP has many important features; some are useful for troubleshooting, while some are essential for a\n                        network to function correctly.  Here are details of some of the important ICMP traffic that you should\n                        know about, and consider allowing through your network.\u003c/p\u003e\n                        \u003cbr/\u003e\n                    \u003c/div\u003e\n\n                    \u003cdiv id=\"EchoReqReply\"\u003e\n                        \u003ch4\u003eEcho Request and Echo Reply\u003cbr/\u003e\n                            \u003csmall\u003eIPv4 - Echo Request (Type8, Code0) and Echo Reply (Type0, Code0)\u003cbr/\u003e\n                                IPv6 - Echo Request (Type128, Code0) and Echo Reply (Type129, Code0)\u003c/small\u003e\n                        \u003c/h4\u003e\n                        \u003cp\u003eWe all know these ones - ping is one of the first troubleshooting tools that we all learn.  Yes, if\n                        you enable it, it means that your host is now discoverable - but wasn\u0026#39;t your web server already\n                        listening on port 80 anyway?  Sure, block this if you really want at your border to your DMZ, but\n                        blocking ping traffic inside your network isn\u0026#39;t going to get you much, except harder troubleshooting\n                        (\u0026#34;Can you ping your default gateway?\u0026#34;, \u0026#34;No, but I never can, so that doesn\u0026#39;t tell me anything!\u0026#34;).\u003c/p\u003e\n                        \u003cp\u003eRemember you can also allow this with a given direction in mind; you could decide to let Echo\n                        Requests out from your network to the Internet, and Echo Replies from the Internet to your network, but\n                        not vice versa.\u003c/p\u003e\n                        \u003cbr/\u003e\n                    \u003c/div\u003e\n\n                    \u003cdiv id=\"FragNeed\"\u003e\n                        \u003ch4\u003eFragmentation Needed (IPv4) / Packet Too Big (IPv6)\u003cbr/\u003e\n                            \u003csmall\u003eIPv4 - (Type3, Code4)\u003cbr/\u003e\n                                IPv6 - (Type2, Code0)\u003c/small\u003e\n                        \u003c/h4\u003e\n                        \u003cp\u003eThese ones are important.  VERY important.  They are an essential component in \n                        \u003ca href=\"http://en.wikipedia.org/wiki/Path_MTU_Discovery\"\u003ePath MTU Discovery\u003c/a\u003e (PMTUD), which is an\n                        essential part of TCP that allows two hosts to adjust their \n                        \u003ca href=\"http://en.wikipedia.org/wiki/Maximum_segment_size\"\u003eTCP Maximum Segment Size\u003c/a\u003e (MSS) value to\n                        one that will fit in the smallest \n                        \u003ca href=\"http://en.wikipedia.org/wiki/Maximum_transmission_unit\"\u003eMTU\u003c/a\u003e along the path of links\n                        between the two hosts.  If two hosts have a smaller MTU than their own local link on the path between\n                        them, and have no means of discovering this, traffic gets silently black-holed; in other words, \u0026#34;you\u0026#39;re\n                        gonna have a bad time\u0026#34;.\u003c/p\u003e\n                        \u003cp\u003eIPv4 packets with the \n                        \u003ca href=\"http://en.wikipedia.org/wiki/IPv4#Flags\"\u003eDF bit\u003c/a\u003e set (that\u0026#39;s most of them!), or IPv6 packets\n                        (remember there\u0026#39;s no fragmentation by routers in IPv6), that are too large for a router to transmit\n                        across an interface will result in that router dropping the packet, and generating a Fragmentation\n                        Needed / Packet Too Big ICMP error back to the source, which also contains the MTU of the too-small\n                        link.  If this error cannot get through to the sender, then the sender will just interpret the lack of\n                        ACKs from the receiver as congestion/loss and re-transmit, which of course will also get dropped.  This\n                        kind of behaviour is tough to troubleshoot because of course the TCP handshakes all work fine, as they\n                        are small packets, but then the session appears to stall as soon as any bulk data transmission\n                        occurs.\u003c/p\u003e\n                        \u003cp\u003e\u003ca href=\"https://www.ietf.org/rfc/rfc4821.txt\"\u003eRFC 4821\u003c/a\u003e was developed to help hosts get around\n                        this problem using Packetization Layer Path MTU Discovery (PLPMTUD), which discovers the path MTU by\n                        incrementally increasing the MSS to try to find a suitable value for the path.  This removes the\n                        dependency on ICMP, and is available in most OS network stacks, but is not as efficient as learning\n                        directly what the maximum MTU should be.  So please just allow these ICMP messages through in the first\n                        place, okay?\u003c/p\u003e\n                        \u003cbr/\u003e\n                    \u003c/div\u003e\n\n                    \u003cdiv id=\"TimeExc\"\u003e\n                        \u003ch4\u003eTime Exceeded\u003cbr/\u003e\n                            \u003csmall\u003eIPv4 - (Type11, Code0)\u003cbr/\u003e\n                                IPv6 - (Type3, Code0)\u003c/small\u003e\n                        \u003c/h4\u003e\n                        \u003cp\u003eTraceroute is a very useful tool for troubleshooting network connections between two hosts, detailing\n                        each hop on the path.  It does this by sending a packet with a TTL of 1 so that the first hop sends back\n                        a Time Exceeded message (including its own source IP), then sending a packet with a TTL of 2, and so on,\n                        to discover each hop on the path.\u003c/p\u003e\n                        \u003cp\u003eRemember when you\u0026#39;ve run it before, and you get a hop or two that can\u0026#39;t be discovered in the middle\n                        of your trace?  Or even worse, you try to traceroute to a host and *every* hop can\u0026#39;t be discovered.\n                        Annoying, right?  That\u0026#39;s because the person running those routers (or your local firewall) decided to\n                        block ICMP Time Exceeded messages.  Don\u0026#39;t be that guy, okay?\u003c/p\u003e\n                        \u003cbr/\u003e\n                    \u003c/div\u003e\n\n                    \u003cdiv id=\"NDP\"\u003e\n                        \u003ch4\u003eNDP and SLAAC (IPv6)\u003cbr/\u003e\n                        \u003csmall\u003eRouter Solicitation (RS) (Type133, Code0)\u003cbr/\u003e\n                            Router Advertisement (RA) (Type134, Code0)\u003cbr/\u003e\n                            Neighbour Solicitation (NS) (Type135, Code0)\u003cbr/\u003e\n                            Neighbour Advertisement (NA) (Type136, Code0)\u003cbr/\u003e\n                            Redirect (Type137, Code0)\u003c/small\u003e\n                        \u003c/h4\u003e\n                        \u003cp\u003eWhile IPv4 used \n                        \u003ca href=\"http://en.wikipedia.org/wiki/Address_Resolution_Protocol\"\u003eAddress Resolution Protocol\u003c/a\u003e (ARP)\n                        for layer 2 to 3 mappings, IPv6 takes a different approach, in the form of \n                        \u003ca href=\"http://en.wikipedia.org/wiki/Neighbor_Discovery_Protocol\"\u003eNeighbour Discovery Protocol\u003c/a\u003e\n                        (NDP).  NDP provides many functions, including router discovery, prefix discovery, address resolution,\n                        and many more besides.  In addition to NDP, \n                        \u003ca href=\"http://en.wikipedia.org/wiki/IPv6_address#Stateless_address_autoconfiguration\"\u003eStateLess Address AutoConfiguration\u003c/a\u003e \n                        (SLAAC) allows a host to be dynamically configured on the network, similar in concept to DHCP (although\n                        DHCPv6 does exist for finer-grained control).\u003c/p\u003e\n                        \u003cp\u003eThese five ICMP types should be permitted within your network (not across your border) in order for\n                        these features of IPv6 to function correctly.\u003c/p\u003e\n                        \u003cbr/\u003e\n                    \u003c/div\u003e\n\n                    \u003cdiv id=\"RateLim\"\u003e\n                        \u003ch4\u003eA Word About Rate Limiting\u003c/h4\u003e\n                        \u003cp\u003eWhile ICMP messages like the ones covered on this page can be very useful, remember that generating\n                        all of these messages takes CPU time on your routers, and generates traffic.  Do you really expect that\n                        you should be getting 1000 pings a second through your firewall in a normal situation?  Would that be\n                        considered legitimate traffic if you saw it?  Nope, probably not.  Rate limit all of these ICMP traffic\n                        types as you see fit for your network; it\u0026#39;s a good line of defence that should not be ignored.\u003c/p\u003e\n                        \u003cbr/\u003e\n                    \u003c/div\u003e\n\n                    \u003cdiv id=\"Read\"\u003e\n                        \u003ch4\u003eRead, Research, Understand\u003c/h4\u003e\n                        \u003cp\u003eGiven that the \u0026#34;to block or not to block\u0026#34; discussion for ICMP seems to always result in confusion,\n                        anger, and borderline fanatical disagreements, go ahead and read up on the topic yourself.  Spend time\n                        understanding it as fully as you can; there are plenty of links throughout this page alone.  Then you\n                        can form your own opinion and make an informed choice about what is best for your network.\u003c/p\u003e\n                        \u003cbr/\u003e\n                    \u003c/div\u003e\n\n                    \n                    \n                    \u003c/div\u003e\u003c/div\u003e",
  "readingTime": "9 min read",
  "publishedTime": null,
  "modifiedTime": null
}
