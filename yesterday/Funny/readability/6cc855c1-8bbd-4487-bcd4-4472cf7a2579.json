{
  "id": "6cc855c1-8bbd-4487-bcd4-4472cf7a2579",
  "title": "CodeSOD: A Unique Way to Primary Key",
  "link": "https://thedailywtf.com/articles/a-unique-way-to-primary-key",
  "description": "\"This keeps giving me a primary key violation!\" complained one of Nancy's co-workers. \"Screw it, I'm dropping the primary key constraint!\" That was a terrifying thing to hear someone say out loud. Nancy decided to take a look at the table before anyone did anything they'd regret. CREATE TYPE record_enum AS ENUM('parts'); CREATE TABLE IF NOT EXISTS parts ( part_uuid VARCHAR(40) NOT NULL, record record_enum NOT NULL, ... ... ... PRIMARY KEY (part_uuid, record) ); This table has a composite primary key. The first is a UUID, and the second is an enum with only one option in it- the name of the table. The latter column seems, well, useless, and certainly isn't going to make the primary key any more unique. But the UUID column should be unique. Universally unique, even. Nancy writes: Was the UUID not unique enough, or perhaps it was too unique?! They weren't able to explain why they had designed the table this way. Nor were they able to explain why they kept violating the primary key constraint. It kept happening to them, for some reason until eventually it stopped happening, also for some reason. [Advertisement] Keep all your packages and Docker containers in one place, scan for vulnerabilities, and control who can access different feeds. ProGet installs in minutes and has a powerful free version with a lot of great features that you can upgrade when ready.Learn more.",
  "author": "Remy Porter",
  "published": "Tue, 22 Jul 2025 06:30:00 GMT",
  "source": "http://syndication.thedailywtf.com/TheDailyWtf",
  "categories": [
    "CodeSOD"
  ],
  "byline": "Remy Porter",
  "length": 1672,
  "excerpt": "\"This keeps giving me a primary key violation!\" complained one of Nancy's co-workers. \"Screw it, I'm dropping the primary key constraint!\" That was a terrifying thing to hear someone say out loud. Nancy decided to take a look at the table before anyone did anything they'd regret.",
  "siteName": "The Daily WTF",
  "favicon": "",
  "text": "by in CodeSOD on 2025-07-22 Edit Remy PorterComputers were a mistake, which is why I'm trying to shoot them into space. Editor-in-Chief for TDWTF. \"This keeps giving me a primary key violation!\" complained one of Nancy's co-workers. \"Screw it, I'm dropping the primary key constraint!\" That was a terrifying thing to hear someone say out loud. Nancy decided to take a look at the table before anyone did anything they'd regret. CREATE TYPE record_enum AS ENUM('parts'); CREATE TABLE IF NOT EXISTS parts ( part_uuid VARCHAR(40) NOT NULL, record record_enum NOT NULL, ... ... ... PRIMARY KEY (part_uuid, record) ); This table has a composite primary key. The first is a UUID, and the second is an enum with only one option in it- the name of the table. The latter column seems, well, useless, and certainly isn't going to make the primary key any more unique. But the UUID column should be unique. Universally unique, even. Nancy writes: Was the UUID not unique enough, or perhaps it was too unique?! They weren't able to explain why they had designed the table this way. Nor were they able to explain why they kept violating the primary key constraint. It kept happening to them, for some reason until eventually it stopped happening, also for some reason. [Advertisement] Keep all your packages and Docker containers in one place, scan for vulnerabilities, and control who can access different feeds. ProGet installs in minutes and has a powerful free version with a lot of great features that you can upgrade when ready.Learn more.",
  "image": "https://s3.amazonaws.com/remy.jetpackshark.com/remy-thumb.jpg",
  "html": "\u003cdiv id=\"readability-page-1\" class=\"page\"\u003e\u003cdiv itemscope=\"\" itemtype=\"http://schema.org/Article\" id=\"article-page\"\u003e\n\n        \n        \u003cp\u003e\u003cspan\u003eby \n            in \u003ca itemprop=\"articleSection\" href=\"https://thedailywtf.com/series/code-sod\"\u003eCodeSOD\u003c/a\u003e\n            on \u003cspan itemprop=\"datePublished\" content=\"2025-07-22\"\u003e2025-07-22\u003c/span\u003e\n            \u003ca href=\"https://thedailywtf.com/admin/article/edit/10966\" rel=\"nofollow\"\u003eEdit\u003c/a\u003e\n        \u003c/span\u003e\u003c/p\u003e\n        \u003cdiv itemprop=\"author\" itemscope=\"\" itemtype=\"http://schema.org/Person\"\u003e\n            \u003cp\u003e\u003cimg itemprop=\"image\" src=\"https://s3.amazonaws.com/remy.jetpackshark.com/remy-thumb.jpg\"/\u003e\n            \u003ca itemprop=\"name\" href=\"https://thedailywtf.com/authors/remy-porter\"\u003eRemy Porter\u003c/a\u003e\u003c/p\u003e\u003cp itemprop=\"description\"\u003eComputers were a mistake, which is why I\u0026#39;m trying to shoot them into space. Editor-in-Chief for TDWTF.\u003c/p\u003e\n        \u003c/div\u003e\n        \u003cdiv itemprop=\"articleBody\"\u003e\n            \u003cp\u003e\u0026#34;This keeps giving me a primary key violation!\u0026#34; complained one of \u003cstrong\u003eNancy\u003c/strong\u003e\u0026#39;s co-workers. \u0026#34;Screw it, I\u0026#39;m dropping the primary key constraint!\u0026#34;\u003c/p\u003e\n\u003cp\u003e\u003cem\u003eThat\u003c/em\u003e was a terrifying thing to hear someone say out loud. Nancy decided to take a look at the table before anyone did anything they\u0026#39;d regret.\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e\u003cspan\u003eCREATE\u003c/span\u003e TYPE record_enum \u003cspan\u003eAS\u003c/span\u003e ENUM(\u003cspan\u003e\u0026#39;parts\u0026#39;\u003c/span\u003e);\n\u003cspan\u003eCREATE\u003c/span\u003e \u003cspan\u003eTABLE\u003c/span\u003e IF \u003cspan\u003eNOT\u003c/span\u003e \u003cspan\u003eEXISTS\u003c/span\u003e parts (\n    part_uuid \u003cspan\u003eVARCHAR\u003c/span\u003e(\u003cspan\u003e40\u003c/span\u003e) \u003cspan\u003eNOT\u003c/span\u003e \u003cspan\u003eNULL\u003c/span\u003e,\n    record record_enum \u003cspan\u003eNOT\u003c/span\u003e \u003cspan\u003eNULL\u003c/span\u003e,\n    ...\n    ...\n    ...\n    \u003cspan\u003ePRIMARY\u003c/span\u003e KEY (part_uuid, record)\n);\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThis table has a composite primary key. The first is a UUID, and the second is an enum with only one option in it- the name of the table. The latter column seems, well, \u003cem\u003euseless\u003c/em\u003e, and certainly isn\u0026#39;t going to make the primary key any more unique. But the UUID column \u003cem\u003eshould\u003c/em\u003e be unique. Universally unique, even.\u003c/p\u003e\n\u003cp\u003eNancy writes:\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eWas the UUID not unique enough, or perhaps it was too unique?! They weren\u0026#39;t able to explain why they had designed the table this way.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003eNor were they able to explain why they kept violating the primary key constraint. It kept happening to them, for \u003cem\u003esome reason\u003c/em\u003e until eventually it stopped happening, also for \u003cem\u003esome reason\u003c/em\u003e.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"https://thedailywtf.com/images/inedo/proget-icon.png\"/\u003e [Advertisement] \n\tKeep all your packages and Docker containers in one place, scan for vulnerabilities, and control who can access different feeds. ProGet installs in minutes and has a powerful free version with a lot of great features that you can upgrade when ready.\u003ca href=\"https://inedo.com/proget?utm_source=tdwtf\u0026amp;utm_medium=footer\u0026amp;utm_content=PlebsFooter\"\u003eLearn more.\u003c/a\u003e\n\u003c/p\u003e\n\n\n        \u003c/div\u003e\n\n        \n    \u003c/div\u003e\u003c/div\u003e",
  "readingTime": "2 min read",
  "publishedTime": "2025-07-22T06:30:00Z",
  "modifiedTime": null
}
